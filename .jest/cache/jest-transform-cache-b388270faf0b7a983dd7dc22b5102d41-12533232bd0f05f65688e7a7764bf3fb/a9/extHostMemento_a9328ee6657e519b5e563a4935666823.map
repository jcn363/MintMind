{"version":3,"names":["cov_t5318b0ci","actualCoverage","DeferredPromise","RunOnceScheduler","ExtensionMemento","_id","_shared","_storage","_init","_value","_storageListener","_deferredPromises","s","Map","_scheduler","constructor","id","global","storage","f","initializeExtensionStorage","Object","create","then","value","onDidChangeStorage","e","b","shared","key","records","setValue","values","complete","error","keys","entries","filter","undefined","map","whenReady","get","defaultValue","update","JSON","parse","stringify","record","p","promise","set","isScheduled","schedule","dispose","ExtensionGlobalMemento","_extension","setKeysForSync","registerExtensionStorageKeysToSync","version","extensionDescription","identifier"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/api/common/extHostMemento.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { IDisposable } from '../../../base/common/lifecycle.js';\nimport { ExtHostStorage } from './extHostStorage.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { DeferredPromise, RunOnceScheduler } from '../../../base/common/async.js';\n\nexport class ExtensionMemento implements vscode.Memento {\n\n\tprotected readonly _id: string;\n\tprivate readonly _shared: boolean;\n\tprotected readonly _storage: ExtHostStorage;\n\n\tprivate readonly _init: Promise<ExtensionMemento>;\n\tprivate _value?: { [n: string]: any };\n\tprivate readonly _storageListener: IDisposable;\n\n\tprivate _deferredPromises: Map<string, DeferredPromise<void>> = new Map();\n\tprivate _scheduler: RunOnceScheduler;\n\n\tconstructor(id: string, global: boolean, storage: ExtHostStorage) {\n\t\tthis._id = id;\n\t\tthis._shared = global;\n\t\tthis._storage = storage;\n\n\t\tthis._init = this._storage.initializeExtensionStorage(this._shared, this._id, Object.create(null)).then(value => {\n\t\t\tthis._value = value;\n\t\t\treturn this;\n\t\t});\n\n\t\tthis._storageListener = this._storage.onDidChangeStorage(e => {\n\t\t\tif (e.shared === this._shared && e.key === this._id) {\n\t\t\t\tthis._value = e.value;\n\t\t\t}\n\t\t});\n\n\t\tthis._scheduler = new RunOnceScheduler(() => {\n\t\t\tconst records = this._deferredPromises;\n\t\t\tthis._deferredPromises = new Map();\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this._storage.setValue(this._shared, this._id, this._value!);\n\t\t\t\t\tfor (const value of records.values()) {\n\t\t\t\t\t\tvalue.complete();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tfor (const value of records.values()) {\n\t\t\t\t\t\tvalue.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})();\n\t\t}, 0);\n\t}\n\n\tkeys(): readonly string[] {\n\t\t// Filter out `undefined` values, as they can stick around in the `_value` until the `onDidChangeStorage` event runs\n\t\treturn Object.entries(this._value ?? {}).filter(([, value]) => value !== undefined).map(([key]) => key);\n\t}\n\n\tget whenReady(): Promise<ExtensionMemento> {\n\t\treturn this._init;\n\t}\n\n\tget<T>(key: string): T | undefined;\n\tget<T>(key: string, defaultValue: T): T;\n\tget<T>(key: string, defaultValue?: T): T {\n\t\tlet value = this._value![key];\n\t\tif (typeof value === 'undefined') {\n\t\t\tvalue = defaultValue;\n\t\t}\n\t\treturn value;\n\t}\n\n\tupdate(key: string, value: any): Promise<void> {\n\t\tif (value !== null && typeof value === 'object') {\n\t\t\t// Prevent the value from being as-is for until we have\n\t\t\t// received the change event from the main side by emulating\n\t\t\t// the treatment of values via JSON parsing and stringifying.\n\t\t\t// (https://github.com/microsoft/vscode/issues/209479)\n\t\t\tthis._value![key] = JSON.parse(JSON.stringify(value));\n\t\t} else {\n\t\t\tthis._value![key] = value;\n\t\t}\n\n\t\tconst record = this._deferredPromises.get(key);\n\t\tif (record !== undefined) {\n\t\t\treturn record.p;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<void>();\n\t\tthis._deferredPromises.set(key, promise);\n\n\t\tif (!this._scheduler.isScheduled()) {\n\t\t\tthis._scheduler.schedule();\n\t\t}\n\n\t\treturn promise.p;\n\t}\n\n\tdispose(): void {\n\t\tthis._storageListener.dispose();\n\t}\n}\n\nexport class ExtensionGlobalMemento extends ExtensionMemento {\n\n\tprivate readonly _extension: IExtensionDescription;\n\n\tsetKeysForSync(keys: string[]): void {\n\t\tthis._storage.registerExtensionStorageKeysToSync({ id: this._id, version: this._extension.version }, keys);\n\t}\n\n\tconstructor(extensionDescription: IExtensionDescription, storage: ExtHostStorage) {\n\t\tsuper(extensionDescription.identifier.value, true, storage);\n\t\tthis._extension = extensionDescription;\n\t}\n\n}\n"],"mappings":"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","ignoreList":[]}