{"version":3,"names":["cov_k55xqhehz","actualCoverage","TimeoutTimer","killTree","isWindows","McpStdioStateHandler","_child","_graceTimeMs","GRACE_TIME_MS","s","_procState","_nextTimeout","stopped","f","constructor","b","stop","graceTime","stdin","end","error","killPolite","dispose","killForceful","pid","catch","kill","write","message"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/mcp/node/mcpStdioStateHandler.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ChildProcessWithoutNullStreams } from 'child_process';\nimport { TimeoutTimer } from '../../../../base/common/async.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { killTree } from '../../../../base/node/processes.js';\nimport { isWindows } from '../../../../base/common/platform.js';\n\nconst enum McpProcessState {\n\tRunning,\n\tStdinEnded,\n\tKilledPolite,\n\tKilledForceful,\n}\n\n/**\n * Manages graceful shutdown of MCP stdio connections following the MCP specification.\n *\n * Per spec, shutdown should:\n * 1. Close the input stream to the child process\n * 2. Wait for the server to exit, or send SIGTERM if it doesn't exit within 10 seconds\n * 3. Send SIGKILL if the server doesn't exit within 10 seconds after SIGTERM\n * 4. Allow forceful killing if called twice\n */\nexport class McpStdioStateHandler implements IDisposable {\n\tprivate static readonly GRACE_TIME_MS = 10_000;\n\n\tprivate _procState = McpProcessState.Running;\n\tprivate _nextTimeout?: IDisposable;\n\n\tpublic get stopped() {\n\t\treturn this._procState !== McpProcessState.Running;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _child: ChildProcessWithoutNullStreams,\n\t\tprivate readonly _graceTimeMs: number = McpStdioStateHandler.GRACE_TIME_MS\n\t) { }\n\n\t/**\n\t * Initiates graceful shutdown. If called while shutdown is already in progress,\n\t * forces immediate termination.\n\t */\n\tpublic stop(): void {\n\t\tif (this._procState === McpProcessState.Running) {\n\t\t\tlet graceTime = this._graceTimeMs;\n\t\t\ttry {\n\t\t\t\tthis._child.stdin.end();\n\t\t\t} catch (error) {\n\t\t\t\t// If stdin.end() fails, continue with termination sequence\n\t\t\t\t// This can happen if the stream is already in an error state\n\t\t\t\tgraceTime = 1;\n\t\t\t}\n\t\t\tthis._procState = McpProcessState.StdinEnded;\n\t\t\tthis._nextTimeout = new TimeoutTimer(() => this.killPolite(), graceTime);\n\t\t} else {\n\t\t\tthis._nextTimeout?.dispose();\n\t\t\tthis.killForceful();\n\t\t}\n\t}\n\n\tprivate async killPolite() {\n\t\tthis._procState = McpProcessState.KilledPolite;\n\t\tthis._nextTimeout = new TimeoutTimer(() => this.killForceful(), this._graceTimeMs);\n\n\t\tif (this._child.pid) {\n\t\t\tif (!isWindows) {\n\t\t\t\tawait killTree(this._child.pid, false).catch(() => {\n\t\t\t\t\tthis._child.kill('SIGTERM');\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis._child.kill('SIGTERM');\n\t\t}\n\t}\n\n\tprivate async killForceful() {\n\t\tthis._procState = McpProcessState.KilledForceful;\n\n\t\tif (this._child.pid) {\n\t\t\tawait killTree(this._child.pid, true).catch(() => {\n\t\t\t\tthis._child.kill('SIGKILL');\n\t\t\t});\n\t\t} else {\n\t\t\tthis._child.kill();\n\t\t}\n\t}\n\n\tpublic write(message: string): void {\n\t\tif (!this.stopped) {\n\t\t\tthis._child.stdin.write(message + '\\n');\n\t\t}\n\t}\n\n\tpublic dispose() {\n\t\tthis._nextTimeout?.dispose();\n\t}\n}\n"],"mappings":"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","ignoreList":[]}