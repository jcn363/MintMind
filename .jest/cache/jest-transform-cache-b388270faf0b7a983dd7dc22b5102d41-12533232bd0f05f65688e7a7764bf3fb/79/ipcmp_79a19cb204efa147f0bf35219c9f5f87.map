{"version":3,"names":["cov_sdp8yfslh","actualCoverage","isUtilityProcess","VSBuffer","IPCServer","Emitter","Event","assertType","Protocol","port","onMessage","constructor","f","s","fromNodeEventEmitter","e","data","b","wrap","alloc","start","send","message","postMessage","buffer","disconnect","close","Server","getOnDidClientConnect","filter","process","onCreateMessageChannel","parentPort","on","handledClientConnection","ports","at","fire","map","event","protocol","result","onDidClientDisconnect","once","callback","listener","removeListener"],"sources":["/home/user/Desktop/MintMind/src/vs/base/parts/ipc/node/ipc.mp.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MessagePortMain, isUtilityProcess, MessageEvent } from '../../sandbox/node/electronTypes.js';\nimport { VSBuffer } from '../../../common/buffer.js';\nimport { ClientConnectionEvent, IMessagePassingProtocol, IPCServer } from '../common/ipc.js';\nimport { Emitter, Event } from '../../../common/event.js';\nimport { assertType } from '../../../common/types.js';\n\n/**\n * The MessagePort `Protocol` leverages MessagePortMain style IPC communication\n * for the implementation of the `IMessagePassingProtocol`.\n */\nclass Protocol implements IMessagePassingProtocol {\n\n\treadonly onMessage;\n\n\tconstructor(private port: MessagePortMain) {\n\t\tthis.onMessage = Event.fromNodeEventEmitter<VSBuffer>(this.port, 'message', (e: MessageEvent) => {\n\t\t\tif (e.data) {\n\t\t\t\treturn VSBuffer.wrap(e.data as Uint8Array);\n\t\t\t}\n\t\t\treturn VSBuffer.alloc(0);\n\t\t});\n\t\t// we must call start() to ensure messages are flowing\n\t\tport.start();\n\t}\n\n\tsend(message: VSBuffer): void {\n\t\tthis.port.postMessage(message.buffer);\n\t}\n\n\tdisconnect(): void {\n\t\tthis.port.close();\n\t}\n}\n\nexport interface IClientConnectionFilter {\n\n\t/**\n\t * Allows to filter incoming messages to the\n\t * server to handle them differently.\n\t *\n\t * @param e the message event to handle\n\t * @returns `true` if the event was handled\n\t * and should not be processed by the server.\n\t */\n\thandledClientConnection(e: MessageEvent): boolean;\n}\n\n/**\n * An implementation of a `IPCServer` on top of MessagePort style IPC communication.\n * The clients register themselves via Electron Utility Process IPC transfer.\n */\nexport class Server extends IPCServer {\n\n\tprivate static getOnDidClientConnect(filter?: IClientConnectionFilter): Event<ClientConnectionEvent> {\n\t\tassertType(isUtilityProcess(process), 'Electron Utility Process');\n\n\t\tconst onCreateMessageChannel = new Emitter<MessagePortMain>();\n\n\t\tprocess.parentPort.on('message', (e: MessageEvent) => {\n\t\t\tif (filter?.handledClientConnection(e)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst port = e.ports.at(0);\n\t\t\tif (port) {\n\t\t\t\tonCreateMessageChannel.fire(port);\n\t\t\t}\n\t\t});\n\n\t\treturn Event.map(onCreateMessageChannel.event, port => {\n\t\t\tconst protocol = new Protocol(port);\n\n\t\t\tconst result: ClientConnectionEvent = {\n\t\t\t\tprotocol,\n\t\t\t\t// Not part of the standard spec, but in Electron we get a `close` event\n\t\t\t\t// when the other side closes. We can use this to detect disconnects\n\t\t\t\t// (https://github.com/electron/electron/blob/11-x-y/docs/api/message-port-main.md#event-close)\n\t\t\t\tonDidClientDisconnect: Event.fromNodeEventEmitter(port, 'close')\n\t\t\t};\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tconstructor(filter?: IClientConnectionFilter) {\n\t\tsuper(Server.getOnDidClientConnect(filter));\n\t}\n}\n\ninterface INodeMessagePortFragment {\n\ton(event: 'message', listener: (messageEvent: MessageEvent) => void): this;\n\tremoveListener(event: 'message', listener: (messageEvent: MessageEvent) => void): this;\n}\n\nexport function once(port: INodeMessagePortFragment, message: unknown, callback: () => void): void {\n\tconst listener = (e: MessageEvent) => {\n\t\tif (e.data === message) {\n\t\t\tport.removeListener('message', listener);\n\t\t\tcallback();\n\t\t}\n\t};\n\n\tport.on('message', listener);\n}\n"],"mappings":"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","ignoreList":[]}