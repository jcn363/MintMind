{"version":3,"names":["cov_1abrufv06i","actualCoverage","toFormattedString","NotebookCellsChangeType","NotebookMetadataUri","StringSHA1","Disposable","Emitter","Range","createTextBuffer","getFormattedNotebookMetadataJSON","transientMetadata","metadata","f","filteredMetadata","s","b","keys","Set","Object","key","metadataSource","NotebookDocumentMetadataTextModel","notebookModel","uri","_onDidChange","_register","onDidChange","event","_textBufferHash","_textBuffer","textBuffer","source","transientOptions","transientDocumentMetadata","onDidChangeContent","fire","constructor","generate","e","rawEvents","some","kind","ChangeDocumentMetadata","ModelChange","dispose","undefined","getHash","shaComputer","snapshot","createSnapshot","text","read","update","digest","getValue","fullRange","getFullModelRange","eol","getEOL","getValueInRange","lineCount","getLineCount","getLineLength"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/notebook/common/model/notebookMetadataTextModel.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toFormattedString } from '../../../../../base/common/jsonFormatter.js';\nimport { INotebookDocumentMetadataTextModel, INotebookTextModel, NotebookCellMetadata, NotebookCellsChangeType, NotebookDocumentMetadata, NotebookMetadataUri, TransientDocumentMetadata } from '../notebookCommon.js';\nimport { StringSHA1 } from '../../../../../base/common/hash.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { DefaultEndOfLine, EndOfLinePreference, ITextBuffer } from '../../../../../editor/common/model.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { createTextBuffer } from '../../../../../editor/common/model/textModel.js';\n\nexport function getFormattedNotebookMetadataJSON(transientMetadata: TransientDocumentMetadata | undefined, metadata: NotebookDocumentMetadata) {\n\tlet filteredMetadata: { [key: string]: any } = {};\n\n\tif (transientMetadata) {\n\t\tconst keys = new Set([...Object.keys(metadata)]);\n\t\tfor (const key of keys) {\n\t\t\tif (!(transientMetadata[key as keyof NotebookCellMetadata])\n\t\t\t) {\n\t\t\t\tfilteredMetadata[key] = metadata[key as keyof NotebookCellMetadata];\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfilteredMetadata = metadata;\n\t}\n\n\tconst metadataSource = toFormattedString(filteredMetadata, {});\n\n\treturn metadataSource;\n}\n\nexport class NotebookDocumentMetadataTextModel extends Disposable implements INotebookDocumentMetadataTextModel {\n\tpublic readonly uri: URI;\n\tpublic get metadata(): NotebookDocumentMetadata {\n\t\treturn this.notebookModel.metadata;\n\t}\n\tprivate readonly _onDidChange = this._register(new Emitter<void>());\n\tpublic readonly onDidChange = this._onDidChange.event;\n\n\tprivate _textBufferHash: string | null = null;\n\tprivate _textBuffer?: ITextBuffer;\n\tget textBuffer() {\n\t\tif (this._textBuffer) {\n\t\t\treturn this._textBuffer;\n\t\t}\n\n\t\tconst source = getFormattedNotebookMetadataJSON(this.notebookModel.transientOptions.transientDocumentMetadata, this.metadata);\n\t\tthis._textBuffer = this._register(createTextBuffer(source, DefaultEndOfLine.LF).textBuffer);\n\n\t\tthis._register(this._textBuffer.onDidChangeContent(() => {\n\t\t\tthis._onDidChange.fire();\n\t\t}));\n\n\t\treturn this._textBuffer;\n\t}\n\n\tconstructor(public readonly notebookModel: INotebookTextModel) {\n\t\tsuper();\n\t\tthis.uri = NotebookMetadataUri.generate(this.notebookModel.uri);\n\t\tthis._register(this.notebookModel.onDidChangeContent((e) => {\n\t\t\tif (e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeDocumentMetadata || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\tthis._textBuffer?.dispose();\n\t\t\t\tthis._textBuffer = undefined;\n\t\t\t\tthis._textBufferHash = null;\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetHash() {\n\t\tif (this._textBufferHash !== null) {\n\t\t\treturn this._textBufferHash;\n\t\t}\n\n\t\tconst shaComputer = new StringSHA1();\n\t\tconst snapshot = this.textBuffer.createSnapshot(false);\n\t\tlet text: string | null;\n\t\twhile ((text = snapshot.read())) {\n\t\t\tshaComputer.update(text);\n\t\t}\n\t\tthis._textBufferHash = shaComputer.digest();\n\t\treturn this._textBufferHash;\n\t}\n\n\tpublic getValue() {\n\t\tconst fullRange = this.getFullModelRange();\n\t\tconst eol = this.textBuffer.getEOL();\n\t\tif (eol === '\\n') {\n\t\t\treturn this.textBuffer.getValueInRange(fullRange, EndOfLinePreference.LF);\n\t\t} else {\n\t\t\treturn this.textBuffer.getValueInRange(fullRange, EndOfLinePreference.CRLF);\n\t\t}\n\t}\n\tprivate getFullModelRange() {\n\t\tconst lineCount = this.textBuffer.getLineCount();\n\t\treturn new Range(1, 1, lineCount, this.textBuffer.getLineLength(lineCount) + 1);\n\t}\n\n}\n"],"mappings":"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","ignoreList":[]}