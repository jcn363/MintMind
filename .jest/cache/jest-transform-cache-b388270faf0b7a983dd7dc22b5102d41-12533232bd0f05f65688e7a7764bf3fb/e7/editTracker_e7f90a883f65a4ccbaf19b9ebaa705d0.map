{"version":3,"names":["cov_14vgfiyxlx","actualCoverage","Disposable","observableSignal","runOnChange","AnnotatedStringEdit","DocumentEditSourceTracker","_doc","data","_edits","s","empty","_pendingExternalEdits","_update","_representativePerKey","Map","_sumAddedCharactersPerKey","constructor","f","_register","value","_val","_prevVal","edits","eComposed","compose","map","e","edit","replacements","every","source","category","b","isEmpty","_applyEdit","trigger","undefined","r","existing","get","key","set","representative","newCount","getNewLength","waitForQueue","getTotalInsertedCharactersCount","val","getAllKeys","Array","from","keys","getRepresentative","getTrackedRanges","reader","read","ranges","getNewRanges","idx","te","TrackedEdit","replaceRange","_getDebugVisualization","txt","$fileExtension","range","start","endExclusive","color","getColor","originalRange","sourceKey","sourceRepresentative"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/editTelemetry/browser/telemetry/editTracker.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { observableSignal, runOnChange, IReader } from '../../../../../base/common/observable.js';\nimport { AnnotatedStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { TextModelEditSource } from '../../../../../editor/common/textModelEditSource.js';\nimport { IDocumentWithAnnotatedEdits, EditKeySourceData, EditSource } from '../helpers/documentWithAnnotatedEdits.js';\n\n/**\n * Tracks a single document.\n*/\nexport class DocumentEditSourceTracker<T = void> extends Disposable {\n\tprivate _edits: AnnotatedStringEdit<EditKeySourceData> = AnnotatedStringEdit.empty;\n\tprivate _pendingExternalEdits: AnnotatedStringEdit<EditKeySourceData> = AnnotatedStringEdit.empty;\n\n\tprivate readonly _update = observableSignal(this);\n\tprivate readonly _representativePerKey: Map<string, TextModelEditSource> = new Map();\n\tprivate readonly _sumAddedCharactersPerKey: Map</* key */string, number> = new Map();\n\n\tconstructor(\n\t\tprivate readonly _doc: IDocumentWithAnnotatedEdits,\n\t\tpublic readonly data: T,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(this._doc.value, (_val, _prevVal, edits) => {\n\t\t\tconst eComposed = AnnotatedStringEdit.compose(edits.map(e => e.edit));\n\t\t\tif (eComposed.replacements.every(e => e.data.source.category === 'external')) {\n\t\t\t\tif (this._edits.isEmpty()) {\n\t\t\t\t\t// Ignore initial external edits\n\t\t\t\t} else {\n\t\t\t\t\t// queue pending external edits\n\t\t\t\t\tthis._pendingExternalEdits = this._pendingExternalEdits.compose(eComposed);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this._pendingExternalEdits.isEmpty()) {\n\t\t\t\t\tthis._applyEdit(this._pendingExternalEdits);\n\t\t\t\t\tthis._pendingExternalEdits = AnnotatedStringEdit.empty;\n\t\t\t\t}\n\t\t\t\tthis._applyEdit(eComposed);\n\t\t\t}\n\n\t\t\tthis._update.trigger(undefined);\n\t\t}));\n\t}\n\n\tprivate _applyEdit(e: AnnotatedStringEdit<EditKeySourceData>): void {\n\t\tfor (const r of e.replacements) {\n\t\t\tlet existing = this._sumAddedCharactersPerKey.get(r.data.key);\n\t\t\tif (existing === undefined) {\n\t\t\t\texisting = 0;\n\t\t\t\tthis._representativePerKey.set(r.data.key, r.data.representative);\n\t\t\t}\n\t\t\tconst newCount = existing + r.getNewLength();\n\t\t\tthis._sumAddedCharactersPerKey.set(r.data.key, newCount);\n\t\t}\n\n\t\tthis._edits = this._edits.compose(e);\n\t}\n\n\tasync waitForQueue(): Promise<void> {\n\t\tawait this._doc.waitForQueue();\n\t}\n\n\tpublic getTotalInsertedCharactersCount(key: string): number {\n\t\tconst val = this._sumAddedCharactersPerKey.get(key);\n\t\treturn val ?? 0;\n\t}\n\n\tpublic getAllKeys(): string[] {\n\t\treturn Array.from(this._sumAddedCharactersPerKey.keys());\n\t}\n\n\tpublic getRepresentative(key: string): TextModelEditSource | undefined {\n\t\treturn this._representativePerKey.get(key);\n\t}\n\n\tpublic getTrackedRanges(reader?: IReader): TrackedEdit[] {\n\t\tthis._update.read(reader);\n\t\tconst ranges = this._edits.getNewRanges();\n\t\treturn ranges.map((r, idx) => {\n\t\t\tconst e = this._edits.replacements[idx];\n\t\t\tconst te = new TrackedEdit(e.replaceRange, r, e.data.key, e.data.source, e.data.representative);\n\t\t\treturn te;\n\t\t});\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn this._edits.isEmpty();\n\t}\n\n\tpublic _getDebugVisualization() {\n\t\tconst ranges = this.getTrackedRanges();\n\t\tconst txt = this._doc.value.get().value;\n\n\t\treturn {\n\t\t\t...{ $fileExtension: 'text.w' },\n\t\t\t'value': txt,\n\t\t\t'decorations': ranges.map(r => {\n\t\t\t\treturn {\n\t\t\t\t\trange: [r.range.start, r.range.endExclusive],\n\t\t\t\t\tcolor: r.source.getColor(),\n\t\t\t\t};\n\t\t\t})\n\t\t};\n\t}\n}\n\nexport class TrackedEdit {\n\tconstructor(\n\t\tpublic readonly originalRange: OffsetRange,\n\t\tpublic readonly range: OffsetRange,\n\t\tpublic readonly sourceKey: string,\n\t\tpublic readonly source: EditSource,\n\t\tpublic readonly sourceRepresentative: TextModelEditSource,\n\t) { }\n}\n"],"mappings":"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","ignoreList":[]}