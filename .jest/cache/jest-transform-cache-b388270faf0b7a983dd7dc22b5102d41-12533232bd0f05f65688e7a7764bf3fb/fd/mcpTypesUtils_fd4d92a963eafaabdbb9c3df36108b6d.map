{"version":3,"names":["cov_1l75ok98ma","actualCoverage","disposableTimeout","timeout","CancellationError","DisposableStore","autorun","startServerByFilter","mcpService","filter","b","f","s","Promise","resolve","reject","store","add","reader","servers","read","server","find","start","promptType","then","state","showOutput","dispose","startServerAndWaitForLiveTools","opts","token","r","ok","isCancellationRequested","onCancellationRequested","connState","connectionState","toolState","cacheState","mcpServerToSourceData","metadata","serverMetadata","get","type","serverLabel","serverName","instructions","serverInstructions","label","definition","collectionId","collection","id","definitionId"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/mcp/common/mcpTypesUtils.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { disposableTimeout, timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { CancellationError } from '../../../../base/common/errors.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../base/common/observable.js';\nimport { ToolDataSource } from '../../chat/common/languageModelToolsService.js';\nimport { IMcpServer, IMcpServerStartOpts, IMcpService, McpConnectionState, McpServerCacheState } from './mcpTypes.js';\n\n/**\n * Waits up to `timeout` for a server passing the filter to be discovered,\n * and then starts it.\n */\nexport function startServerByFilter(mcpService: IMcpService, filter: (s: IMcpServer) => boolean, timeout = 5000) {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tconst store = new DisposableStore();\n\t\tstore.add(autorun(reader => {\n\t\t\tconst servers = mcpService.servers.read(reader);\n\t\t\tconst server = servers.find(filter);\n\n\t\t\tif (server) {\n\t\t\t\tserver.start({ promptType: 'all-untrusted' }).then(state => {\n\t\t\t\t\tif (state.state === McpConnectionState.Kind.Error) {\n\t\t\t\t\t\tserver.showOutput();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tresolve();\n\t\t\t\tstore.dispose();\n\t\t\t}\n\t\t}));\n\n\t\tstore.add(disposableTimeout(() => {\n\t\t\tstore.dispose();\n\t\t\treject(new CancellationError());\n\t\t}, timeout));\n\t});\n}\n\n/**\n * Starts a server (if needed) and waits for its tools to be live. Returns\n * true/false whether this happened successfully.\n */\nexport async function startServerAndWaitForLiveTools(server: IMcpServer, opts?: IMcpServerStartOpts, token?: CancellationToken): Promise<boolean> {\n\tconst r = await server.start(opts);\n\n\tconst store = new DisposableStore();\n\tconst ok = await new Promise<boolean>(resolve => {\n\t\tif (token?.isCancellationRequested || r.state === McpConnectionState.Kind.Error || r.state === McpConnectionState.Kind.Stopped) {\n\t\t\treturn resolve(false);\n\t\t}\n\n\t\tif (token) {\n\t\t\tstore.add(token.onCancellationRequested(() => {\n\t\t\t\tresolve(false);\n\t\t\t}));\n\t\t}\n\n\t\tstore.add(autorun(reader => {\n\t\t\tconst connState = server.connectionState.read(reader).state;\n\t\t\tif (connState === McpConnectionState.Kind.Error || connState === McpConnectionState.Kind.Stopped) {\n\t\t\t\tresolve(false); // some error, don't block the request\n\t\t\t}\n\n\t\t\tconst toolState = server.cacheState.read(reader);\n\t\t\tif (toolState === McpServerCacheState.Live) {\n\t\t\t\tresolve(true); // got tools, all done\n\t\t\t}\n\t\t}));\n\t});\n\n\tif (ok) {\n\t\tawait timeout(0); // let the tools register in the language model contribution\n\t}\n\n\treturn ok;\n}\n\nexport function mcpServerToSourceData(server: IMcpServer): ToolDataSource {\n\tconst metadata = server.serverMetadata.get();\n\treturn {\n\t\ttype: 'mcp',\n\t\tserverLabel: metadata?.serverName,\n\t\tinstructions: metadata?.serverInstructions,\n\t\tlabel: server.definition.label,\n\t\tcollectionId: server.collection.id,\n\t\tdefinitionId: server.definition.id\n\t};\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAoBE;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AApBF;;;;AAKA,SAASE,iBAAiB,EAAEC,OAAO,QAAQ,kCAAkC;AAE7E,SAASC,iBAAiB,QAAQ,mCAAmC;AACrE,SAASC,eAAe,QAAQ,sCAAsC;AACtE,SAASC,OAAO,QAAQ,uCAAuC;AAI/D;;;;AAIA,OAAM,SAAUC,mBAAmBA,CAACC,UAAuB,EAAEC,MAAkC,EAAEN,OAAO;AAAA;AAAA,CAAAH,cAAA,GAAAU,CAAA,UAAG,IAAI;EAAA;EAAAV,cAAA,GAAAW,CAAA;EAAAX,cAAA,GAAAY,CAAA;EAC9G,OAAO,IAAIC,OAAO,CAAO,CAACC,OAAO,EAAEC,MAAM,KAAI;IAAA;IAAAf,cAAA,GAAAW,CAAA;IAC5C,MAAMK,KAAK;IAAA;IAAA,CAAAhB,cAAA,GAAAY,CAAA,OAAG,IAAIP,eAAe,EAAE;IAAC;IAAAL,cAAA,GAAAY,CAAA;IACpCI,KAAK,CAACC,GAAG,CAACX,OAAO,CAACY,MAAM,IAAG;MAAA;MAAAlB,cAAA,GAAAW,CAAA;MAC1B,MAAMQ,OAAO;MAAA;MAAA,CAAAnB,cAAA,GAAAY,CAAA,OAAGJ,UAAU,CAACW,OAAO,CAACC,IAAI,CAACF,MAAM,CAAC;MAC/C,MAAMG,MAAM;MAAA;MAAA,CAAArB,cAAA,GAAAY,CAAA,OAAGO,OAAO,CAACG,IAAI,CAACb,MAAM,CAAC;MAAC;MAAAT,cAAA,GAAAY,CAAA;MAEpC,IAAIS,MAAM,EAAE;QAAA;QAAArB,cAAA,GAAAU,CAAA;QAAAV,cAAA,GAAAY,CAAA;QACXS,MAAM,CAACE,KAAK,CAAC;UAAEC,UAAU,EAAE;QAAe,CAAE,CAAC,CAACC,IAAI,CAACC,KAAK,IAAG;UAAA;UAAA1B,cAAA,GAAAW,CAAA;UAAAX,cAAA,GAAAY,CAAA;UAC1D,IAAIc,KAAK,CAACA,KAAK,4CAAoC;YAAA;YAAA1B,cAAA,GAAAU,CAAA;YAAAV,cAAA,GAAAY,CAAA;YAClDS,MAAM,CAACM,UAAU,EAAE;UACpB,CAAC;UAAA;UAAA;YAAA3B,cAAA,GAAAU,CAAA;UAAA;QACF,CAAC,CAAC;QAAC;QAAAV,cAAA,GAAAY,CAAA;QAEHE,OAAO,EAAE;QAAC;QAAAd,cAAA,GAAAY,CAAA;QACVI,KAAK,CAACY,OAAO,EAAE;MAChB,CAAC;MAAA;MAAA;QAAA5B,cAAA,GAAAU,CAAA;MAAA;IACF,CAAC,CAAC,CAAC;IAAC;IAAAV,cAAA,GAAAY,CAAA;IAEJI,KAAK,CAACC,GAAG,CAACf,iBAAiB,CAAC,MAAK;MAAA;MAAAF,cAAA,GAAAW,CAAA;MAAAX,cAAA,GAAAY,CAAA;MAChCI,KAAK,CAACY,OAAO,EAAE;MAAC;MAAA5B,cAAA,GAAAY,CAAA;MAChBG,MAAM,CAAC,IAAIX,iBAAiB,EAAE,CAAC;IAChC,CAAC,EAAED,OAAO,CAAC,CAAC;EACb,CAAC,CAAC;AACH;AAEA;;;;AAIA,OAAO,eAAe0B,8BAA8BA,CAACR,MAAkB,EAAES,IAA0B,EAAEC,KAAyB;EAAA;EAAA/B,cAAA,GAAAW,CAAA;EAC7H,MAAMqB,CAAC;EAAA;EAAA,CAAAhC,cAAA,GAAAY,CAAA,QAAG,MAAMS,MAAM,CAACE,KAAK,CAACO,IAAI,CAAC;EAElC,MAAMd,KAAK;EAAA;EAAA,CAAAhB,cAAA,GAAAY,CAAA,QAAG,IAAIP,eAAe,EAAE;EACnC,MAAM4B,EAAE;EAAA;EAAA,CAAAjC,cAAA,GAAAY,CAAA,QAAG,MAAM,IAAIC,OAAO,CAAUC,OAAO,IAAG;IAAA;IAAAd,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAY,CAAA;IAC/C;IAAI;IAAA,CAAAZ,cAAA,GAAAU,CAAA,UAAAqB,KAAK,EAAEG,uBAAuB;IAAA;IAAA,CAAAlC,cAAA,GAAAU,CAAA,UAAIsB,CAAC,CAACN,KAAK;IAAA;IAAA,CAAA1B,cAAA,GAAAU,CAAA,UAAsCsB,CAAC,CAACN,KAAK,+CAAsC;MAAA;MAAA1B,cAAA,GAAAU,CAAA;MAAAV,cAAA,GAAAY,CAAA;MAC/H,OAAOE,OAAO,CAAC,KAAK,CAAC;IACtB,CAAC;IAAA;IAAA;MAAAd,cAAA,GAAAU,CAAA;IAAA;IAAAV,cAAA,GAAAY,CAAA;IAED,IAAImB,KAAK,EAAE;MAAA;MAAA/B,cAAA,GAAAU,CAAA;MAAAV,cAAA,GAAAY,CAAA;MACVI,KAAK,CAACC,GAAG,CAACc,KAAK,CAACI,uBAAuB,CAAC,MAAK;QAAA;QAAAnC,cAAA,GAAAW,CAAA;QAAAX,cAAA,GAAAY,CAAA;QAC5CE,OAAO,CAAC,KAAK,CAAC;MACf,CAAC,CAAC,CAAC;IACJ,CAAC;IAAA;IAAA;MAAAd,cAAA,GAAAU,CAAA;IAAA;IAAAV,cAAA,GAAAY,CAAA;IAEDI,KAAK,CAACC,GAAG,CAACX,OAAO,CAACY,MAAM,IAAG;MAAA;MAAAlB,cAAA,GAAAW,CAAA;MAC1B,MAAMyB,SAAS;MAAA;MAAA,CAAApC,cAAA,GAAAY,CAAA,QAAGS,MAAM,CAACgB,eAAe,CAACjB,IAAI,CAACF,MAAM,CAAC,CAACQ,KAAK;MAAC;MAAA1B,cAAA,GAAAY,CAAA;MAC5D;MAAI;MAAA,CAAAZ,cAAA,GAAAU,CAAA,UAAA0B,SAAS;MAAA;MAAA,CAAApC,cAAA,GAAAU,CAAA,UAAsC0B,SAAS,+CAAsC;QAAA;QAAApC,cAAA,GAAAU,CAAA;QAAAV,cAAA,GAAAY,CAAA;QACjGE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;MACjB,CAAC;MAAA;MAAA;QAAAd,cAAA,GAAAU,CAAA;MAAA;MAED,MAAM4B,SAAS;MAAA;MAAA,CAAAtC,cAAA,GAAAY,CAAA,QAAGS,MAAM,CAACkB,UAAU,CAACnB,IAAI,CAACF,MAAM,CAAC;MAAC;MAAAlB,cAAA,GAAAY,CAAA;MACjD,IAAI0B,SAAS,uCAA+B;QAAA;QAAAtC,cAAA,GAAAU,CAAA;QAAAV,cAAA,GAAAY,CAAA;QAC3CE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;MAChB,CAAC;MAAA;MAAA;QAAAd,cAAA,GAAAU,CAAA;MAAA;IACF,CAAC,CAAC,CAAC;EACJ,CAAC,CAAC;EAAC;EAAAV,cAAA,GAAAY,CAAA;EAEH,IAAIqB,EAAE,EAAE;IAAA;IAAAjC,cAAA,GAAAU,CAAA;IAAAV,cAAA,GAAAY,CAAA;IACP,MAAMT,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;EACnB,CAAC;EAAA;EAAA;IAAAH,cAAA,GAAAU,CAAA;EAAA;EAAAV,cAAA,GAAAY,CAAA;EAED,OAAOqB,EAAE;AACV;AAEA,OAAM,SAAUO,qBAAqBA,CAACnB,MAAkB;EAAA;EAAArB,cAAA,GAAAW,CAAA;EACvD,MAAM8B,QAAQ;EAAA;EAAA,CAAAzC,cAAA,GAAAY,CAAA,QAAGS,MAAM,CAACqB,cAAc,CAACC,GAAG,EAAE;EAAC;EAAA3C,cAAA,GAAAY,CAAA;EAC7C,OAAO;IACNgC,IAAI,EAAE,KAAK;IACXC,WAAW,EAAEJ,QAAQ,EAAEK,UAAU;IACjCC,YAAY,EAAEN,QAAQ,EAAEO,kBAAkB;IAC1CC,KAAK,EAAE5B,MAAM,CAAC6B,UAAU,CAACD,KAAK;IAC9BE,YAAY,EAAE9B,MAAM,CAAC+B,UAAU,CAACC,EAAE;IAClCC,YAAY,EAAEjC,MAAM,CAAC6B,UAAU,CAACG;GAChC;AACF","ignoreList":[]}