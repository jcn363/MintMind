{"version":3,"names":["cov_2l9xiqgl09","actualCoverage","Emitter","Disposable","compressOutputItemStreams","isTextStreamMime","NotebookCellOutputTextModel","_rawOutput","_onDidChangeData","s","_register","onDidChangeData","event","outputs","f","b","metadata","outputId","_alternativeOutputId","alternativeOutputId","_versionId","versionId","constructor","replaceData","rawData","versionedBufferLengths","optimizeOutputItems","fire","appendData","items","trackBufferLengths","push","forEach","output","mime","data","byteLength","appendedSinceVersion","bufferLength","find","slice","undefined","length","every","item","mimeOutputs","Map","mimeTypes","has","get","set","buffer","compressionResult","didCompression","asDto","bumpVersion"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/notebook/common/model/notebookCellOutputTextModel.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { ICellOutput, IOutputDto, IOutputItemDto, compressOutputItemStreams } from '../notebookCommon.js';\nimport { isTextStreamMime } from '../../../../../base/common/mime.js';\n\nexport class NotebookCellOutputTextModel extends Disposable implements ICellOutput {\n\n\tprivate _onDidChangeData = this._register(new Emitter<void>());\n\tonDidChangeData = this._onDidChangeData.event;\n\n\tget outputs() {\n\t\treturn this._rawOutput.outputs || [];\n\t}\n\n\tget metadata(): Record<string, any> | undefined {\n\t\treturn this._rawOutput.metadata;\n\t}\n\n\tget outputId(): string {\n\t\treturn this._rawOutput.outputId;\n\t}\n\n\t/**\n\t * Alternative output id that's reused when the output is updated.\n\t */\n\tprivate _alternativeOutputId: string;\n\n\tget alternativeOutputId(): string {\n\t\treturn this._alternativeOutputId;\n\t}\n\n\tprivate _versionId = 0;\n\n\tget versionId() {\n\t\treturn this._versionId;\n\t}\n\n\tconstructor(\n\t\tprivate _rawOutput: IOutputDto\n\t) {\n\t\tsuper();\n\n\t\tthis._alternativeOutputId = this._rawOutput.outputId;\n\t}\n\n\treplaceData(rawData: IOutputDto) {\n\t\tthis.versionedBufferLengths = {};\n\t\tthis._rawOutput = rawData;\n\t\tthis.optimizeOutputItems();\n\t\tthis._versionId = this._versionId + 1;\n\t\tthis._onDidChangeData.fire();\n\t}\n\n\tappendData(items: IOutputItemDto[]) {\n\t\tthis.trackBufferLengths();\n\t\tthis._rawOutput.outputs.push(...items);\n\t\tthis.optimizeOutputItems();\n\t\tthis._versionId = this._versionId + 1;\n\t\tthis._onDidChangeData.fire();\n\t}\n\n\tprivate trackBufferLengths() {\n\t\tthis.outputs.forEach(output => {\n\t\t\tif (isTextStreamMime(output.mime)) {\n\t\t\t\tif (!this.versionedBufferLengths[output.mime]) {\n\t\t\t\t\tthis.versionedBufferLengths[output.mime] = {};\n\t\t\t\t}\n\t\t\t\tthis.versionedBufferLengths[output.mime][this.versionId] = output.data.byteLength;\n\t\t\t}\n\t\t});\n\t}\n\n\t// mime: versionId: buffer length\n\tprivate versionedBufferLengths: Record<string, Record<number, number>> = {};\n\n\tappendedSinceVersion(versionId: number, mime: string): VSBuffer | undefined {\n\t\tconst bufferLength = this.versionedBufferLengths[mime]?.[versionId];\n\t\tconst output = this.outputs.find(output => output.mime === mime);\n\t\tif (bufferLength && output) {\n\t\t\treturn output.data.slice(bufferLength);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate optimizeOutputItems() {\n\t\tif (this.outputs.length > 1 && this.outputs.every(item => isTextStreamMime(item.mime))) {\n\t\t\t// Look for the mimes in the items, and keep track of their order.\n\t\t\t// Merge the streams into one output item, per mime type.\n\t\t\tconst mimeOutputs = new Map<string, Uint8Array[]>();\n\t\t\tconst mimeTypes: string[] = [];\n\t\t\tthis.outputs.forEach(item => {\n\t\t\t\tlet items: Uint8Array[];\n\t\t\t\tif (mimeOutputs.has(item.mime)) {\n\t\t\t\t\titems = mimeOutputs.get(item.mime)!;\n\t\t\t\t} else {\n\t\t\t\t\titems = [];\n\t\t\t\t\tmimeOutputs.set(item.mime, items);\n\t\t\t\t\tmimeTypes.push(item.mime);\n\t\t\t\t}\n\t\t\t\titems.push(item.data.buffer);\n\t\t\t});\n\t\t\tthis.outputs.length = 0;\n\t\t\tmimeTypes.forEach(mime => {\n\t\t\t\tconst compressionResult = compressOutputItemStreams(mimeOutputs.get(mime)!);\n\t\t\t\tthis.outputs.push({\n\t\t\t\t\tmime,\n\t\t\t\t\tdata: compressionResult.data\n\t\t\t\t});\n\t\t\t\tif (compressionResult.didCompression) {\n\t\t\t\t\t// we can't rely on knowing buffer lengths if we've erased previous lines\n\t\t\t\t\tthis.versionedBufferLengths = {};\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tasDto(): IOutputDto {\n\t\treturn {\n\t\t\t// data: this._data,\n\t\t\tmetadata: this._rawOutput.metadata,\n\t\t\toutputs: this._rawOutput.outputs,\n\t\t\toutputId: this._rawOutput.outputId\n\t\t};\n\t}\n\n\tbumpVersion() {\n\t\tthis._versionId = this._versionId + 1;\n\t}\n\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}