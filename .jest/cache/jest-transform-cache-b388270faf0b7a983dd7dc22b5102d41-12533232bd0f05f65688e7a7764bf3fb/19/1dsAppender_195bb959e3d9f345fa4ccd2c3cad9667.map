{"version":3,"names":["cov_kq0gkecn4","actualCoverage","streamToBuffer","CancellationToken","AbstractOneDataSystemAppender","makeTelemetryRequest","options","requestService","f","response","s","request","None","responseData","stream","toString","statusCode","b","res","headers","makeLegacyTelemetryRequest","https","httpsOptions","method","type","responsePromise","Promise","resolve","reject","req","url","on","err","write","data","end","sendPostAsync","payload","oncomplete","telemetryRequestData","TextDecoder","decode","requestOptions","Buffer","byteLength","urlString","OneDataSystemAppender","constructor","isInternalTelemetry","eventPrefix","defaultData","iKeyOrClientFactory","customHttpXHROverride","sendPOST"],"sources":["/home/user/Desktop/MintMind/src/vs/platform/telemetry/node/1dsAppender.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IPayloadData, IXHROverride } from '@microsoft/1ds-post-js';\nimport { streamToBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IRequestOptions } from '../../../base/parts/request/common/request.js';\nimport { IRequestService } from '../../request/common/request.js';\nimport { AbstractOneDataSystemAppender, IAppInsightsCore } from '../common/1dsAppender.js';\n\ntype OnCompleteFunc = (status: number, headers: { [headerName: string]: string }, response?: string) => void;\n\ninterface IResponseData {\n\theaders: { [headerName: string]: string };\n\tstatusCode: number;\n\tresponseData: string;\n}\n\n/**\n * Completes a request to submit telemetry to the server utilizing the request service\n * @param options The options which will be used to make the request\n * @param requestService The request service\n * @returns An object containing the headers, statusCode, and responseData\n */\nasync function makeTelemetryRequest(options: IRequestOptions, requestService: IRequestService): Promise<IResponseData> {\n\tconst response = await requestService.request(options, CancellationToken.None);\n\tconst responseData = (await streamToBuffer(response.stream)).toString();\n\tconst statusCode = response.res.statusCode ?? 200;\n\tconst headers = response.res.headers as Record<string, any>;\n\treturn {\n\t\theaders,\n\t\tstatusCode,\n\t\tresponseData\n\t};\n}\n\n/**\n * Complete a request to submit telemetry to the server utilizing the https module. Only used when the request service is not available\n * @param options The options which will be used to make the request\n * @returns An object containing the headers, statusCode, and responseData\n */\nasync function makeLegacyTelemetryRequest(options: IRequestOptions): Promise<IResponseData> {\n\tconst https = await import('https'); // Lazy due to https://github.com/nodejs/node/issues/59686\n\tconst httpsOptions = {\n\t\tmethod: options.type,\n\t\theaders: options.headers\n\t};\n\tconst responsePromise = new Promise<IResponseData>((resolve, reject) => {\n\t\tconst req = https.request(options.url ?? '', httpsOptions, res => {\n\t\t\tres.on('data', function (responseData) {\n\t\t\t\tresolve({\n\t\t\t\t\theaders: res.headers as Record<string, any>,\n\t\t\t\t\tstatusCode: res.statusCode ?? 200,\n\t\t\t\t\tresponseData: responseData.toString()\n\t\t\t\t});\n\t\t\t});\n\t\t\t// On response with error send status of 0 and a blank response to oncomplete so we can retry events\n\t\t\tres.on('error', function (err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t\treq.write(options.data, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t\treq.end();\n\t});\n\treturn responsePromise;\n}\n\nasync function sendPostAsync(requestService: IRequestService | undefined, payload: IPayloadData, oncomplete: OnCompleteFunc) {\n\tconst telemetryRequestData = typeof payload.data === 'string' ? payload.data : new TextDecoder().decode(payload.data);\n\tconst requestOptions: IRequestOptions = {\n\t\ttype: 'POST',\n\t\theaders: {\n\t\t\t...payload.headers,\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Content-Length': Buffer.byteLength(payload.data).toString()\n\t\t},\n\t\turl: payload.urlString,\n\t\tdata: telemetryRequestData\n\t};\n\n\ttry {\n\t\tconst responseData = requestService ? await makeTelemetryRequest(requestOptions, requestService) : await makeLegacyTelemetryRequest(requestOptions);\n\t\toncomplete(responseData.statusCode, responseData.headers, responseData.responseData);\n\t} catch {\n\t\t// If it errors out, send status of 0 and a blank response to oncomplete so we can retry events\n\t\toncomplete(0, {});\n\t}\n}\n\n\nexport class OneDataSystemAppender extends AbstractOneDataSystemAppender {\n\n\tconstructor(\n\t\trequestService: IRequestService | undefined,\n\t\tisInternalTelemetry: boolean,\n\t\teventPrefix: string,\n\t\tdefaultData: { [key: string]: any } | null,\n\t\tiKeyOrClientFactory: string | (() => IAppInsightsCore), // allow factory function for testing\n\t) {\n\t\t// Override the way events get sent since node doesn't have XHTMLRequest\n\t\tconst customHttpXHROverride: IXHROverride = {\n\t\t\tsendPOST: (payload: IPayloadData, oncomplete: OnCompleteFunc) => {\n\t\t\t\t// Fire off the async request without awaiting it\n\t\t\t\tsendPostAsync(requestService, payload, oncomplete);\n\t\t\t}\n\t\t};\n\n\t\tsuper(isInternalTelemetry, eventPrefix, defaultData, iKeyOrClientFactory, customHttpXHROverride);\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA4BO;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AA5BP;;;;AAMA,SAASE,cAAc,QAAQ,gCAAgC;AAC/D,SAASC,iBAAiB,QAAQ,sCAAsC;AAGxE,SAASC,6BAA6B,QAA0B,0BAA0B;AAU1F;;;;;;AAMA,eAAeC,oBAAoBA,CAACC,OAAwB,EAAEC,cAA+B;EAAA;EAAAP,aAAA,GAAAQ,CAAA;EAC5F,MAAMC,QAAQ;EAAA;EAAA,CAAAT,aAAA,GAAAU,CAAA,OAAG,MAAMH,cAAc,CAACI,OAAO,CAACL,OAAO,EAAEH,iBAAiB,CAACS,IAAI,CAAC;EAC9E,MAAMC,YAAY;EAAA;EAAA,CAAAb,aAAA,GAAAU,CAAA,OAAG,CAAC,MAAMR,cAAc,CAACO,QAAQ,CAACK,MAAM,CAAC,EAAEC,QAAQ,EAAE;EACvE,MAAMC,UAAU;EAAA;EAAA,CAAAhB,aAAA,GAAAU,CAAA;EAAG;EAAA,CAAAV,aAAA,GAAAiB,CAAA,UAAAR,QAAQ,CAACS,GAAG,CAACF,UAAU;EAAA;EAAA,CAAAhB,aAAA,GAAAiB,CAAA,UAAI,GAAG;EACjD,MAAME,OAAO;EAAA;EAAA,CAAAnB,aAAA,GAAAU,CAAA,OAAGD,QAAQ,CAACS,GAAG,CAACC,OAA8B;EAAC;EAAAnB,aAAA,GAAAU,CAAA;EAC5D,OAAO;IACNS,OAAO;IACPH,UAAU;IACVH;GACA;AACF;AAEA;;;;;AAKA,eAAeO,0BAA0BA,CAACd,OAAwB;EAAA;EAAAN,aAAA,GAAAQ,CAAA;EACjE,MAAMa,KAAK;EAAA;EAAA,CAAArB,aAAA,GAAAU,CAAA,OAAG,MAAM,MAAM,CAAC,OAAO,CAAC,EAAC,CAAC;EACrC,MAAMY,YAAY;EAAA;EAAA,CAAAtB,aAAA,GAAAU,CAAA,OAAG;IACpBa,MAAM,EAAEjB,OAAO,CAACkB,IAAI;IACpBL,OAAO,EAAEb,OAAO,CAACa;GACjB;EACD,MAAMM,eAAe;EAAA;EAAA,CAAAzB,aAAA,GAAAU,CAAA,OAAG,IAAIgB,OAAO,CAAgB,CAACC,OAAO,EAAEC,MAAM,KAAI;IAAA;IAAA5B,aAAA,GAAAQ,CAAA;IACtE,MAAMqB,GAAG;IAAA;IAAA,CAAA7B,aAAA,GAAAU,CAAA,OAAGW,KAAK,CAACV,OAAO;IAAC;IAAA,CAAAX,aAAA,GAAAiB,CAAA,UAAAX,OAAO,CAACwB,GAAG;IAAA;IAAA,CAAA9B,aAAA,GAAAiB,CAAA,UAAI,EAAE,GAAEK,YAAY,EAAEJ,GAAG,IAAG;MAAA;MAAAlB,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAU,CAAA;MAChEQ,GAAG,CAACa,EAAE,CAAC,MAAM,EAAE,UAAUlB,YAAY;QAAA;QAAAb,aAAA,GAAAQ,CAAA;QAAAR,aAAA,GAAAU,CAAA;QACpCiB,OAAO,CAAC;UACPR,OAAO,EAAED,GAAG,CAACC,OAA8B;UAC3CH,UAAU;UAAE;UAAA,CAAAhB,aAAA,GAAAiB,CAAA,UAAAC,GAAG,CAACF,UAAU;UAAA;UAAA,CAAAhB,aAAA,GAAAiB,CAAA,UAAI,GAAG;UACjCJ,YAAY,EAAEA,YAAY,CAACE,QAAQ;SACnC,CAAC;MACH,CAAC,CAAC;MACF;MAAA;MAAAf,aAAA,GAAAU,CAAA;MACAQ,GAAG,CAACa,EAAE,CAAC,OAAO,EAAE,UAAUC,GAAG;QAAA;QAAAhC,aAAA,GAAAQ,CAAA;QAAAR,aAAA,GAAAU,CAAA;QAC5BkB,MAAM,CAACI,GAAG,CAAC;MACZ,CAAC,CAAC;IACH,CAAC,CAAC;IAAC;IAAAhC,aAAA,GAAAU,CAAA;IACHmB,GAAG,CAACI,KAAK,CAAC3B,OAAO,CAAC4B,IAAI,EAAGF,GAAG,IAAI;MAAA;MAAAhC,aAAA,GAAAQ,CAAA;MAAAR,aAAA,GAAAU,CAAA;MAC/B,IAAIsB,GAAG,EAAE;QAAA;QAAAhC,aAAA,GAAAiB,CAAA;QAAAjB,aAAA,GAAAU,CAAA;QACRkB,MAAM,CAACI,GAAG,CAAC;MACZ,CAAC;MAAA;MAAA;QAAAhC,aAAA,GAAAiB,CAAA;MAAA;IACF,CAAC,CAAC;IAAC;IAAAjB,aAAA,GAAAU,CAAA;IACHmB,GAAG,CAACM,GAAG,EAAE;EACV,CAAC,CAAC;EAAC;EAAAnC,aAAA,GAAAU,CAAA;EACH,OAAOe,eAAe;AACvB;AAEA,eAAeW,aAAaA,CAAC7B,cAA2C,EAAE8B,OAAqB,EAAEC,UAA0B;EAAA;EAAAtC,aAAA,GAAAQ,CAAA;EAC1H,MAAM+B,oBAAoB;EAAA;EAAA,CAAAvC,aAAA,GAAAU,CAAA,QAAG,OAAO2B,OAAO,CAACH,IAAI,KAAK,QAAQ;EAAA;EAAA,CAAAlC,aAAA,GAAAiB,CAAA,UAAGoB,OAAO,CAACH,IAAI;EAAA;EAAA,CAAAlC,aAAA,GAAAiB,CAAA,UAAG,IAAIuB,WAAW,EAAE,CAACC,MAAM,CAACJ,OAAO,CAACH,IAAI,CAAC;EACrH,MAAMQ,cAAc;EAAA;EAAA,CAAA1C,aAAA,GAAAU,CAAA,QAAoB;IACvCc,IAAI,EAAE,MAAM;IACZL,OAAO,EAAE;MACR,GAAGkB,OAAO,CAAClB,OAAO;MAClB,cAAc,EAAE,kBAAkB;MAClC,gBAAgB,EAAEwB,MAAM,CAACC,UAAU,CAACP,OAAO,CAACH,IAAI,CAAC,CAACnB,QAAQ;KAC1D;IACDe,GAAG,EAAEO,OAAO,CAACQ,SAAS;IACtBX,IAAI,EAAEK;GACN;EAAC;EAAAvC,aAAA,GAAAU,CAAA;EAEF,IAAI;IACH,MAAMG,YAAY;IAAA;IAAA,CAAAb,aAAA,GAAAU,CAAA,QAAGH,cAAc;IAAA;IAAA,CAAAP,aAAA,GAAAiB,CAAA,UAAG,MAAMZ,oBAAoB,CAACqC,cAAc,EAAEnC,cAAc,CAAC;IAAA;IAAA,CAAAP,aAAA,GAAAiB,CAAA,UAAG,MAAMG,0BAA0B,CAACsB,cAAc,CAAC;IAAC;IAAA1C,aAAA,GAAAU,CAAA;IACpJ4B,UAAU,CAACzB,YAAY,CAACG,UAAU,EAAEH,YAAY,CAACM,OAAO,EAAEN,YAAY,CAACA,YAAY,CAAC;EACrF,CAAC,CAAC,MAAM;IAAA;IAAAb,aAAA,GAAAU,CAAA;IACP;IACA4B,UAAU,CAAC,CAAC,EAAE,EAAE,CAAC;EAClB;AACD;AAGA,OAAM,MAAOQ,qBAAsB,SAAQ1C,6BAA6B;EAEvE2C,YACCxC,cAA2C,EAC3CyC,mBAA4B,EAC5BC,WAAmB,EACnBC,WAA0C,EAC1CC,mBAAsD;IAAA;IAAAnD,aAAA,GAAAQ,CAAA;IAEtD;IACA,MAAM4C,qBAAqB;IAAA;IAAA,CAAApD,aAAA,GAAAU,CAAA,QAAiB;MAC3C2C,QAAQ,EAAEA,CAAChB,OAAqB,EAAEC,UAA0B,KAAI;QAAA;QAAAtC,aAAA,GAAAQ,CAAA;QAAAR,aAAA,GAAAU,CAAA;QAC/D;QACA0B,aAAa,CAAC7B,cAAc,EAAE8B,OAAO,EAAEC,UAAU,CAAC;MACnD;KACA;IAAC;IAAAtC,aAAA,GAAAU,CAAA;IAEF,KAAK,CAACsC,mBAAmB,EAAEC,WAAW,EAAEC,WAAW,EAAEC,mBAAmB,EAAEC,qBAAqB,CAAC;EACjG","ignoreList":[]}