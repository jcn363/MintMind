{"version":3,"names":["cov_1yoj1bz427","actualCoverage","strictEquals","BugIndicatingError","subtransaction","DebugNameData","DerivedWithSetter","DebugLocation","observableReducer","owner","options","f","s","observableReducerSettable","prevValue","undefined","hasValue","d","update","reader","changeSummary","b","initial","Function","newValue","changeTracker","disposeFinal","equalityComparer","value","tx","change","setValue","ofCaller"],"sources":["/home/user/Desktop/MintMind/src/vs/base/common/observableInternal/experimental/reducer.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EqualityComparer, strictEquals, BugIndicatingError } from '../commonFacade/deps.js';\nimport { IObservable, IObservableWithChange, ISettableObservable } from '../base.js';\nimport { subtransaction } from '../transaction.js';\nimport { IChangeTracker } from '../changeTracker.js';\nimport { DebugNameData, DebugOwner } from '../debugName.js';\nimport { DerivedWithSetter, IDerivedReader } from '../observables/derivedImpl.js';\nimport { DebugLocation } from '../debugLocation.js';\n\nexport interface IReducerOptions<T, TChangeSummary = void, TOutChange = void> {\n\t/**\n\t * Is called to create the initial value of the observable when it becomes observed.\n\t*/\n\tinitial: T | (() => T);\n\n\t/**\n\t * Is called to dispose the observable value when it is no longer observed.\n\t*/\n\tdisposeFinal?(value: T): void;\n\tchangeTracker?: IChangeTracker<TChangeSummary>;\n\tequalityComparer?: EqualityComparer<T>;\n\n\t/**\n\t * Applies the changes to the value.\n\t * Use `reader.reportChange` to report change details or to report a change if the same value is returned.\n\t*/\n\tupdate(reader: IDerivedReader<TOutChange>, previousValue: T, changes: TChangeSummary): T;\n}\n\n/**\n * Creates an observable value that is based on values and changes from other observables.\n * Additionally, a reducer can report how that state changed.\n*/\nexport function observableReducer<T, TInChanges, TOutChange = void>(owner: DebugOwner, options: IReducerOptions<T, TInChanges, TOutChange>): SimplifyObservableWithChange<T, TOutChange> {\n\t// eslint-disable-next-line local/code-no-any-casts\n\treturn observableReducerSettable<T, TInChanges, TOutChange>(owner, options) as any;\n}\n\n/**\n * Creates an observable value that is based on values and changes from other observables.\n * Additionally, a reducer can report how that state changed.\n*/\nexport function observableReducerSettable<T, TInChanges, TOutChange = void>(owner: DebugOwner, options: IReducerOptions<T, TInChanges, TOutChange>): ISettableObservable<T, TOutChange> {\n\tlet prevValue: T | undefined = undefined;\n\tlet hasValue = false;\n\n\tconst d = new DerivedWithSetter(\n\t\tnew DebugNameData(owner, undefined, options.update),\n\t\t(reader: IDerivedReader<TOutChange>, changeSummary) => {\n\t\t\tif (!hasValue) {\n\t\t\t\tprevValue = options.initial instanceof Function ? options.initial() : options.initial;\n\t\t\t\thasValue = true;\n\t\t\t}\n\t\t\tconst newValue = options.update(reader, prevValue!, changeSummary);\n\t\t\tprevValue = newValue;\n\t\t\treturn newValue;\n\t\t},\n\t\toptions.changeTracker,\n\t\t() => {\n\t\t\tif (hasValue) {\n\t\t\t\toptions.disposeFinal?.(prevValue!);\n\t\t\t\thasValue = false;\n\t\t\t}\n\t\t},\n\t\toptions.equalityComparer ?? strictEquals,\n\t\t(value, tx, change) => {\n\t\t\tif (!hasValue) {\n\t\t\t\tthrow new BugIndicatingError('Can only set when there is a listener! This is to prevent leaks.');\n\t\t\t}\n\t\t\tsubtransaction(tx, tx => {\n\t\t\t\tprevValue = value;\n\t\t\t\td.setValue(value, tx, change);\n\t\t\t});\n\t\t},\n\t\tDebugLocation.ofCaller()\n\t);\n\n\treturn d;\n}\n\n/**\n * Returns IObservable<T> if TChange is void, otherwise IObservableWithChange<T, TChange>\n*/\ntype SimplifyObservableWithChange<T, TChange> = TChange extends void ? IObservable<T> : IObservableWithChange<T, TChange>;\n"],"mappings":"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","ignoreList":[]}