{"version":3,"names":["cov_yg5670qex","actualCoverage","SimpleTypedRpcConnection","_channelFactory","_getHandler","createHost","channelFactory","getHandler","f","s","createClient","api","_channel","constructor","handleNotification","notificationData","m","fn","notifications","b","Error","handleRequest","requestData","result","requests","type","value","e","Proxy","get","target","key","args","sendRequest","sendNotification"],"sources":["/home/user/Desktop/MintMind/src/vs/base/common/observableInternal/logging/debugger/rpc.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport type ChannelFactory = (handler: IChannelHandler) => IChannel;\n\nexport interface IChannel {\n\tsendNotification(data: unknown): void;\n\tsendRequest(data: unknown): Promise<RpcRequestResult>;\n}\n\nexport interface IChannelHandler {\n\thandleNotification(notificationData: unknown): void;\n\thandleRequest(requestData: unknown): Promise<RpcRequestResult> | RpcRequestResult;\n}\n\nexport type RpcRequestResult = { type: 'result'; value: unknown } | { type: 'error'; value: unknown };\n\nexport type API = {\n\thost: Side;\n\tclient: Side;\n};\n\nexport type Side = {\n\tnotifications: Record<string, (...args: any[]) => void>;\n\trequests: Record<string, (...args: any[]) => Promise<unknown> | unknown>;\n};\n\ntype MakeAsyncIfNot<TFn> = TFn extends (...args: infer TArgs) => infer TResult ? TResult extends Promise<unknown> ? TFn : (...args: TArgs) => Promise<TResult> : never;\n\nexport type MakeSideAsync<T extends Side> = {\n\tnotifications: T['notifications'];\n\trequests: { [K in keyof T['requests']]: MakeAsyncIfNot<T['requests'][K]> };\n};\n\nexport class SimpleTypedRpcConnection<T extends Side> {\n\tpublic static createHost<T extends API>(channelFactory: ChannelFactory, getHandler: () => T['host']): SimpleTypedRpcConnection<MakeSideAsync<T['client']>> {\n\t\treturn new SimpleTypedRpcConnection(channelFactory, getHandler);\n\t}\n\n\tpublic static createClient<T extends API>(channelFactory: ChannelFactory, getHandler: () => T['client']): SimpleTypedRpcConnection<MakeSideAsync<T['host']>> {\n\t\treturn new SimpleTypedRpcConnection(channelFactory, getHandler);\n\t}\n\n\tpublic readonly api: T;\n\tprivate readonly _channel: IChannel;\n\n\tprivate constructor(\n\t\tprivate readonly _channelFactory: ChannelFactory,\n\t\tprivate readonly _getHandler: () => Side,\n\t) {\n\t\tthis._channel = this._channelFactory({\n\t\t\thandleNotification: (notificationData) => {\n\t\t\t\tconst m = notificationData as OutgoingMessage;\n\t\t\t\tconst fn = this._getHandler().notifications[m[0]];\n\t\t\t\tif (!fn) {\n\t\t\t\t\tthrow new Error(`Unknown notification \"${m[0]}\"!`);\n\t\t\t\t}\n\t\t\t\tfn(...m[1]);\n\t\t\t},\n\t\t\thandleRequest: (requestData) => {\n\t\t\t\tconst m = requestData as OutgoingMessage;\n\t\t\t\ttry {\n\t\t\t\t\tconst result = this._getHandler().requests[m[0]](...m[1]);\n\t\t\t\t\treturn { type: 'result', value: result };\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn { type: 'error', value: e };\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tconst requests = new Proxy({}, {\n\t\t\tget: (target, key: string) => {\n\t\t\t\treturn async (...args: any[]) => {\n\t\t\t\t\tconst result = await this._channel.sendRequest([key, args] satisfies OutgoingMessage);\n\t\t\t\t\tif (result.type === 'error') {\n\t\t\t\t\t\tthrow result.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn result.value;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\t\tconst notifications = new Proxy({}, {\n\t\t\tget: (target, key: string) => {\n\t\t\t\treturn (...args: any[]) => {\n\t\t\t\t\tthis._channel.sendNotification([key, args] satisfies OutgoingMessage);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tthis.api = { notifications: notifications, requests: requests } as any;\n\t}\n}\n\ntype OutgoingMessage = [\n\tmethod: string,\n\targs: unknown[],\n];\n"],"mappings":"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","ignoreList":[]}