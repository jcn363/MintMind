{"version":3,"names":["countChanges","changes","cov_hmi8h3yv","f","s","reduce","count","change","diff","get","identical","b","type","length","sortCellChanges","indexes","Map","forEach","c","i","set","sort","a","modifiedCellIndex","originalCellIndex","aIndex","bIndex"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/chat/browser/chatEditing/notebook/notebookCellChanges.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ISettableObservable, ObservablePromise } from '../../../../../../base/common/observable.js';\nimport { IDocumentDiff } from '../../../../../../editor/common/diff/documentDiffProvider.js';\nimport { DetailedLineRangeMapping } from '../../../../../../editor/common/diff/rangeMapping.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\n\n\n/**\n * This structure is used to represent the state of a Notebook document compared to the original.\n * Its similar to the IDocumentDiff object, that tells us what cells are unmodified, modified, inserted or deleted.\n *\n * All entries will contain a IDocumentDiff\n * Even when there are no changes, diff will contain the number of lines in the document.\n * This way we can always calculate the total number of lines in the document.\n */\nexport type ICellDiffInfo = |\n\t{\n\t\toriginalCellIndex: number;\n\t\tmodifiedCellIndex: number;\n\t\ttype: 'unchanged';\n\t} & IDocumentDiffWithModelsAndActions |\n\t{\n\t\toriginalCellIndex: number;\n\t\tmodifiedCellIndex: number;\n\t\ttype: 'modified';\n\t} & IDocumentDiffWithModelsAndActions |\n\t{\n\t\tmodifiedCellIndex: undefined;\n\t\toriginalCellIndex: number;\n\t\ttype: 'delete';\n\t} & IDocumentDiffWithModelsAndActions |\n\t{\n\t\tmodifiedCellIndex: number;\n\t\toriginalCellIndex: undefined;\n\t\ttype: 'insert';\n\t} & IDocumentDiffWithModelsAndActions;\n\n\n\ninterface IDocumentDiffWithModelsAndActions {\n\t/**\n\t * The changes between the original and modified document.\n\t */\n\tdiff: ISettableObservable<IDocumentDiff>;\n\t/**\n\t * The original model.\n\t * Cell text models load asynchronously, so this is an observable promise.\n\t */\n\toriginalModel: ObservablePromise<ITextModel>;\n\t/**\n\t * The modified model.\n\t * Cell text models load asynchronously, so this is an observable promise.\n\t */\n\tmodifiedModel: ObservablePromise<ITextModel>;\n\tkeep(changes: DetailedLineRangeMapping): Promise<boolean>;\n\tundo(changes: DetailedLineRangeMapping): Promise<boolean>;\n}\n\n\nexport function countChanges(changes: ICellDiffInfo[]): number {\n\treturn changes.reduce((count, change) => {\n\t\tconst diff = change.diff.get();\n\t\t// When we accept some of the cell insert/delete the items might still be in the list.\n\t\tif (diff.identical) {\n\t\t\treturn count;\n\t\t}\n\t\tswitch (change.type) {\n\t\t\tcase 'delete':\n\t\t\t\treturn count + 1; // We want to see 1 deleted entry in the pill for navigation\n\t\t\tcase 'insert':\n\t\t\t\treturn count + 1; // We want to see 1 new entry in the pill for navigation\n\t\t\tcase 'modified':\n\t\t\t\treturn count + diff.changes.length;\n\t\t\tdefault:\n\t\t\t\treturn count;\n\t\t}\n\t}, 0);\n\n}\n\nexport function sortCellChanges(changes: ICellDiffInfo[]): ICellDiffInfo[] {\n\tconst indexes = new Map<ICellDiffInfo, number>();\n\tchanges.forEach((c, i) => indexes.set(c, i));\n\treturn [...changes].sort((a, b) => {\n\t\t// For unchanged and modified, use modifiedCellIndex\n\t\tif ((a.type === 'unchanged' || a.type === 'modified') &&\n\t\t\t(b.type === 'unchanged' || b.type === 'modified')) {\n\t\t\treturn a.modifiedCellIndex - b.modifiedCellIndex;\n\t\t}\n\n\t\t// For delete entries, use originalCellIndex\n\t\tif (a.type === 'delete' && b.type === 'delete') {\n\t\t\treturn a.originalCellIndex - b.originalCellIndex;\n\t\t}\n\n\t\t// For insert entries, use modifiedCellIndex\n\t\tif (a.type === 'insert' && b.type === 'insert') {\n\t\t\treturn a.modifiedCellIndex - b.modifiedCellIndex;\n\t\t}\n\n\t\tif (a.type === 'delete' && b.type === 'insert') {\n\t\t\t// If the deleted cell comes before the inserted cell, we want the delete to come first\n\t\t\t// As this means the cell was deleted before it was inserted\n\t\t\t// We would like to see the deleted cell first in the list\n\t\t\t// Else in the UI it would look weird to see an inserted cell before a deleted cell,\n\t\t\t// When the users operation was to first delete the cell and then insert a new one\n\t\t\t// I.e. this is merely just a simple way to ensure we have a stable sort.\n\t\t\treturn indexes.get(a)! - indexes.get(b)!;\n\t\t}\n\t\tif (a.type === 'insert' && b.type === 'delete') {\n\t\t\t// If the deleted cell comes before the inserted cell, we want the delete to come first\n\t\t\t// As this means the cell was deleted before it was inserted\n\t\t\t// We would like to see the deleted cell first in the list\n\t\t\t// Else in the UI it would look weird to see an inserted cell before a deleted cell,\n\t\t\t// When the users operation was to first delete the cell and then insert a new one\n\t\t\t// I.e. this is merely just a simple way to ensure we have a stable sort.\n\t\t\treturn indexes.get(a)! - indexes.get(b)!;\n\t\t}\n\n\t\tif ((a.type === 'delete' && b.type !== 'insert') || (a.type !== 'insert' && b.type === 'delete')) {\n\t\t\treturn a.originalCellIndex - b.originalCellIndex;\n\t\t}\n\n\t\t// Mixed types: compare based on available indices\n\t\tconst aIndex = a.type === 'delete' ? a.originalCellIndex :\n\t\t\t(a.type === 'insert' ? a.modifiedCellIndex : a.modifiedCellIndex);\n\t\tconst bIndex = b.type === 'delete' ? b.originalCellIndex :\n\t\t\t(b.type === 'insert' ? b.modifiedCellIndex : b.modifiedCellIndex);\n\n\t\treturn aIndex - bIndex;\n\t});\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AA+DA,OAAM,SAAUA,YAAYA,CAACC,OAAwB;EAAA;EAAAC,YAAA,GAAAC,CAAA;EAAAD,YAAA,GAAAE,CAAA;EACpD,OAAOH,OAAO,CAACI,MAAM,CAAC,CAACC,KAAK,EAAEC,MAAM,KAAI;IAAA;IAAAL,YAAA,GAAAC,CAAA;IACvC,MAAMK,IAAI;IAAA;IAAA,CAAAN,YAAA,GAAAE,CAAA,OAAGG,MAAM,CAACC,IAAI,CAACC,GAAG,EAAE;IAC9B;IAAA;IAAAP,YAAA,GAAAE,CAAA;IACA,IAAII,IAAI,CAACE,SAAS,EAAE;MAAA;MAAAR,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MACnB,OAAOE,KAAK;IACb,CAAC;IAAA;IAAA;MAAAJ,YAAA,GAAAS,CAAA;IAAA;IAAAT,YAAA,GAAAE,CAAA;IACD,QAAQG,MAAM,CAACK,IAAI;MAClB,KAAK,QAAQ;QAAA;QAAAV,YAAA,GAAAS,CAAA;QAAAT,YAAA,GAAAE,CAAA;QACZ,OAAOE,KAAK,GAAG,CAAC;MAAE;MACnB,KAAK,QAAQ;QAAA;QAAAJ,YAAA,GAAAS,CAAA;QAAAT,YAAA,GAAAE,CAAA;QACZ,OAAOE,KAAK,GAAG,CAAC;MAAE;MACnB,KAAK,UAAU;QAAA;QAAAJ,YAAA,GAAAS,CAAA;QAAAT,YAAA,GAAAE,CAAA;QACd,OAAOE,KAAK,GAAGE,IAAI,CAACP,OAAO,CAACY,MAAM;MACnC;QAAA;QAAAX,YAAA,GAAAS,CAAA;QAAAT,YAAA,GAAAE,CAAA;QACC,OAAOE,KAAK;IACd;EACD,CAAC,EAAE,CAAC,CAAC;AAEN;AAEA,OAAM,SAAUQ,eAAeA,CAACb,OAAwB;EAAA;EAAAC,YAAA,GAAAC,CAAA;EACvD,MAAMY,OAAO;EAAA;EAAA,CAAAb,YAAA,GAAAE,CAAA,OAAG,IAAIY,GAAG,EAAyB;EAAC;EAAAd,YAAA,GAAAE,CAAA;EACjDH,OAAO,CAACgB,OAAO,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;IAAA;IAAAjB,YAAA,GAAAC,CAAA;IAAAD,YAAA,GAAAE,CAAA;IAAA,OAAAW,OAAO,CAACK,GAAG,CAACF,CAAC,EAAEC,CAAC,CAAC;EAAD,CAAC,CAAC;EAAC;EAAAjB,YAAA,GAAAE,CAAA;EAC7C,OAAO,CAAC,GAAGH,OAAO,CAAC,CAACoB,IAAI,CAAC,CAACC,CAAC,EAAEX,CAAC,KAAI;IAAA;IAAAT,YAAA,GAAAC,CAAA;IAAAD,YAAA,GAAAE,CAAA;IACjC;IACA,IAAI;IAAC;IAAA,CAAAF,YAAA,GAAAS,CAAA,UAAAW,CAAC,CAACV,IAAI,KAAK,WAAW;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,UAAIW,CAAC,CAACV,IAAI,KAAK,UAAU;IAClD;IAAA,CAAAV,YAAA,GAAAS,CAAA,UAAAA,CAAC,CAACC,IAAI,KAAK,WAAW;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,UAAIA,CAAC,CAACC,IAAI,KAAK,UAAU,EAAC,EAAE;MAAA;MAAAV,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MACnD,OAAOkB,CAAC,CAACC,iBAAiB,GAAGZ,CAAC,CAACY,iBAAiB;IACjD,CAAC;IAAA;IAAA;MAAArB,YAAA,GAAAS,CAAA;IAAA;IAED;IAAAT,YAAA,GAAAE,CAAA;IACA;IAAI;IAAA,CAAAF,YAAA,GAAAS,CAAA,UAAAW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,UAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ,GAAE;MAAA;MAAAV,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MAC/C,OAAOkB,CAAC,CAACE,iBAAiB,GAAGb,CAAC,CAACa,iBAAiB;IACjD,CAAC;IAAA;IAAA;MAAAtB,YAAA,GAAAS,CAAA;IAAA;IAED;IAAAT,YAAA,GAAAE,CAAA;IACA;IAAI;IAAA,CAAAF,YAAA,GAAAS,CAAA,UAAAW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,UAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ,GAAE;MAAA;MAAAV,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MAC/C,OAAOkB,CAAC,CAACC,iBAAiB,GAAGZ,CAAC,CAACY,iBAAiB;IACjD,CAAC;IAAA;IAAA;MAAArB,YAAA,GAAAS,CAAA;IAAA;IAAAT,YAAA,GAAAE,CAAA;IAED;IAAI;IAAA,CAAAF,YAAA,GAAAS,CAAA,UAAAW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,UAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ,GAAE;MAAA;MAAAV,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MAC/C;MACA;MACA;MACA;MACA;MACA;MACA,OAAOW,OAAO,CAACN,GAAG,CAACa,CAAC,CAAE,GAAGP,OAAO,CAACN,GAAG,CAACE,CAAC,CAAE;IACzC,CAAC;IAAA;IAAA;MAAAT,YAAA,GAAAS,CAAA;IAAA;IAAAT,YAAA,GAAAE,CAAA;IACD;IAAI;IAAA,CAAAF,YAAA,GAAAS,CAAA,WAAAW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ,GAAE;MAAA;MAAAV,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MAC/C;MACA;MACA;MACA;MACA;MACA;MACA,OAAOW,OAAO,CAACN,GAAG,CAACa,CAAC,CAAE,GAAGP,OAAO,CAACN,GAAG,CAACE,CAAC,CAAE;IACzC,CAAC;IAAA;IAAA;MAAAT,YAAA,GAAAS,CAAA;IAAA;IAAAT,YAAA,GAAAE,CAAA;IAED;IAAK;IAAA,CAAAF,YAAA,GAAAS,CAAA,WAAAW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ;IAAM;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAAW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ,CAAC,EAAE;MAAA;MAAAV,YAAA,GAAAS,CAAA;MAAAT,YAAA,GAAAE,CAAA;MACjG,OAAOkB,CAAC,CAACE,iBAAiB,GAAGb,CAAC,CAACa,iBAAiB;IACjD,CAAC;IAAA;IAAA;MAAAtB,YAAA,GAAAS,CAAA;IAAA;IAED;IACA,MAAMc,MAAM;IAAA;IAAA,CAAAvB,YAAA,GAAAE,CAAA,QAAGkB,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAGW,CAAC,CAACE,iBAAiB;IAAA;IAAA,CAAAtB,YAAA,GAAAS,CAAA,WACtDW,CAAC,CAACV,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAGW,CAAC,CAACC,iBAAiB;IAAA;IAAA,CAAArB,YAAA,GAAAS,CAAA,WAAGW,CAAC,CAACC,iBAAiB,EAAC;IAClE,MAAMG,MAAM;IAAA;IAAA,CAAAxB,YAAA,GAAAE,CAAA,QAAGO,CAAC,CAACC,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAGA,CAAC,CAACa,iBAAiB;IAAA;IAAA,CAAAtB,YAAA,GAAAS,CAAA,WACtDA,CAAC,CAACC,IAAI,KAAK,QAAQ;IAAA;IAAA,CAAAV,YAAA,GAAAS,CAAA,WAAGA,CAAC,CAACY,iBAAiB;IAAA;IAAA,CAAArB,YAAA,GAAAS,CAAA,WAAGA,CAAC,CAACY,iBAAiB,EAAC;IAAC;IAAArB,YAAA,GAAAE,CAAA;IAEnE,OAAOqB,MAAM,GAAGC,MAAM;EACvB,CAAC,CAAC;AACH","ignoreList":[]}