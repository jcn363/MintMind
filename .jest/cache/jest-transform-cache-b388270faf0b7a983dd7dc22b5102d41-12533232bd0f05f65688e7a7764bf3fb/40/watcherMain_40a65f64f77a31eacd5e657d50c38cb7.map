{"version":3,"names":["cov_261ncy6xo5","actualCoverage","ProxyChannel","Server","ChildProcessServer","UtilityProcessServer","isUtilityProcess","FileAccess","spawn","readline","UniversalWatcherProxy","DisposableStore","JSONRPCClient","child","nextId","s","pendingRequests","Map","onNotification","constructor","command","args","options","f","stdio","b","stdout","stdin","Error","rl","createInterface","input","output","on","line","decoded","Buffer","from","toString","message","JSON","parse","id","result","error","pending","get","delete","reject","resolve","method","params","e","setOnNotification","handler","call","request","jsonrpc","encoded","stringify","write","Promise","set","dispose","kill","server","process","rustBinaryPath","getWatcherRustBinaryPath","service","env","basePath","asFileUri","fsPath","require","join","__dirname","platform","registerChannel","fromService"],"sources":["/home/user/Desktop/MintMind/src/vs/platform/files/node/watcher/watcherMain.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ProxyChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { Server as ChildProcessServer } from '../../../../base/parts/ipc/node/ipc.cp.js';\nimport { Server as UtilityProcessServer } from '../../../../base/parts/ipc/node/ipc.mp.js';\nimport { isUtilityProcess } from '../../../../base/parts/sandbox/node/electronTypes.js';\nimport { FileAccess } from '../../../../base/common/network.js';\nimport { spawn, SpawnOptions, ChildProcess } from 'child_process';\nimport * as readline from 'readline';\nimport { UniversalWatcherProxy } from './universalWatcherProxy.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\n\nexport class JSONRPCClient {\n\tprivate child: ChildProcess;\n\tprivate nextId = 1;\n\tprivate pendingRequests = new Map<number, { resolve: (value: unknown) => void; reject: (error: unknown) => void }>();\n\tprivate onNotification?: (method: string, params: unknown) => void;\n\t\n\t\tconstructor(command: string, args: string[], options: SpawnOptions) {\n\t\t\tthis.child = spawn(command, args, { ...options, stdio: ['pipe', 'pipe', 'pipe'] })!;\n\t\t\tif (!this.child.stdout || !this.child.stdin) {\n\t\t\t\tthrow new Error('Child process stdio not properly configured');\n\t\t\t}\n\t\t\tconst rl = readline.createInterface({ input: this.child.stdout, output: this.child.stdin });\n\t\trl.on('line', (line) => {\n\t\t\ttry {\n\t\t\t\tconst decoded = Buffer.from(line, 'base64').toString('utf8');\n\t\t\t\tconst message = JSON.parse(decoded);\n\t\t\t\tif ('id' in message) {\n\t\t\t\t\t// response\n\t\t\t\t\tconst { id, result, error } = message;\n\t\t\t\t\tconst pending = this.pendingRequests.get(id);\n\t\t\t\t\tif (pending) {\n\t\t\t\t\t\tthis.pendingRequests.delete(id);\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\tpending.reject(new Error(error.message));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpending.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// notification\n\t\t\t\t\tconst { method, params } = message;\n\t\t\t\t\tthis.onNotification?.(method, params);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// ignore invalid messages\n\t\t\t}\n\t\t});\n\t}\n\n\tsetOnNotification(handler: (method: string, params: unknown) => void) {\n\t\tthis.onNotification = handler;\n\t}\n\n\tasync call(method: string, params?: unknown): Promise<unknown> {\n\t\tconst id = this.nextId++;\n\t\tconst request = { jsonrpc: '2.0', id, method, params };\n\t\tconst encoded = Buffer.from(JSON.stringify(request)).toString('base64');\n\t\tif (this.child.stdin) {\n\t\t\tthis.child.stdin.write(encoded + '\\n');\n\t\t}\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.pendingRequests.set(id, { resolve, reject });\n\t\t});\n\t}\n\n\tdispose(): void {\n\t\tthis.child.kill();\n\t}\n}\n\n\nlet server: ChildProcessServer<string> | UtilityProcessServer;\nif (isUtilityProcess(process)) {\n\tserver = new UtilityProcessServer();\n} else {\n\tserver = new ChildProcessServer('watcher');\n}\n\nconst rustBinaryPath = getWatcherRustBinaryPath();\nconst service = new UniversalWatcherProxy(rustBinaryPath, process.env as Record<string, string>);\n\nfunction getWatcherRustBinaryPath(): string {\n\t// Use robust platform-specific path resolution for the Rust watcher binary\n\tlet basePath: string;\n\ttry {\n\t\tbasePath = FileAccess.asFileUri('vs/code/electron-main/watcher-rust').fsPath;\n\t} catch {\n\t\t// Fallback for development environments\n\t\tbasePath = require('path').join(__dirname, '..', '..', '..', 'code', 'electron-main', 'watcher-rust');\n\t}\n\n\t// Add platform-specific extension if needed\n\tif (process.platform === 'win32') {\n\t\treturn basePath + '.exe';\n\t}\n\treturn basePath;\n}\nserver.registerChannel('watcher', ProxyChannel.fromService(service, new DisposableStore()));\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAiBe;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAjBf;;;;AAKA,SAASE,YAAY,QAAQ,0CAA0C;AACvE,SAASC,MAAM,IAAIC,kBAAkB,QAAQ,2CAA2C;AACxF,SAASD,MAAM,IAAIE,oBAAoB,QAAQ,2CAA2C;AAC1F,SAASC,gBAAgB,QAAQ,sDAAsD;AACvF,SAASC,UAAU,QAAQ,oCAAoC;AAC/D,SAASC,KAAK,QAAoC,eAAe;AACjE,OAAO,KAAKC,QAAQ,MAAM,UAAU;AACpC,SAASC,qBAAqB,QAAQ,4BAA4B;AAClE,SAASC,eAAe,QAAQ,sCAAsC;AAEtE,OAAM,MAAOC,aAAa;EACjBC,KAAK;EACLC,MAAM;EAAA;EAAA,CAAAd,cAAA,GAAAe,CAAA,OAAG,CAAC;EACVC,eAAe;EAAA;EAAA,CAAAhB,cAAA,GAAAe,CAAA,OAAG,IAAIE,GAAG,EAAmF;EAC5GC,cAAc;EAErBC,YAAYC,OAAe,EAAEC,IAAc,EAAEC,OAAqB;IAAA;IAAAtB,cAAA,GAAAuB,CAAA;IAAAvB,cAAA,GAAAe,CAAA;IACjE,IAAI,CAACF,KAAK,GAAGL,KAAK,CAACY,OAAO,EAAEC,IAAI,EAAE;MAAE,GAAGC,OAAO;MAAEE,KAAK,EAAE,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM;IAAC,CAAE,CAAE;IAAC;IAAAxB,cAAA,GAAAe,CAAA;IACpF;IAAI;IAAA,CAAAf,cAAA,GAAAyB,CAAA,WAAC,IAAI,CAACZ,KAAK,CAACa,MAAM;IAAA;IAAA,CAAA1B,cAAA,GAAAyB,CAAA,UAAI,CAAC,IAAI,CAACZ,KAAK,CAACc,KAAK,GAAE;MAAA;MAAA3B,cAAA,GAAAyB,CAAA;MAAAzB,cAAA,GAAAe,CAAA;MAC5C,MAAM,IAAIa,KAAK,CAAC,6CAA6C,CAAC;IAC/D,CAAC;IAAA;IAAA;MAAA5B,cAAA,GAAAyB,CAAA;IAAA;IACD,MAAMI,EAAE;IAAA;IAAA,CAAA7B,cAAA,GAAAe,CAAA,OAAGN,QAAQ,CAACqB,eAAe,CAAC;MAAEC,KAAK,EAAE,IAAI,CAAClB,KAAK,CAACa,MAAM;MAAEM,MAAM,EAAE,IAAI,CAACnB,KAAK,CAACc;IAAK,CAAE,CAAC;IAAC;IAAA3B,cAAA,GAAAe,CAAA;IAC7Fc,EAAE,CAACI,EAAE,CAAC,MAAM,EAAGC,IAAI,IAAI;MAAA;MAAAlC,cAAA,GAAAuB,CAAA;MAAAvB,cAAA,GAAAe,CAAA;MACtB,IAAI;QACH,MAAMoB,OAAO;QAAA;QAAA,CAAAnC,cAAA,GAAAe,CAAA,OAAGqB,MAAM,CAACC,IAAI,CAACH,IAAI,EAAE,QAAQ,CAAC,CAACI,QAAQ,CAAC,MAAM,CAAC;QAC5D,MAAMC,OAAO;QAAA;QAAA,CAAAvC,cAAA,GAAAe,CAAA,OAAGyB,IAAI,CAACC,KAAK,CAACN,OAAO,CAAC;QAAC;QAAAnC,cAAA,GAAAe,CAAA;QACpC,IAAI,IAAI,IAAIwB,OAAO,EAAE;UAAA;UAAAvC,cAAA,GAAAyB,CAAA;UACpB;UACA,MAAM;YAAEiB,EAAE;YAAEC,MAAM;YAAEC;UAAK,CAAE;UAAA;UAAA,CAAA5C,cAAA,GAAAe,CAAA,QAAGwB,OAAO;UACrC,MAAMM,OAAO;UAAA;UAAA,CAAA7C,cAAA,GAAAe,CAAA,QAAG,IAAI,CAACC,eAAe,CAAC8B,GAAG,CAACJ,EAAE,CAAC;UAAC;UAAA1C,cAAA,GAAAe,CAAA;UAC7C,IAAI8B,OAAO,EAAE;YAAA;YAAA7C,cAAA,GAAAyB,CAAA;YAAAzB,cAAA,GAAAe,CAAA;YACZ,IAAI,CAACC,eAAe,CAAC+B,MAAM,CAACL,EAAE,CAAC;YAAC;YAAA1C,cAAA,GAAAe,CAAA;YAChC,IAAI6B,KAAK,EAAE;cAAA;cAAA5C,cAAA,GAAAyB,CAAA;cAAAzB,cAAA,GAAAe,CAAA;cACV8B,OAAO,CAACG,MAAM,CAAC,IAAIpB,KAAK,CAACgB,KAAK,CAACL,OAAO,CAAC,CAAC;YACzC,CAAC,MAAM;cAAA;cAAAvC,cAAA,GAAAyB,CAAA;cAAAzB,cAAA,GAAAe,CAAA;cACN8B,OAAO,CAACI,OAAO,CAACN,MAAM,CAAC;YACxB;UACD,CAAC;UAAA;UAAA;YAAA3C,cAAA,GAAAyB,CAAA;UAAA;QACF,CAAC,MAAM;UAAA;UAAAzB,cAAA,GAAAyB,CAAA;UACN;UACA,MAAM;YAAEyB,MAAM;YAAEC;UAAM,CAAE;UAAA;UAAA,CAAAnD,cAAA,GAAAe,CAAA,QAAGwB,OAAO;UAAC;UAAAvC,cAAA,GAAAe,CAAA;UACnC,IAAI,CAACG,cAAc,GAAGgC,MAAM,EAAEC,MAAM,CAAC;QACtC;MACD,CAAC,CAAC,OAAOC,CAAC,EAAE;QACX;MAAA;IAEF,CAAC,CAAC;EACH;EAEAC,iBAAiBA,CAACC,OAAkD;IAAA;IAAAtD,cAAA,GAAAuB,CAAA;IAAAvB,cAAA,GAAAe,CAAA;IACnE,IAAI,CAACG,cAAc,GAAGoC,OAAO;EAC9B;EAEA,MAAMC,IAAIA,CAACL,MAAc,EAAEC,MAAgB;IAAA;IAAAnD,cAAA,GAAAuB,CAAA;IAC1C,MAAMmB,EAAE;IAAA;IAAA,CAAA1C,cAAA,GAAAe,CAAA,QAAG,IAAI,CAACD,MAAM,EAAE;IACxB,MAAM0C,OAAO;IAAA;IAAA,CAAAxD,cAAA,GAAAe,CAAA,QAAG;MAAE0C,OAAO,EAAE,KAAK;MAAEf,EAAE;MAAEQ,MAAM;MAAEC;IAAM,CAAE;IACtD,MAAMO,OAAO;IAAA;IAAA,CAAA1D,cAAA,GAAAe,CAAA,QAAGqB,MAAM,CAACC,IAAI,CAACG,IAAI,CAACmB,SAAS,CAACH,OAAO,CAAC,CAAC,CAAClB,QAAQ,CAAC,QAAQ,CAAC;IAAC;IAAAtC,cAAA,GAAAe,CAAA;IACxE,IAAI,IAAI,CAACF,KAAK,CAACc,KAAK,EAAE;MAAA;MAAA3B,cAAA,GAAAyB,CAAA;MAAAzB,cAAA,GAAAe,CAAA;MACrB,IAAI,CAACF,KAAK,CAACc,KAAK,CAACiC,KAAK,CAACF,OAAO,GAAG,IAAI,CAAC;IACvC,CAAC;IAAA;IAAA;MAAA1D,cAAA,GAAAyB,CAAA;IAAA;IAAAzB,cAAA,GAAAe,CAAA;IACD,OAAO,IAAI8C,OAAO,CAAC,CAACZ,OAAO,EAAED,MAAM,KAAI;MAAA;MAAAhD,cAAA,GAAAuB,CAAA;MAAAvB,cAAA,GAAAe,CAAA;MACtC,IAAI,CAACC,eAAe,CAAC8C,GAAG,CAACpB,EAAE,EAAE;QAAEO,OAAO;QAAED;MAAM,CAAE,CAAC;IAClD,CAAC,CAAC;EACH;EAEAe,OAAOA,CAAA;IAAA;IAAA/D,cAAA,GAAAuB,CAAA;IAAAvB,cAAA,GAAAe,CAAA;IACN,IAAI,CAACF,KAAK,CAACmD,IAAI,EAAE;EAClB;;AAID,IAAIC,MAAyD;AAAC;AAAAjE,cAAA,GAAAe,CAAA;AAC9D,IAAIT,gBAAgB,CAAC4D,OAAO,CAAC,EAAE;EAAA;EAAAlE,cAAA,GAAAyB,CAAA;EAAAzB,cAAA,GAAAe,CAAA;EAC9BkD,MAAM,GAAG,IAAI5D,oBAAoB,EAAE;AACpC,CAAC,MAAM;EAAA;EAAAL,cAAA,GAAAyB,CAAA;EAAAzB,cAAA,GAAAe,CAAA;EACNkD,MAAM,GAAG,IAAI7D,kBAAkB,CAAC,SAAS,CAAC;AAC3C;AAEA,MAAM+D,cAAc;AAAA;AAAA,CAAAnE,cAAA,GAAAe,CAAA,QAAGqD,wBAAwB,EAAE;AACjD,MAAMC,OAAO;AAAA;AAAA,CAAArE,cAAA,GAAAe,CAAA,QAAG,IAAIL,qBAAqB,CAACyD,cAAc,EAAED,OAAO,CAACI,GAA6B,CAAC;AAEhG,SAASF,wBAAwBA,CAAA;EAAA;EAAApE,cAAA,GAAAuB,CAAA;EAChC;EACA,IAAIgD,QAAgB;EAAC;EAAAvE,cAAA,GAAAe,CAAA;EACrB,IAAI;IAAA;IAAAf,cAAA,GAAAe,CAAA;IACHwD,QAAQ,GAAGhE,UAAU,CAACiE,SAAS,CAAC,oCAAoC,CAAC,CAACC,MAAM;EAC7E,CAAC,CAAC,MAAM;IAAA;IAAAzE,cAAA,GAAAe,CAAA;IACP;IACAwD,QAAQ,GAAGG,OAAO,CAAC,MAAM,CAAC,CAACC,IAAI,CAACC,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,eAAe,EAAE,cAAc,CAAC;EACtG;EAEA;EAAA;EAAA5E,cAAA,GAAAe,CAAA;EACA,IAAImD,OAAO,CAACW,QAAQ,KAAK,OAAO,EAAE;IAAA;IAAA7E,cAAA,GAAAyB,CAAA;IAAAzB,cAAA,GAAAe,CAAA;IACjC,OAAOwD,QAAQ,GAAG,MAAM;EACzB,CAAC;EAAA;EAAA;IAAAvE,cAAA,GAAAyB,CAAA;EAAA;EAAAzB,cAAA,GAAAe,CAAA;EACD,OAAOwD,QAAQ;AAChB;AAAC;AAAAvE,cAAA,GAAAe,CAAA;AACDkD,MAAM,CAACa,eAAe,CAAC,SAAS,EAAE5E,YAAY,CAAC6E,WAAW,CAACV,OAAO,EAAE,IAAI1D,eAAe,EAAE,CAAC,CAAC","ignoreList":[]}