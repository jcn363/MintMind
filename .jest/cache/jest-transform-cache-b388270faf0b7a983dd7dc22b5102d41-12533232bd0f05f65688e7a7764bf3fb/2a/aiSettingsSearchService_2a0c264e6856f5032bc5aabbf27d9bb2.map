{"version":3,"names":["cov_g6tic3bzx","actualCoverage","DeferredPromise","raceCancellation","Emitter","Disposable","registerSingleton","AiSettingsSearchResultKind","IAiSettingsSearchService","AiSettingsSearchService","_serviceBrand","MAX_PICKS","s","_providers","_llmRankedResultsPromises","Map","_embeddingsResultsPromises","_onProviderRegistered","_register","onProviderRegistered","event","isEnabled","f","length","registerSettingsSearchProvider","provider","push","fire","dispose","index","indexOf","b","splice","startSearch","query","embeddingsOnly","token","Error","delete","forEach","searchSettings","limit","getEmbeddingsResults","existingPromise","get","result","p","promise","set","getLLMRankedResults","handleSearchResult","kind","EMBEDDED","complete","settings","parkedPromise","LLM_RANKED"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DeferredPromise, raceCancellation } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { AiSettingsSearchResult, AiSettingsSearchResultKind, IAiSettingsSearchProvider, IAiSettingsSearchService } from './aiSettingsSearch.js';\n\nexport class AiSettingsSearchService extends Disposable implements IAiSettingsSearchService {\n\treadonly _serviceBrand: undefined;\n\tprivate static readonly MAX_PICKS = 5;\n\n\tprivate _providers: IAiSettingsSearchProvider[] = [];\n\tprivate _llmRankedResultsPromises: Map<string, DeferredPromise<string[]>> = new Map();\n\tprivate _embeddingsResultsPromises: Map<string, DeferredPromise<string[]>> = new Map();\n\n\tprivate _onProviderRegistered: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onProviderRegistered: Event<void> = this._onProviderRegistered.event;\n\n\tisEnabled(): boolean {\n\t\treturn this._providers.length > 0;\n\t}\n\n\tregisterSettingsSearchProvider(provider: IAiSettingsSearchProvider): IDisposable {\n\t\tthis._providers.push(provider);\n\t\tthis._onProviderRegistered.fire();\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst index = this._providers.indexOf(provider);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis._providers.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tstartSearch(query: string, embeddingsOnly: boolean, token: CancellationToken): void {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tthis._embeddingsResultsPromises.delete(query);\n\t\tthis._llmRankedResultsPromises.delete(query);\n\n\t\tthis._providers.forEach(provider => provider.searchSettings(query, { limit: AiSettingsSearchService.MAX_PICKS, embeddingsOnly }, token));\n\t}\n\n\tasync getEmbeddingsResults(query: string, token: CancellationToken): Promise<string[] | null> {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tconst existingPromise = this._embeddingsResultsPromises.get(query);\n\t\tif (existingPromise) {\n\t\t\tconst result = await existingPromise.p;\n\t\t\treturn result ?? null;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<string[]>();\n\t\tthis._embeddingsResultsPromises.set(query, promise);\n\t\tconst result = await raceCancellation(promise.p, token);\n\t\treturn result ?? null;\n\t}\n\n\tasync getLLMRankedResults(query: string, token: CancellationToken): Promise<string[] | null> {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tconst existingPromise = this._llmRankedResultsPromises.get(query);\n\t\tif (existingPromise) {\n\t\t\tconst result = await existingPromise.p;\n\t\t\treturn result ?? null;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<string[]>();\n\t\tthis._llmRankedResultsPromises.set(query, promise);\n\t\tconst result = await raceCancellation(promise.p, token);\n\t\treturn result ?? null;\n\t}\n\n\thandleSearchResult(result: AiSettingsSearchResult): void {\n\t\tif (!this.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (result.kind === AiSettingsSearchResultKind.EMBEDDED) {\n\t\t\tconst promise = this._embeddingsResultsPromises.get(result.query);\n\t\t\tif (promise) {\n\t\t\t\tpromise.complete(result.settings);\n\t\t\t} else {\n\t\t\t\tconst parkedPromise = new DeferredPromise<string[]>();\n\t\t\t\tparkedPromise.complete(result.settings);\n\t\t\t\tthis._embeddingsResultsPromises.set(result.query, parkedPromise);\n\t\t\t}\n\t\t} else if (result.kind === AiSettingsSearchResultKind.LLM_RANKED) {\n\t\t\tconst promise = this._llmRankedResultsPromises.get(result.query);\n\t\t\tif (promise) {\n\t\t\t\tpromise.complete(result.settings);\n\t\t\t} else {\n\t\t\t\tconst parkedPromise = new DeferredPromise<string[]>();\n\t\t\t\tparkedPromise.complete(result.settings);\n\t\t\t\tthis._llmRankedResultsPromises.set(result.query, parkedPromise);\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterSingleton(IAiSettingsSearchService, AiSettingsSearchService, InstantiationType.Delayed);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}