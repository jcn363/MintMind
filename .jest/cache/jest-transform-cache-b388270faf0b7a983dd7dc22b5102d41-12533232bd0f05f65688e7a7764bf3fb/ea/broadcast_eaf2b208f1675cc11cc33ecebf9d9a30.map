{"version":3,"names":["cov_269gzskwuk","actualCoverage","mainWindow","getErrorMessage","Emitter","Disposable","toDisposable","BroadcastDataChannel","channelName","broadcastChannel","_onDidReceiveData","s","_register","onDidReceiveData","event","constructor","f","b","BroadcastChannel","listener","fire","data","addEventListener","removeEventListener","close","error","console","warn","createBroadcastChannel","key","newValue","JSON","parse","postData","postMessage","localStorage","removeItem","setItem","stringify"],"sources":["/home/user/Desktop/MintMind/src/vs/base/browser/broadcast.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mainWindow } from './window.js';\nimport { getErrorMessage } from '../common/errors.js';\nimport { Emitter } from '../common/event.js';\nimport { Disposable, toDisposable } from '../common/lifecycle.js';\n\nexport class BroadcastDataChannel<T> extends Disposable {\n\n\tprivate broadcastChannel: BroadcastChannel | undefined;\n\n\tprivate readonly _onDidReceiveData = this._register(new Emitter<T>());\n\treadonly onDidReceiveData = this._onDidReceiveData.event;\n\n\tconstructor(private readonly channelName: string) {\n\t\tsuper();\n\n\t\t// Use BroadcastChannel\n\t\tif ('BroadcastChannel' in mainWindow) {\n\t\t\ttry {\n\t\t\t\tthis.broadcastChannel = new BroadcastChannel(channelName);\n\t\t\t\tconst listener = (event: MessageEvent) => {\n\t\t\t\t\tthis._onDidReceiveData.fire(event.data);\n\t\t\t\t};\n\t\t\t\tthis.broadcastChannel.addEventListener('message', listener);\n\t\t\t\tthis._register(toDisposable(() => {\n\t\t\t\t\tif (this.broadcastChannel) {\n\t\t\t\t\t\tthis.broadcastChannel.removeEventListener('message', listener);\n\t\t\t\t\t\tthis.broadcastChannel.close();\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t} catch (error) {\n\t\t\t\tconsole.warn('Error while creating broadcast channel. Falling back to localStorage.', getErrorMessage(error));\n\t\t\t}\n\t\t}\n\n\t\t// BroadcastChannel is not supported. Use storage.\n\t\tif (!this.broadcastChannel) {\n\t\t\tthis.channelName = `BroadcastDataChannel.${channelName}`;\n\t\t\tthis.createBroadcastChannel();\n\t\t}\n\t}\n\n\tprivate createBroadcastChannel(): void {\n\t\tconst listener = (event: StorageEvent) => {\n\t\t\tif (event.key === this.channelName && event.newValue) {\n\t\t\t\tthis._onDidReceiveData.fire(JSON.parse(event.newValue));\n\t\t\t}\n\t\t};\n\t\tmainWindow.addEventListener('storage', listener);\n\t\tthis._register(toDisposable(() => mainWindow.removeEventListener('storage', listener)));\n\t}\n\n\t/**\n\t * Sends the data to other BroadcastChannel objects set up for this channel. Data can be structured objects, e.g. nested objects and arrays.\n\t * @param data data to broadcast\n\t */\n\tpostData(data: T): void {\n\t\tif (this.broadcastChannel) {\n\t\t\tthis.broadcastChannel.postMessage(data);\n\t\t} else {\n\t\t\t// remove previous changes so that event is triggered even if new changes are same as old changes\n\t\t\tlocalStorage.removeItem(this.channelName);\n\t\t\tlocalStorage.setItem(this.channelName, JSON.stringify(data));\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}