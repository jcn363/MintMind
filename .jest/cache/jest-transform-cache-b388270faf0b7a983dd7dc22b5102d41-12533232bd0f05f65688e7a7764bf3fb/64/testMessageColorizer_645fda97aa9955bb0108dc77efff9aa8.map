{"version":3,"names":["renderAsPlaintext","toDisposable","GraphemeIterator","forAnsiStringParts","removeAnsiEscapeCodes","Position","Range","colorAttrRe","cov_2ihpf47ybx","s","renderTestMessageAsText","tm","f","b","colorizeTestMessageInEditor","message","editor","decos","changeDecorations","changeAccessor","start","cls","part","isCode","colorAttr","exec","str","n","Number","length","filter","c","startsWith","push","line","lineNumber","col","column","graphemes","i","eol","nextGraphemeLength","end","addDecoration","fromPositions","inlineClassName","join","description","removeDecorations"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/testing/browser/testMessageColorizer.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderAsPlaintext } from '../../../../base/browser/markdownRenderer.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { GraphemeIterator, forAnsiStringParts, removeAnsiEscapeCodes } from '../../../../base/common/strings.js';\nimport './media/testMessageColorizer.css';\nimport { CodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { Range } from '../../../../editor/common/core/range.js';\n\nconst colorAttrRe = /^\\x1b\\[([0-9]+)m$/;\n\nconst enum Classes {\n\tPrefix = 'tstm-ansidec-',\n\tForegroundPrefix = Classes.Prefix + 'fg',\n\tBackgroundPrefix = Classes.Prefix + 'bg',\n\tBold = Classes.Prefix + '1',\n\tFaint = Classes.Prefix + '2',\n\tItalic = Classes.Prefix + '3',\n\tUnderline = Classes.Prefix + '4',\n}\n\nexport const renderTestMessageAsText = (tm: string | IMarkdownString) =>\n\ttypeof tm === 'string' ? removeAnsiEscapeCodes(tm) : renderAsPlaintext(tm);\n\n\n/**\n * Applies decorations based on ANSI styles from the test message in the editor.\n * ANSI sequences are stripped from the text displayed in editor, and this\n * re-applies their colorization.\n *\n * This uses decorations rather than language features because the string\n * rendered in the editor lacks the ANSI codes needed to actually apply the\n * colorization.\n *\n * Note: does not support TrueColor.\n */\nexport const colorizeTestMessageInEditor = (message: string, editor: CodeEditorWidget): IDisposable => {\n\tconst decos: string[] = [];\n\n\teditor.changeDecorations(changeAccessor => {\n\t\tlet start = new Position(1, 1);\n\t\tlet cls: string[] = [];\n\t\tfor (const part of forAnsiStringParts(message)) {\n\t\t\tif (part.isCode) {\n\t\t\t\tconst colorAttr = colorAttrRe.exec(part.str)?.[1];\n\t\t\t\tif (!colorAttr) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst n = Number(colorAttr);\n\t\t\t\tif (n === 0) {\n\t\t\t\t\tcls.length = 0;\n\t\t\t\t} else if (n === 22) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Bold && c !== Classes.Italic);\n\t\t\t\t} else if (n === 23) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Italic);\n\t\t\t\t} else if (n === 24) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Underline);\n\t\t\t\t} else if ((n >= 30 && n <= 39) || (n >= 90 && n <= 99)) {\n\t\t\t\t\tcls = cls.filter(c => !c.startsWith(Classes.ForegroundPrefix));\n\t\t\t\t\tcls.push(Classes.ForegroundPrefix + colorAttr);\n\t\t\t\t} else if ((n >= 40 && n <= 49) || (n >= 100 && n <= 109)) {\n\t\t\t\t\tcls = cls.filter(c => !c.startsWith(Classes.BackgroundPrefix));\n\t\t\t\t\tcls.push(Classes.BackgroundPrefix + colorAttr);\n\t\t\t\t} else {\n\t\t\t\t\tcls.push(Classes.Prefix + colorAttr);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet line = start.lineNumber;\n\t\t\t\tlet col = start.column;\n\n\t\t\t\tconst graphemes = new GraphemeIterator(part.str);\n\t\t\t\tfor (let i = 0; !graphemes.eol(); i += graphemes.nextGraphemeLength()) {\n\t\t\t\t\tif (part.str[i] === '\\n') {\n\t\t\t\t\t\tline++;\n\t\t\t\t\t\tcol = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcol++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst end = new Position(line, col);\n\t\t\t\tif (cls.length) {\n\t\t\t\t\tdecos.push(changeAccessor.addDecoration(Range.fromPositions(start, end), {\n\t\t\t\t\t\tinlineClassName: cls.join(' '),\n\t\t\t\t\t\tdescription: 'test-message-colorized',\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tstart = end;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn toDisposable(() => editor.removeDecorations(decos));\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}