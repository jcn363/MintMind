{"version":3,"names":["cov_29dhajbw6s","actualCoverage","Emitter","Event","Disposable","BaseStorageDatabaseClient","channel","profile","workspace","constructor","f","s","getItems","serializableRequest","items","call","Map","updateItems","request","insert","b","Array","from","entries","delete","values","optimize","BaseProfileAwareStorageDatabaseClient","_onDidChangeItemsExternal","_register","onDidChangeItemsExternal","event","undefined","registerListeners","listen","e","onDidChangeStorage","isArray","changed","deleted","fire","Set","ApplicationStorageDatabaseClient","close","dispose","ProfileStorageDatabaseClient","WorkspaceStorageDatabaseClient","None","StorageClient","isUsed","path","payload"],"sources":["/home/user/Desktop/MintMind/src/vs/platform/storage/common/storageIpc.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { UriDto } from '../../../base/common/uri.js';\nimport { IChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { IStorageDatabase, IStorageItemsChangeEvent, IUpdateRequest } from '../../../base/parts/storage/common/storage.js';\nimport { IUserDataProfile } from '../../userDataProfile/common/userDataProfile.js';\nimport { ISerializedSingleFolderWorkspaceIdentifier, ISerializedWorkspaceIdentifier, IEmptyWorkspaceIdentifier, IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\n\nexport type Key = string;\nexport type Value = string;\nexport type Item = [Key, Value];\n\nexport interface IBaseSerializableStorageRequest {\n\n\t/**\n\t * Profile to correlate storage. Only used when no\n\t * workspace is provided. Can be undefined to denote\n\t * application scope.\n\t */\n\treadonly profile: UriDto<IUserDataProfile> | undefined;\n\n\t/**\n\t * Workspace to correlate storage. Can be undefined to\n\t * denote application or profile scope depending on profile.\n\t */\n\treadonly workspace: ISerializedWorkspaceIdentifier | ISerializedSingleFolderWorkspaceIdentifier | IEmptyWorkspaceIdentifier | undefined;\n\n\t/**\n\t * Additional payload for the request to perform.\n\t */\n\treadonly payload?: unknown;\n}\n\nexport interface ISerializableUpdateRequest extends IBaseSerializableStorageRequest {\n\tinsert?: Item[];\n\tdelete?: Key[];\n}\n\nexport interface ISerializableItemsChangeEvent {\n\treadonly changed?: Item[];\n\treadonly deleted?: Key[];\n}\n\nabstract class BaseStorageDatabaseClient extends Disposable implements IStorageDatabase {\n\n\tabstract readonly onDidChangeItemsExternal: Event<IStorageItemsChangeEvent>;\n\n\tconstructor(\n\t\tprotected channel: IChannel,\n\t\tprotected profile: UriDto<IUserDataProfile> | undefined,\n\t\tprotected workspace: IAnyWorkspaceIdentifier | undefined\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getItems(): Promise<Map<string, string>> {\n\t\tconst serializableRequest: IBaseSerializableStorageRequest = { profile: this.profile, workspace: this.workspace };\n\t\tconst items: Item[] = await this.channel.call('getItems', serializableRequest);\n\n\t\treturn new Map(items);\n\t}\n\n\tupdateItems(request: IUpdateRequest): Promise<void> {\n\t\tconst serializableRequest: ISerializableUpdateRequest = { profile: this.profile, workspace: this.workspace };\n\n\t\tif (request.insert) {\n\t\t\tserializableRequest.insert = Array.from(request.insert.entries());\n\t\t}\n\n\t\tif (request.delete) {\n\t\t\tserializableRequest.delete = Array.from(request.delete.values());\n\t\t}\n\n\t\treturn this.channel.call('updateItems', serializableRequest);\n\t}\n\n\toptimize(): Promise<void> {\n\t\tconst serializableRequest: IBaseSerializableStorageRequest = { profile: this.profile, workspace: this.workspace };\n\n\t\treturn this.channel.call('optimize', serializableRequest);\n\t}\n\n\tabstract close(): Promise<void>;\n}\n\nabstract class BaseProfileAwareStorageDatabaseClient extends BaseStorageDatabaseClient {\n\n\tprivate readonly _onDidChangeItemsExternal = this._register(new Emitter<IStorageItemsChangeEvent>());\n\treadonly onDidChangeItemsExternal = this._onDidChangeItemsExternal.event;\n\n\tconstructor(channel: IChannel, profile: UriDto<IUserDataProfile> | undefined) {\n\t\tsuper(channel, profile, undefined);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.channel.listen<ISerializableItemsChangeEvent>('onDidChangeStorage', { profile: this.profile })((e: ISerializableItemsChangeEvent) => this.onDidChangeStorage(e)));\n\t}\n\n\tprivate onDidChangeStorage(e: ISerializableItemsChangeEvent): void {\n\t\tif (Array.isArray(e.changed) || Array.isArray(e.deleted)) {\n\t\t\tthis._onDidChangeItemsExternal.fire({\n\t\t\t\tchanged: e.changed ? new Map(e.changed) : undefined,\n\t\t\t\tdeleted: e.deleted ? new Set<string>(e.deleted) : undefined\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport class ApplicationStorageDatabaseClient extends BaseProfileAwareStorageDatabaseClient {\n\n\tconstructor(channel: IChannel) {\n\t\tsuper(channel, undefined);\n\t}\n\n\tasync close(): Promise<void> {\n\n\t\t// The application storage database is shared across all instances so\n\t\t// we do not close it from the window. However we dispose the\n\t\t// listener for external changes because we no longer interested in it.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class ProfileStorageDatabaseClient extends BaseProfileAwareStorageDatabaseClient {\n\n\tasync close(): Promise<void> {\n\n\t\t// The profile storage database is shared across all instances of\n\t\t// the same profile so we do not close it from the window.\n\t\t// However we dispose the listener for external changes because\n\t\t// we no longer interested in it.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class WorkspaceStorageDatabaseClient extends BaseStorageDatabaseClient implements IStorageDatabase {\n\n\treadonly onDidChangeItemsExternal = Event.None; // unsupported for workspace storage because we only ever write from one window\n\n\tconstructor(channel: IChannel, workspace: IAnyWorkspaceIdentifier) {\n\t\tsuper(channel, undefined, workspace);\n\t}\n\n\tasync close(): Promise<void> {\n\n\t\t// The workspace storage database is only used in this instance\n\t\t// but we do not need to close it from here, the main process\n\t\t// can take care of that.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class StorageClient {\n\n\tconstructor(private readonly channel: IChannel) { }\n\n\tisUsed(path: string): Promise<boolean> {\n\t\tconst serializableRequest: ISerializableUpdateRequest = { payload: path, profile: undefined, workspace: undefined };\n\n\t\treturn this.channel.call('isUsed', serializableRequest);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}