{"version":3,"names":["cov_1zmv9ucp7v","actualCoverage","isUNC","Schemas","normalize","sep","URI","FileOperationError","getWebviewContentMimeType","WebviewResourceResponse","s","f","Type","b","StreamSuccess","stream","etag","mtime","mimeType","type","Success","constructor","Failed","AccessDenied","NotModified","loadLocalResource","requestUri","options","fileService","logService","token","resourceToLoad","getResourceToLoad","roots","trace","mime","result","readFileStream","ifNoneMatch","value","err","fileOperationResult","error","root","containsResource","normalizeResourcePath","undefined","resource","scheme","resourceFsPath","fsPath","rootPath","endsWith","toLowerCase","startsWith","vscodeRemote","from","authority","path","query","JSON","stringify","requestResourcePath"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/webview/browser/resourceLoading.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { isUNC } from '../../../../base/common/extpath.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { normalize, sep } from '../../../../base/common/path.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService, IWriteFileOptions } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { getWebviewContentMimeType } from '../../../../platform/webview/common/mimeTypes.js';\n\nexport namespace WebviewResourceResponse {\n\texport enum Type { Success, Failed, AccessDenied, NotModified }\n\n\texport class StreamSuccess {\n\t\treadonly type = Type.Success;\n\n\t\tconstructor(\n\t\t\tpublic readonly stream: VSBufferReadableStream,\n\t\t\tpublic readonly etag: string | undefined,\n\t\t\tpublic readonly mtime: number | undefined,\n\t\t\tpublic readonly mimeType: string,\n\t\t) { }\n\t}\n\n\texport const Failed = { type: Type.Failed } as const;\n\texport const AccessDenied = { type: Type.AccessDenied } as const;\n\n\texport class NotModified {\n\t\treadonly type = Type.NotModified;\n\n\t\tconstructor(\n\t\t\tpublic readonly mimeType: string,\n\t\t\tpublic readonly mtime: number | undefined,\n\t\t) { }\n\t}\n\n\texport type StreamResponse = StreamSuccess | typeof Failed | typeof AccessDenied | NotModified;\n}\n\nexport async function loadLocalResource(\n\trequestUri: URI,\n\toptions: {\n\t\tifNoneMatch: string | undefined;\n\t\troots: ReadonlyArray<URI>;\n\t},\n\tfileService: IFileService,\n\tlogService: ILogService,\n\ttoken: CancellationToken,\n): Promise<WebviewResourceResponse.StreamResponse> {\n\tconst resourceToLoad = getResourceToLoad(requestUri, options.roots);\n\n\tlogService.trace(`Webview.loadLocalResource - trying to load resource. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\n\tif (!resourceToLoad) {\n\t\tlogService.trace(`Webview.loadLocalResource - access denied. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn WebviewResourceResponse.AccessDenied;\n\t}\n\n\tconst mime = getWebviewContentMimeType(requestUri); // Use the original path for the mime\n\n\ttry {\n\t\tconst result = await fileService.readFileStream(resourceToLoad, { etag: options.ifNoneMatch }, token);\n\t\tlogService.trace(`Webview.loadLocalResource - Loaded. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn new WebviewResourceResponse.StreamSuccess(result.value, result.etag, result.mtime, mime);\n\t} catch (err) {\n\t\tif (err instanceof FileOperationError) {\n\t\t\tconst result = err.fileOperationResult;\n\n\t\t\t// NotModified status is expected and can be handled gracefully\n\t\t\tif (result === FileOperationResult.FILE_NOT_MODIFIED_SINCE) {\n\t\t\t\tlogService.trace(`Webview.loadLocalResource - not modified. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\t\t\treturn new WebviewResourceResponse.NotModified(mime, (err.options as IWriteFileOptions | undefined)?.mtime);\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise the error is unexpected.\n\t\tlogService.error(`Webview.loadLocalResource - Error using fileReader. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn WebviewResourceResponse.Failed;\n\t}\n}\n\nfunction getResourceToLoad(\n\trequestUri: URI,\n\troots: ReadonlyArray<URI>,\n): URI | undefined {\n\tfor (const root of roots) {\n\t\tif (containsResource(root, requestUri)) {\n\t\t\treturn normalizeResourcePath(requestUri);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nfunction containsResource(root: URI, resource: URI): boolean {\n\tif (root.scheme !== resource.scheme) {\n\t\treturn false;\n\t}\n\n\tlet resourceFsPath = normalize(resource.fsPath);\n\tlet rootPath = normalize(root.fsPath + (root.fsPath.endsWith(sep) ? '' : sep));\n\n\tif (isUNC(root.fsPath) && isUNC(resource.fsPath)) {\n\t\trootPath = rootPath.toLowerCase();\n\t\tresourceFsPath = resourceFsPath.toLowerCase();\n\t}\n\n\treturn resourceFsPath.startsWith(rootPath);\n}\n\nfunction normalizeResourcePath(resource: URI): URI {\n\t// Rewrite remote uris to a path that the remote file system can understand\n\tif (resource.scheme === Schemas.vscodeRemote) {\n\t\treturn URI.from({\n\t\t\tscheme: Schemas.vscodeRemote,\n\t\t\tauthority: resource.authority,\n\t\t\tpath: '/vscode-resource',\n\t\t\tquery: JSON.stringify({\n\t\t\t\trequestResourcePath: resource.path\n\t\t\t})\n\t\t});\n\t}\n\treturn resource;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgB6B;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC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","ignoreList":[]}