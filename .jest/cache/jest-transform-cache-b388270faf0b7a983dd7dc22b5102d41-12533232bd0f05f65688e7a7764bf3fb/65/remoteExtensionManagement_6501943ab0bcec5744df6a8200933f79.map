{"version":3,"names":["cov_xlk5wj85f","actualCoverage","Emitter","ProcessTimeRunOnceScheduler","printTime","ms","f","h","s","m","b","Math","floor","_h","_m","_s","_ms","ManagementConnection","_logService","_reconnectionToken","_onClose","onClose","event","_reconnectionGraceTime","_reconnectionShortGraceTime","_remoteAddress","protocol","_disposed","_disconnectRunner1","_disconnectRunner2","constructor","remoteAddress","_log","_cleanResources","onDidDispose","onSocketClose","schedule","_str","info","substr","shortenReconnectionGraceTimeIfNecessary","isScheduled","dispose","socket","getSocket","sendDisconnect","end","fire","undefined","acceptReconnection","initialDataChunk","cancel","beginAcceptReconnection","endAcceptReconnection"],"sources":["/home/user/Desktop/MintMind/src/vs/server/node/remoteExtensionManagement.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { PersistentProtocol, ProtocolConstants, ISocket } from '../../base/parts/ipc/common/ipc.net.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { Emitter, Event } from '../../base/common/event.js';\nimport { VSBuffer } from '../../base/common/buffer.js';\nimport { ProcessTimeRunOnceScheduler } from '../../base/common/async.js';\n\nfunction printTime(ms: number): string {\n\tlet h = 0;\n\tlet m = 0;\n\tlet s = 0;\n\tif (ms >= 1000) {\n\t\ts = Math.floor(ms / 1000);\n\t\tms -= s * 1000;\n\t}\n\tif (s >= 60) {\n\t\tm = Math.floor(s / 60);\n\t\ts -= m * 60;\n\t}\n\tif (m >= 60) {\n\t\th = Math.floor(m / 60);\n\t\tm -= h * 60;\n\t}\n\tconst _h = h ? `${h}h` : ``;\n\tconst _m = m ? `${m}m` : ``;\n\tconst _s = s ? `${s}s` : ``;\n\tconst _ms = ms ? `${ms}ms` : ``;\n\treturn `${_h}${_m}${_s}${_ms}`;\n}\n\nexport class ManagementConnection {\n\n\tprivate _onClose = new Emitter<void>();\n\tpublic readonly onClose: Event<void> = this._onClose.event;\n\n\tprivate readonly _reconnectionGraceTime: number;\n\tprivate readonly _reconnectionShortGraceTime: number;\n\tprivate _remoteAddress: string;\n\n\tpublic readonly protocol: PersistentProtocol;\n\tprivate _disposed: boolean;\n\tprivate _disconnectRunner1: ProcessTimeRunOnceScheduler;\n\tprivate _disconnectRunner2: ProcessTimeRunOnceScheduler;\n\n\tconstructor(\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _reconnectionToken: string,\n\t\tremoteAddress: string,\n\t\tprotocol: PersistentProtocol\n\t) {\n\t\tthis._reconnectionGraceTime = ProtocolConstants.ReconnectionGraceTime;\n\t\tthis._reconnectionShortGraceTime = ProtocolConstants.ReconnectionShortGraceTime;\n\t\tthis._remoteAddress = remoteAddress;\n\n\t\tthis.protocol = protocol;\n\t\tthis._disposed = false;\n\t\tthis._disconnectRunner1 = new ProcessTimeRunOnceScheduler(() => {\n\t\t\tthis._log(`The reconnection grace time of ${printTime(this._reconnectionGraceTime)} has expired, so the connection will be disposed.`);\n\t\t\tthis._cleanResources();\n\t\t}, this._reconnectionGraceTime);\n\t\tthis._disconnectRunner2 = new ProcessTimeRunOnceScheduler(() => {\n\t\t\tthis._log(`The reconnection short grace time of ${printTime(this._reconnectionShortGraceTime)} has expired, so the connection will be disposed.`);\n\t\t\tthis._cleanResources();\n\t\t}, this._reconnectionShortGraceTime);\n\n\t\tthis.protocol.onDidDispose(() => {\n\t\t\tthis._log(`The client has disconnected gracefully, so the connection will be disposed.`);\n\t\t\tthis._cleanResources();\n\t\t});\n\t\tthis.protocol.onSocketClose(() => {\n\t\t\tthis._log(`The client has disconnected, will wait for reconnection ${printTime(this._reconnectionGraceTime)} before disposing...`);\n\t\t\t// The socket has closed, let's give the renderer a certain amount of time to reconnect\n\t\t\tthis._disconnectRunner1.schedule();\n\t\t});\n\n\t\tthis._log(`New connection established.`);\n\t}\n\n\tprivate _log(_str: string): void {\n\t\tthis._logService.info(`[${this._remoteAddress}][${this._reconnectionToken.substr(0, 8)}][ManagementConnection] ${_str}`);\n\t}\n\n\tpublic shortenReconnectionGraceTimeIfNecessary(): void {\n\t\tif (this._disconnectRunner2.isScheduled()) {\n\t\t\t// we are disconnected and already running the short reconnection timer\n\t\t\treturn;\n\t\t}\n\t\tif (this._disconnectRunner1.isScheduled()) {\n\t\t\tthis._log(`Another client has connected, will shorten the wait for reconnection ${printTime(this._reconnectionShortGraceTime)} before disposing...`);\n\t\t\t// we are disconnected and running the long reconnection timer\n\t\t\tthis._disconnectRunner2.schedule();\n\t\t}\n\t}\n\n\tprivate _cleanResources(): void {\n\t\tif (this._disposed) {\n\t\t\t// already called\n\t\t\treturn;\n\t\t}\n\t\tthis._disposed = true;\n\t\tthis._disconnectRunner1.dispose();\n\t\tthis._disconnectRunner2.dispose();\n\t\tconst socket = this.protocol.getSocket();\n\t\tthis.protocol.sendDisconnect();\n\t\tthis.protocol.dispose();\n\t\tsocket.end();\n\t\tthis._onClose.fire(undefined);\n\t}\n\n\tpublic acceptReconnection(remoteAddress: string, socket: ISocket, initialDataChunk: VSBuffer): void {\n\t\tthis._remoteAddress = remoteAddress;\n\t\tthis._log(`The client has reconnected.`);\n\t\tthis._disconnectRunner1.cancel();\n\t\tthis._disconnectRunner2.cancel();\n\t\tthis.protocol.beginAcceptReconnection(socket, initialDataChunk);\n\t\tthis.protocol.endAcceptReconnection();\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}