{"version":3,"names":["cov_kjnjx4z42","actualCoverage","Schemas","URI","extractLocalHostUriMetaDataForPortMapping","WebviewPortMappingManager","_getExtensionLocation","_getMappings","tunnelService","_tunnels","s","Map","constructor","f","getRedirect","resolveAuthority","url","uri","parse","requestLocalHostInfo","b","undefined","mapping","webviewPort","port","extensionLocation","scheme","vscodeRemote","tunnel","getOrCreateTunnel","extensionHostPort","tunnelLocalPort","encodeURI","with","authority","toString","address","dispose","values","clear","remoteAuthority","remotePort","existing","get","tunnelOrError","openTunnel","getAddress","set"],"sources":["/home/user/Desktop/MintMind/src/vs/platform/webview/common/webviewPortMapping.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IAddress } from '../../remote/common/remoteAgentConnection.js';\nimport { extractLocalHostUriMetaDataForPortMapping, ITunnelService, RemoteTunnel } from '../../tunnel/common/tunnel.js';\n\nexport interface IWebviewPortMapping {\n\treadonly webviewPort: number;\n\treadonly extensionHostPort: number;\n}\n\n/**\n * Manages port mappings for a single webview.\n */\nexport class WebviewPortMappingManager implements IDisposable {\n\n\tprivate readonly _tunnels = new Map<number, RemoteTunnel>();\n\n\tconstructor(\n\t\tprivate readonly _getExtensionLocation: () => URI | undefined,\n\t\tprivate readonly _getMappings: () => readonly IWebviewPortMapping[],\n\t\tprivate readonly tunnelService: ITunnelService\n\t) { }\n\n\tpublic async getRedirect(resolveAuthority: IAddress | null | undefined, url: string): Promise<string | undefined> {\n\t\tconst uri = URI.parse(url);\n\t\tconst requestLocalHostInfo = extractLocalHostUriMetaDataForPortMapping(uri);\n\t\tif (!requestLocalHostInfo) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tfor (const mapping of this._getMappings()) {\n\t\t\tif (mapping.webviewPort === requestLocalHostInfo.port) {\n\t\t\t\tconst extensionLocation = this._getExtensionLocation();\n\t\t\t\tif (extensionLocation && extensionLocation.scheme === Schemas.vscodeRemote) {\n\t\t\t\t\tconst tunnel = resolveAuthority && await this.getOrCreateTunnel(resolveAuthority, mapping.extensionHostPort);\n\t\t\t\t\tif (tunnel) {\n\t\t\t\t\t\tif (tunnel.tunnelLocalPort === mapping.webviewPort) {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn encodeURI(uri.with({\n\t\t\t\t\t\t\tauthority: `127.0.0.1:${tunnel.tunnelLocalPort}`,\n\t\t\t\t\t\t}).toString(true));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (mapping.webviewPort !== mapping.extensionHostPort) {\n\t\t\t\t\treturn encodeURI(uri.with({\n\t\t\t\t\t\tauthority: `${requestLocalHostInfo.address}:${mapping.extensionHostPort}`\n\t\t\t\t\t}).toString(true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tasync dispose() {\n\t\tfor (const tunnel of this._tunnels.values()) {\n\t\t\tawait tunnel.dispose();\n\t\t}\n\t\tthis._tunnels.clear();\n\t}\n\n\tprivate async getOrCreateTunnel(remoteAuthority: IAddress, remotePort: number): Promise<RemoteTunnel | undefined> {\n\t\tconst existing = this._tunnels.get(remotePort);\n\t\tif (existing) {\n\t\t\treturn existing;\n\t\t}\n\t\tconst tunnelOrError = await this.tunnelService.openTunnel({ getAddress: async () => remoteAuthority }, undefined, remotePort);\n\t\tlet tunnel: RemoteTunnel | undefined;\n\t\tif (typeof tunnelOrError === 'string') {\n\t\t\ttunnel = undefined;\n\t\t}\n\t\tif (tunnel) {\n\t\t\tthis._tunnels.set(remotePort, tunnel);\n\t\t}\n\t\treturn tunnel;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}