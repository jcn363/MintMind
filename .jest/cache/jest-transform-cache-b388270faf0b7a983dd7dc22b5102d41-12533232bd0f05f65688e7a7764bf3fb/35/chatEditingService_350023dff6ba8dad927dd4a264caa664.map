{"version":3,"names":["cov_e4nmg2np9","actualCoverage","hasKey","URI","localize","RawContextKey","createDecorator","IChatEditingService","s","CHAT_EDITING_MULTI_DIFF_SOURCE_RESOLVER_SCHEME","chatEditingWidgetFileStateContextKey","undefined","chatEditingAgentSupportsReadonlyReferencesContextKey","decidedChatEditingResourceContextKey","chatEditingResourceContextKey","inChatEditingSessionContextKey","hasUndecidedChatEditingResourceContextKey","hasAppliedChatEditsContextKey","applyingChatEditsFailedContextKey","chatEditingMaxFileAssignmentName","defaultChatEditingMaxFileLimit","isChatEditingActionContext","thing","f","b","sessionResource","getMultiDiffSourceUri","session","showPreviousChanges","from","scheme","authority","chatSessionId","query","parseChatMultiDiffUri","uri"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/chat/common/chatEditingService.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { IObservable, IReader } from '../../../../base/common/observable.js';\nimport { hasKey } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IDocumentDiff } from '../../../../editor/common/diff/documentDiffProvider.js';\nimport { Location, TextEdit } from '../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { EditSuggestionId } from '../../../../editor/common/textModelEditSource.js';\nimport { localize } from '../../../../nls.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IEditorPane } from '../../../common/editor.js';\nimport { ICellEditOperation } from '../../notebook/common/notebookCommon.js';\nimport { IChatAgentResult } from './chatAgents.js';\nimport { ChatModel, IChatResponseModel } from './chatModel.js';\nimport { IChatProgress } from './chatService.js';\n\nexport const IChatEditingService = createDecorator<IChatEditingService>('chatEditingService');\n\nexport interface IChatEditingService {\n\n\t_serviceBrand: undefined;\n\n\tstartOrContinueGlobalEditingSession(chatModel: ChatModel): Promise<IChatEditingSession>;\n\n\tgetEditingSession(chatSessionResource: URI): IChatEditingSession | undefined;\n\n\t/**\n\t * All editing sessions, sorted by recency, e.g the last created session comes first.\n\t */\n\treadonly editingSessionsObs: IObservable<readonly IChatEditingSession[]>;\n\n\t/**\n\t * Creates a new short lived editing session\n\t */\n\tcreateEditingSession(chatModel: ChatModel): Promise<IChatEditingSession>;\n\n\t/**\n\t * Creates an editing session with state transferred from the provided session.\n\t */\n\ttransferEditingSession(chatModel: ChatModel, session: IChatEditingSession): Promise<IChatEditingSession>;\n\n\t//#region related files\n\n\thasRelatedFilesProviders(): boolean;\n\tregisterRelatedFilesProvider(handle: number, provider: IChatRelatedFilesProvider): IDisposable;\n\tgetRelatedFiles(chatSessionResource: URI, prompt: string, files: URI[], token: CancellationToken): Promise<{ group: string; files: IChatRelatedFile[] }[] | undefined>;\n\n\t//#endregion\n}\n\nexport interface IChatRequestDraft {\n\treadonly prompt: string;\n\treadonly files: readonly URI[];\n}\n\nexport interface IChatRelatedFileProviderMetadata {\n\treadonly description: string;\n}\n\nexport interface IChatRelatedFile {\n\treadonly uri: URI;\n\treadonly description: string;\n}\n\nexport interface IChatRelatedFilesProvider {\n\treadonly description: string;\n\tprovideRelatedFiles(chatRequest: IChatRequestDraft, token: CancellationToken): Promise<IChatRelatedFile[] | undefined>;\n}\n\nexport interface WorkingSetDisplayMetadata {\n\tstate: ModifiedFileEntryState;\n\tdescription?: string;\n}\n\nexport interface IStreamingEdits {\n\tpushText(edits: TextEdit[], isLastEdits: boolean): void;\n\tpushNotebookCellText(cell: URI, edits: TextEdit[], isLastEdits: boolean): void;\n\tpushNotebook(edits: ICellEditOperation[], isLastEdits: boolean): void;\n\t/** Marks edits as done, idempotent */\n\tcomplete(): void;\n}\n\nexport interface IModifiedEntryTelemetryInfo {\n\treadonly agentId: string | undefined;\n\treadonly command: string | undefined;\n\treadonly sessionId: string;\n\treadonly requestId: string;\n\treadonly result: IChatAgentResult | undefined;\n\treadonly modelId: string | undefined;\n\treadonly modeId: 'ask' | 'edit' | 'agent' | 'custom' | 'applyCodeBlock' | undefined;\n\treadonly applyCodeBlockSuggestionId: EditSuggestionId | undefined;\n\treadonly feature: 'sideBarChat' | 'inlineChat' | undefined;\n}\n\nexport interface ISnapshotEntry {\n\treadonly resource: URI;\n\treadonly languageId: string;\n\treadonly snapshotUri: URI;\n\treadonly original: string;\n\treadonly current: string;\n\treadonly state: ModifiedFileEntryState;\n\ttelemetryInfo: IModifiedEntryTelemetryInfo;\n}\n\nexport interface IChatEditingSession extends IDisposable {\n\treadonly isGlobalEditingSession: boolean;\n\t/** @deprecated */\n\treadonly chatSessionId: string;\n\treadonly chatSessionResource: URI;\n\treadonly onDidDispose: Event<void>;\n\treadonly state: IObservable<ChatEditingSessionState>;\n\treadonly entries: IObservable<readonly IModifiedFileEntry[]>;\n\tshow(previousChanges?: boolean): Promise<void>;\n\taccept(...uris: URI[]): Promise<void>;\n\treject(...uris: URI[]): Promise<void>;\n\tgetEntry(uri: URI): IModifiedFileEntry | undefined;\n\treadEntry(uri: URI, reader: IReader): IModifiedFileEntry | undefined;\n\n\trestoreSnapshot(requestId: string, stopId: string | undefined): Promise<void>;\n\n\t/**\n\t * Marks all edits to the given resources as agent edits until\n\t * {@link stopExternalEdits} is called with the same ID. This is used for\n\t * agents that make changes on-disk rather than streaming edits through the\n\t * chat session.\n\t */\n\tstartExternalEdits(responseModel: IChatResponseModel, operationId: number, resources: URI[]): Promise<IChatProgress[]>;\n\tstopExternalEdits(responseModel: IChatResponseModel, operationId: number): Promise<IChatProgress[]>;\n\n\t/**\n\t * Gets the snapshot URI of a file at the request and _after_ changes made in the undo stop.\n\t * @param uri File in the workspace\n\t */\n\tgetSnapshotUri(requestId: string, uri: URI, stopId: string | undefined): URI | undefined;\n\n\tgetSnapshotContents(requestId: string, uri: URI, stopId: string | undefined): Promise<VSBuffer | undefined>;\n\tgetSnapshotModel(requestId: string, undoStop: string | undefined, snapshotUri: URI): Promise<ITextModel | null>;\n\n\t/**\n\t * Will lead to this object getting disposed\n\t */\n\tstop(clearState?: boolean): Promise<void>;\n\n\t/**\n\t * Starts making edits to the resource.\n\t * @param resource URI that's being edited\n\t * @param responseModel The response model making the edits\n\t * @param inUndoStop The undo stop the edits will be grouped in\n\t */\n\tstartStreamingEdits(resource: URI, responseModel: IChatResponseModel, inUndoStop: string | undefined): IStreamingEdits;\n\n\t/**\n\t * Gets the document diff of a change made to a URI between one undo stop and\n\t * the next one.\n\t * @returns The observable or undefined if there is no diff between the stops.\n\t */\n\tgetEntryDiffBetweenStops(uri: URI, requestId: string | undefined, stopId: string | undefined): IObservable<IEditSessionEntryDiff | undefined> | undefined;\n\n\t/**\n\t * Gets the document diff of a change made to a URI between one request to another one.\n\t * @returns The observable or undefined if there is no diff between the requests.\n\t */\n\tgetEntryDiffBetweenRequests(uri: URI, startRequestIs: string, stopRequestId: string): IObservable<IEditSessionEntryDiff | undefined>;\n\n\treadonly canUndo: IObservable<boolean>;\n\treadonly canRedo: IObservable<boolean>;\n\tundoInteraction(): Promise<void>;\n\tredoInteraction(): Promise<void>;\n}\n\nexport interface IEditSessionEntryDiff {\n\t/** LHS and RHS of a diff editor, if opened: */\n\toriginalURI: URI;\n\tmodifiedURI: URI;\n\n\t/** Diff state information: */\n\tquitEarly: boolean;\n\tidentical: boolean;\n\n\t/** True if nothing else will be added to this diff. */\n\tisFinal: boolean;\n\n\t/** Added data (e.g. line numbers) to show in the UI */\n\tadded: number;\n\t/** Removed data (e.g. line numbers) to show in the UI */\n\tremoved: number;\n}\n\nexport const enum ModifiedFileEntryState {\n\tModified,\n\tAccepted,\n\tRejected,\n}\n\n/**\n * Represents a part of a change\n */\nexport interface IModifiedFileEntryChangeHunk {\n\taccept(): Promise<boolean>;\n\treject(): Promise<boolean>;\n}\n\nexport interface IModifiedFileEntryEditorIntegration extends IDisposable {\n\n\t/**\n\t * The index of a change\n\t */\n\tcurrentIndex: IObservable<number>;\n\n\t/**\n\t * Reveal the first (`true`) or last (`false`) change\n\t */\n\treveal(firstOrLast: boolean, preserveFocus?: boolean): void;\n\n\t/**\n\t * Go to next change and increate `currentIndex`\n\t * @param wrap When at the last, start over again or not\n\t * @returns If it went next\n\t */\n\tnext(wrap: boolean): boolean;\n\n\t/**\n\t * @see `next`\n\t */\n\tprevious(wrap: boolean): boolean;\n\n\t/**\n\t * Enable the accessible diff viewer for this editor\n\t */\n\tenableAccessibleDiffView(): void;\n\n\t/**\n\t * Accept the change given or the nearest\n\t * @param change An opaque change object\n\t */\n\tacceptNearestChange(change?: IModifiedFileEntryChangeHunk): Promise<void>;\n\n\t/**\n\t * @see `acceptNearestChange`\n\t */\n\trejectNearestChange(change?: IModifiedFileEntryChangeHunk): Promise<void>;\n\n\t/**\n\t * Toggle between diff-editor and normal editor\n\t * @param change An opaque change object\n\t * @param show Optional boolean to control if the diff should show\n\t */\n\ttoggleDiff(change: IModifiedFileEntryChangeHunk | undefined, show?: boolean): Promise<void>;\n}\n\nexport interface IModifiedFileEntry {\n\treadonly entryId: string;\n\treadonly originalURI: URI;\n\treadonly modifiedURI: URI;\n\n\treadonly lastModifyingRequestId: string;\n\n\treadonly state: IObservable<ModifiedFileEntryState>;\n\treadonly isCurrentlyBeingModifiedBy: IObservable<{ responseModel: IChatResponseModel; undoStopId: string | undefined } | undefined>;\n\treadonly lastModifyingResponse: IObservable<IChatResponseModel | undefined>;\n\treadonly rewriteRatio: IObservable<number>;\n\n\treadonly waitsForLastEdits: IObservable<boolean>;\n\n\taccept(): Promise<void>;\n\treject(): Promise<void>;\n\n\treviewMode: IObservable<boolean>;\n\tautoAcceptController: IObservable<{ total: number; remaining: number; cancel(): void } | undefined>;\n\tenableReviewModeUntilSettled(): void;\n\n\t/**\n\t * Number of changes for this file\n\t */\n\treadonly changesCount: IObservable<number>;\n\n\t/**\n\t * Diff information for this entry\n\t */\n\treadonly diffInfo?: IObservable<IDocumentDiff>;\n\n\t/**\n\t * Number of lines added in this entry.\n\t */\n\treadonly linesAdded?: IObservable<number>;\n\n\t/**\n\t * Number of lines removed in this entry\n\t */\n\treadonly linesRemoved?: IObservable<number>;\n\n\tgetEditorIntegration(editor: IEditorPane): IModifiedFileEntryEditorIntegration;\n\thasModificationAt(location: Location): boolean;\n}\n\nexport interface IChatEditingSessionStream {\n\ttextEdits(resource: URI, textEdits: TextEdit[], isLastEdits: boolean, responseModel: IChatResponseModel): void;\n\tnotebookEdits(resource: URI, edits: ICellEditOperation[], isLastEdits: boolean, responseModel: IChatResponseModel): void;\n}\n\nexport const enum ChatEditingSessionState {\n\tInitial = 0,\n\tStreamingEdits = 1,\n\tIdle = 2,\n\tDisposed = 3\n}\n\nexport const CHAT_EDITING_MULTI_DIFF_SOURCE_RESOLVER_SCHEME = 'chat-editing-multi-diff-source';\n\nexport const chatEditingWidgetFileStateContextKey = new RawContextKey<ModifiedFileEntryState>('chatEditingWidgetFileState', undefined, localize('chatEditingWidgetFileState', \"The current state of the file in the chat editing widget\"));\nexport const chatEditingAgentSupportsReadonlyReferencesContextKey = new RawContextKey<boolean>('chatEditingAgentSupportsReadonlyReferences', undefined, localize('chatEditingAgentSupportsReadonlyReferences', \"Whether the chat editing agent supports readonly references (temporary)\"));\nexport const decidedChatEditingResourceContextKey = new RawContextKey<string[]>('decidedChatEditingResource', []);\nexport const chatEditingResourceContextKey = new RawContextKey<string | undefined>('chatEditingResource', undefined);\nexport const inChatEditingSessionContextKey = new RawContextKey<boolean | undefined>('inChatEditingSession', undefined);\nexport const hasUndecidedChatEditingResourceContextKey = new RawContextKey<boolean | undefined>('hasUndecidedChatEditingResource', false);\nexport const hasAppliedChatEditsContextKey = new RawContextKey<boolean | undefined>('hasAppliedChatEdits', false);\nexport const applyingChatEditsFailedContextKey = new RawContextKey<boolean | undefined>('applyingChatEditsFailed', false);\n\nexport const chatEditingMaxFileAssignmentName = 'chatEditingSessionFileLimit';\nexport const defaultChatEditingMaxFileLimit = 10;\n\nexport const enum ChatEditKind {\n\tCreated,\n\tModified,\n}\n\nexport interface IChatEditingActionContext {\n\t// The chat session that this editing session is associated with\n\tsessionResource: URI;\n}\n\nexport function isChatEditingActionContext(thing: unknown): thing is IChatEditingActionContext {\n\treturn typeof thing === 'object' && !!thing && hasKey(thing, { sessionResource: true });\n}\n\nexport function getMultiDiffSourceUri(session: IChatEditingSession, showPreviousChanges?: boolean): URI {\n\treturn URI.from({\n\t\tscheme: CHAT_EDITING_MULTI_DIFF_SOURCE_RESOLVER_SCHEME,\n\t\tauthority: session.chatSessionId,\n\t\tquery: showPreviousChanges ? 'previous' : undefined,\n\t});\n}\n\nexport function parseChatMultiDiffUri(uri: URI): { chatSessionId: string; showPreviousChanges: boolean } {\n\tconst chatSessionId = uri.authority;\n\tconst showPreviousChanges = uri.query === 'previous';\n\n\treturn { chatSessionId, showPreviousChanges };\n}\n"],"mappings":"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","ignoreList":[]}