{"version":3,"names":["cov_1jveihnied","actualCoverage","Emitter","Disposable","toDisposable","LineDataEventAddon","_initializationPromise","_xterm","_isOsSet","s","_onLineData","_register","onLineData","event","constructor","f","activate","xterm","buffer","onLineFeed","newLine","active","getLine","baseY","cursorY","b","isWrapped","_sendLineData","setOperatingSystem","os","parser","registerCsiHandler","final","lineIndex","line","lineData","translateToString","fire"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/terminal/browser/xterm/lineDataEventAddon.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { OperatingSystem } from '../../../../../base/common/platform.js';\nimport type { Terminal as XTermTerminal, IBuffer, ITerminalAddon } from '@xterm/xterm';\n\n/**\n * Provides extensions to the xterm object in a modular, testable way.\n */\nexport class LineDataEventAddon extends Disposable implements ITerminalAddon {\n\n\tprivate _xterm?: XTermTerminal;\n\tprivate _isOsSet = false;\n\n\tprivate readonly _onLineData = this._register(new Emitter<string>());\n\treadonly onLineData = this._onLineData.event;\n\n\tconstructor(private readonly _initializationPromise?: Promise<void>) {\n\t\tsuper();\n\t}\n\n\tasync activate(xterm: XTermTerminal) {\n\t\tthis._xterm = xterm;\n\n\t\t// IMPORTANT: Instantiate the buffer namespace object here before it's disposed.\n\t\tconst buffer = xterm.buffer;\n\n\t\t// If there is an initialization promise, wait for it before registering the event\n\t\tawait this._initializationPromise;\n\n\t\t// Fire onLineData when a line feed occurs, taking into account wrapped lines\n\t\tthis._register(xterm.onLineFeed(() => {\n\t\t\tconst newLine = buffer.active.getLine(buffer.active.baseY + buffer.active.cursorY);\n\t\t\tif (newLine && !newLine.isWrapped) {\n\t\t\t\tthis._sendLineData(buffer.active, buffer.active.baseY + buffer.active.cursorY - 1);\n\t\t\t}\n\t\t}));\n\n\t\t// Fire onLineData when disposing object to flush last line\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis._sendLineData(buffer.active, buffer.active.baseY + buffer.active.cursorY);\n\t\t}));\n\t}\n\n\tsetOperatingSystem(os: OperatingSystem) {\n\t\tif (this._isOsSet || !this._xterm) {\n\t\t\treturn;\n\t\t}\n\t\tthis._isOsSet = true;\n\n\t\t// Force line data to be sent when the cursor is moved, the main purpose for\n\t\t// this is because ConPTY will often not do a line feed but instead move the\n\t\t// cursor, in which case we still want to send the current line's data to tasks.\n\t\tif (os === OperatingSystem.Windows) {\n\t\t\tconst xterm = this._xterm;\n\t\t\tthis._register(xterm.parser.registerCsiHandler({ final: 'H' }, () => {\n\t\t\t\tconst buffer = xterm.buffer;\n\t\t\t\tthis._sendLineData(buffer.active, buffer.active.baseY + buffer.active.cursorY);\n\t\t\t\treturn false;\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate _sendLineData(buffer: IBuffer, lineIndex: number): void {\n\t\tlet line = buffer.getLine(lineIndex);\n\t\tif (!line) {\n\t\t\treturn;\n\t\t}\n\t\tlet lineData = line.translateToString(true);\n\t\twhile (lineIndex > 0 && line.isWrapped) {\n\t\t\tline = buffer.getLine(--lineIndex);\n\t\t\tif (!line) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlineData = line.translateToString(false) + lineData;\n\t\t}\n\t\tthis._onLineData.fire(lineData);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}