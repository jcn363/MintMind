{"version":3,"names":["countMapFrom","values","cov_1rh2sinkdv","f","map","s","Map","value","set","b","get","TfIdfCalculator","calculateScores","query","token","embedding","computeEmbedding","idfCache","scores","key","doc","documents","isCancellationRequested","chunk","chunks","score","computeSimilarityScore","push","termFrequencies","input","splitTerms","normalize","word","toLowerCase","matchAll","camelParts","replace","split","length","part","test","chunkCount","chunkOccurrences","updateDocuments","deleteDocument","text","textChunks","tf","term","keys","delete","currentOccurrences","newOccurrences","queryEmbedding","sum","termTfidf","Object","entries","chunkTf","chunkIdf","computeIdf","chunkTfidf","computeTfidf","Math","log","create","occurrences","idf","normalizeTfIdfScores","result","slice","sort","a","max"],"sources":["/home/user/Desktop/MintMind/src/vs/base/common/tfIdf.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from './cancellation.js';\n\ntype SparseEmbedding = Record</* word */ string, /* weight */number>;\ntype TermFrequencies = Map</* word */ string, /*occurrences*/ number>;\ntype DocumentOccurrences = Map</* word */ string, /*documentOccurrences*/ number>;\n\nfunction countMapFrom<K>(values: Iterable<K>): Map<K, number> {\n\tconst map = new Map<K, number>();\n\tfor (const value of values) {\n\t\tmap.set(value, (map.get(value) ?? 0) + 1);\n\t}\n\treturn map;\n}\n\ninterface DocumentChunkEntry {\n\treadonly text: string;\n\treadonly tf: TermFrequencies;\n}\n\nexport interface TfIdfDocument {\n\treadonly key: string;\n\treadonly textChunks: readonly string[];\n}\n\nexport interface TfIdfScore {\n\treadonly key: string;\n\t/**\n\t * An unbounded number.\n\t */\n\treadonly score: number;\n}\n\nexport interface NormalizedTfIdfScore {\n\treadonly key: string;\n\t/**\n\t * A number between 0 and 1.\n\t */\n\treadonly score: number;\n}\n\n/**\n * Implementation of tf-idf (term frequency-inverse document frequency) for a set of\n * documents where each document contains one or more chunks of text.\n * Each document is identified by a key, and the score for each document is computed\n * by taking the max score over all the chunks in the document.\n */\nexport class TfIdfCalculator {\n\tcalculateScores(query: string, token: CancellationToken): TfIdfScore[] {\n\t\tconst embedding = this.computeEmbedding(query);\n\t\tconst idfCache = new Map<string, number>();\n\t\tconst scores: TfIdfScore[] = [];\n\t\t// For each document, generate one score\n\t\tfor (const [key, doc] of this.documents) {\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tfor (const chunk of doc.chunks) {\n\t\t\t\tconst score = this.computeSimilarityScore(chunk, embedding, idfCache);\n\t\t\t\tif (score > 0) {\n\t\t\t\t\tscores.push({ key, score });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn scores;\n\t}\n\n\t/**\n\t * Count how many times each term (word) appears in a string.\n\t */\n\tprivate static termFrequencies(input: string): TermFrequencies {\n\t\treturn countMapFrom(TfIdfCalculator.splitTerms(input));\n\t}\n\n\t/**\n\t * Break a string into terms (words).\n\t */\n\tprivate static *splitTerms(input: string): Iterable<string> {\n\t\tconst normalize = (word: string) => word.toLowerCase();\n\n\t\t// Only match on words that are at least 3 characters long and start with a letter\n\t\tfor (const [word] of input.matchAll(/\\b\\p{Letter}[\\p{Letter}\\d]{2,}\\b/gu)) {\n\t\t\tyield normalize(word);\n\n\t\t\tconst camelParts = word.replace(/([a-z])([A-Z])/g, '$1 $2').split(/\\s+/g);\n\t\t\tif (camelParts.length > 1) {\n\t\t\t\tfor (const part of camelParts) {\n\t\t\t\t\t// Require at least 3 letters in the parts of a camel case word\n\t\t\t\t\tif (part.length > 2 && /\\p{Letter}{3,}/gu.test(part)) {\n\t\t\t\t\t\tyield normalize(part);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Total number of chunks\n\t */\n\tprivate chunkCount = 0;\n\n\tprivate readonly chunkOccurrences: DocumentOccurrences = new Map</* word */ string, /*documentOccurrences*/ number>();\n\n\tprivate readonly documents = new Map</* key */ string, {\n\t\treadonly chunks: ReadonlyArray<DocumentChunkEntry>;\n\t}>();\n\n\tupdateDocuments(documents: ReadonlyArray<TfIdfDocument>): this {\n\t\tfor (const { key } of documents) {\n\t\t\tthis.deleteDocument(key);\n\t\t}\n\n\t\tfor (const doc of documents) {\n\t\t\tconst chunks: Array<{ text: string; tf: TermFrequencies }> = [];\n\t\t\tfor (const text of doc.textChunks) {\n\t\t\t\t// TODO: See if we can compute the tf lazily\n\t\t\t\t// The challenge is that we need to also update the `chunkOccurrences`\n\t\t\t\t// and all of those updates need to get flushed before the real TF-IDF of\n\t\t\t\t// anything is computed.\n\t\t\t\tconst tf = TfIdfCalculator.termFrequencies(text);\n\n\t\t\t\t// Update occurrences list\n\t\t\t\tfor (const term of tf.keys()) {\n\t\t\t\t\tthis.chunkOccurrences.set(term, (this.chunkOccurrences.get(term) ?? 0) + 1);\n\t\t\t\t}\n\n\t\t\t\tchunks.push({ text, tf });\n\t\t\t}\n\n\t\t\tthis.chunkCount += chunks.length;\n\t\t\tthis.documents.set(doc.key, { chunks });\n\t\t}\n\t\treturn this;\n\t}\n\n\tdeleteDocument(key: string) {\n\t\tconst doc = this.documents.get(key);\n\t\tif (!doc) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documents.delete(key);\n\t\tthis.chunkCount -= doc.chunks.length;\n\n\t\t// Update term occurrences for the document\n\t\tfor (const chunk of doc.chunks) {\n\t\t\tfor (const term of chunk.tf.keys()) {\n\t\t\t\tconst currentOccurrences = this.chunkOccurrences.get(term);\n\t\t\t\tif (typeof currentOccurrences === 'number') {\n\t\t\t\t\tconst newOccurrences = currentOccurrences - 1;\n\t\t\t\t\tif (newOccurrences <= 0) {\n\t\t\t\t\t\tthis.chunkOccurrences.delete(term);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.chunkOccurrences.set(term, newOccurrences);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate computeSimilarityScore(chunk: DocumentChunkEntry, queryEmbedding: SparseEmbedding, idfCache: Map<string, number>): number {\n\t\t// Compute the dot product between the chunk's embedding and the query embedding\n\n\t\t// Note that the chunk embedding is computed lazily on a per-term basis.\n\t\t// This lets us skip a large number of calculations because the majority\n\t\t// of chunks do not share any terms with the query.\n\n\t\tlet sum = 0;\n\t\tfor (const [term, termTfidf] of Object.entries(queryEmbedding)) {\n\t\t\tconst chunkTf = chunk.tf.get(term);\n\t\t\tif (!chunkTf) {\n\t\t\t\t// Term does not appear in chunk so it has no contribution\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet chunkIdf = idfCache.get(term);\n\t\t\tif (typeof chunkIdf !== 'number') {\n\t\t\t\tchunkIdf = this.computeIdf(term);\n\t\t\t\tidfCache.set(term, chunkIdf);\n\t\t\t}\n\n\t\t\tconst chunkTfidf = chunkTf * chunkIdf;\n\t\t\tsum += chunkTfidf * termTfidf;\n\t\t}\n\t\treturn sum;\n\t}\n\n\tprivate computeEmbedding(input: string): SparseEmbedding {\n\t\tconst tf = TfIdfCalculator.termFrequencies(input);\n\t\treturn this.computeTfidf(tf);\n\t}\n\n\tprivate computeIdf(term: string): number {\n\t\tconst chunkOccurrences = this.chunkOccurrences.get(term) ?? 0;\n\t\treturn chunkOccurrences > 0\n\t\t\t? Math.log((this.chunkCount + 1) / chunkOccurrences)\n\t\t\t: 0;\n\t}\n\n\tprivate computeTfidf(termFrequencies: TermFrequencies): SparseEmbedding {\n\t\tconst embedding = Object.create(null);\n\t\tfor (const [word, occurrences] of termFrequencies) {\n\t\t\tconst idf = this.computeIdf(word);\n\t\t\tif (idf > 0) {\n\t\t\t\tembedding[word] = occurrences * idf;\n\t\t\t}\n\t\t}\n\t\treturn embedding;\n\t}\n}\n\n/**\n * Normalize the scores to be between 0 and 1 and sort them decending.\n * @param scores array of scores from {@link TfIdfCalculator.calculateScores}\n * @returns normalized scores\n */\nexport function normalizeTfIdfScores(scores: TfIdfScore[]): NormalizedTfIdfScore[] {\n\n\t// copy of scores\n\tconst result = scores.slice(0) as { score: number }[];\n\n\t// sort descending\n\tresult.sort((a, b) => b.score - a.score);\n\n\t// normalize\n\tconst max = result[0]?.score ?? 0;\n\tif (max > 0) {\n\t\tfor (const score of result) {\n\t\t\tscore.score /= max;\n\t\t}\n\t}\n\n\treturn result as TfIdfScore[];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}