{"version":3,"names":["cov_24erbmgv3g","actualCoverage","DeferredPromise","Disposable","toDisposable","DOM","NotebookCellLayoutManager","notebookWidget","_list","loggingService","_pendingLayouts","s","WeakMap","_layoutDisposables","Set","_layoutStack","_isDisposed","constructor","f","checkStackDepth","length","b","layoutTrace","join","Error","layoutNotebookCell","cell","height","layoutTag","handle","debug","viewIndex","getViewIndex","undefined","has","get","dispose","deferred","doLayout","pendingLayout","delete","push","viewModel","hasCell","elementHeight","hasEditorFocus","cellIndex","getCellIndex","visibleRanges","start","scrollTop","getAbsoluteTopOfElement","updateElementHeight2","Math","min","getLength","pop","complete","inRenderingTransaction","layoutDisposable","scheduleAtNextAnimationFrame","getWindow","getDomNode","disposable","set","add","p","forEach","d"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/notebook/browser/notebookCellLayoutManager.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DeferredPromise } from '../../../../base/common/async.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { ICellViewModel } from './notebookBrowser.js';\nimport { NotebookEditorWidget } from './notebookEditorWidget.js';\nimport { INotebookCellList } from './view/notebookRenderingCommon.js';\nimport * as DOM from '../../../../base/browser/dom.js';\nimport { INotebookLoggingService } from '../common/notebookLoggingService.js';\n\nexport class NotebookCellLayoutManager extends Disposable {\n\tprivate _pendingLayouts: WeakMap<ICellViewModel, IDisposable> | null = new WeakMap<ICellViewModel, IDisposable>();\n\tprivate _layoutDisposables: Set<IDisposable> = new Set<IDisposable>();\n\tprivate readonly _layoutStack: string[] = [];\n\tprivate _isDisposed = false;\n\tconstructor(\n\t\tprivate notebookWidget: NotebookEditorWidget,\n\t\tprivate _list: INotebookCellList,\n\t\tprivate loggingService: INotebookLoggingService\n\t) {\n\t\tsuper();\n\t}\n\n\tprivate checkStackDepth() {\n\t\tif (this._layoutStack.length > 30) {\n\t\t\tconst layoutTrace = this._layoutStack.join(' -> ');\n\t\t\tthrow new Error('NotebookCellLayoutManager: layout stack is too deep: ' + layoutTrace);\n\t\t}\n\t}\n\n\tasync layoutNotebookCell(cell: ICellViewModel, height: number): Promise<void> {\n\t\tconst layoutTag = `cell:${cell.handle}, height:${height}`;\n\t\tthis.loggingService.debug('cell layout', layoutTag);\n\t\tconst viewIndex = this._list.getViewIndex(cell);\n\t\tif (viewIndex === undefined) {\n\t\t\t// the cell is hidden\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._pendingLayouts?.has(cell)) {\n\t\t\tthis._pendingLayouts?.get(cell)!.dispose();\n\t\t}\n\n\t\tconst deferred = new DeferredPromise<void>();\n\t\tconst doLayout = () => {\n\t\t\tconst pendingLayout = this._pendingLayouts?.get(cell);\n\t\t\tthis._pendingLayouts?.delete(cell);\n\n\t\t\tthis._layoutStack.push(layoutTag);\n\t\t\ttry {\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.notebookWidget.viewModel?.hasCell(cell)) {\n\t\t\t\t\t// Cell removed in the meantime?\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this._list.getViewIndex(cell) === undefined) {\n\t\t\t\t\t// Cell can be hidden\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this._list.elementHeight(cell) === height) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.checkStackDepth();\n\n\t\t\t\tif (!this.notebookWidget.hasEditorFocus()) {\n\t\t\t\t\t// Do not scroll inactive notebook\n\t\t\t\t\t// https://github.com/microsoft/vscode/issues/145340\n\t\t\t\t\tconst cellIndex = this.notebookWidget.viewModel?.getCellIndex(cell);\n\t\t\t\t\tconst visibleRanges = this.notebookWidget.visibleRanges;\n\t\t\t\t\tif (cellIndex !== undefined\n\t\t\t\t\t\t&& visibleRanges && visibleRanges.length && visibleRanges[0].start === cellIndex\n\t\t\t\t\t\t// cell is partially visible\n\t\t\t\t\t\t&& this._list.scrollTop > this.notebookWidget.getAbsoluteTopOfElement(cell)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn this._list.updateElementHeight2(cell, height, Math.min(cellIndex + 1, this.notebookWidget.getLength() - 1));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._list.updateElementHeight2(cell, height);\n\t\t\t} finally {\n\t\t\t\tthis._layoutStack.pop();\n\t\t\t\tdeferred.complete(undefined);\n\t\t\t\tif (pendingLayout) {\n\t\t\t\t\tpendingLayout.dispose();\n\t\t\t\t\tthis._layoutDisposables.delete(pendingLayout);\n\t\t\t\t}\n\n\t\t\t}\n\t\t};\n\n\t\tif (this._list.inRenderingTransaction) {\n\t\t\tconst layoutDisposable = DOM.scheduleAtNextAnimationFrame(DOM.getWindow(this.notebookWidget.getDomNode()), doLayout);\n\n\t\t\tconst disposable = toDisposable(() => {\n\t\t\t\tlayoutDisposable.dispose();\n\t\t\t\tdeferred.complete(undefined);\n\t\t\t});\n\t\t\tthis._pendingLayouts?.set(cell, disposable);\n\t\t\tthis._layoutDisposables.add(disposable);\n\t\t} else {\n\t\t\tdoLayout();\n\t\t}\n\n\t\treturn deferred.p;\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._isDisposed = true;\n\t\tthis._layoutDisposables.forEach(d => d.dispose());\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}