{"version":3,"names":["cov_ttqsmxqk3","actualCoverage","CancellationTokenSource","RipgrepTextSearchEngine","Progress","Schemas","RipgrepSearchProvider","outputChannel","getNumThreads","inProgress","s","Set","constructor","f","process","once","dispose","provideTextSearchResults","query","options","progress","token","numThreads","engine","Promise","all","folderOptions","map","folderOption","extendedOptions","maxResults","previewOptions","maxFileSize","surroundingContext","folder","scheme","vscodeUserData","b","translatedOptions","with","file","progressTranslator","data","report","uri","withToken","provideTextSearchResultsWithRgOptions","then","e","complete","limitHit","some","fn","merged","mergedTokenSource","add","result","delete","forEach","cancel","tokenSource","onCancellationRequested"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/services/search/node/ripgrepSearchProvider.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource, CancellationToken } from '../../../../base/common/cancellation.js';\nimport { OutputChannel } from './ripgrepSearchUtils.js';\nimport { RipgrepTextSearchEngine } from './ripgrepTextSearchEngine.js';\nimport { TextSearchProvider2, TextSearchComplete2, TextSearchResult2, TextSearchQuery2, TextSearchProviderOptions, } from '../common/searchExtTypes.js';\nimport { Progress } from '../../../../platform/progress/common/progress.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport type { RipgrepTextSearchOptions } from '../common/searchExtTypesInternal.js';\n\nexport class RipgrepSearchProvider implements TextSearchProvider2 {\n\tprivate inProgress: Set<CancellationTokenSource> = new Set();\n\n\tconstructor(private outputChannel: OutputChannel, private getNumThreads: () => Promise<number | undefined>) {\n\t\tprocess.once('exit', () => this.dispose());\n\t}\n\n\tasync provideTextSearchResults(query: TextSearchQuery2, options: TextSearchProviderOptions, progress: Progress<TextSearchResult2>, token: CancellationToken): Promise<TextSearchComplete2> {\n\t\tconst numThreads = await this.getNumThreads();\n\t\tconst engine = new RipgrepTextSearchEngine(this.outputChannel, numThreads);\n\n\t\treturn Promise.all(options.folderOptions.map(folderOption => {\n\n\t\t\tconst extendedOptions: RipgrepTextSearchOptions = {\n\t\t\t\tfolderOptions: folderOption,\n\t\t\t\tnumThreads,\n\t\t\t\tmaxResults: options.maxResults,\n\t\t\t\tpreviewOptions: options.previewOptions,\n\t\t\t\tmaxFileSize: options.maxFileSize,\n\t\t\t\tsurroundingContext: options.surroundingContext\n\t\t\t};\n\t\t\tif (folderOption.folder.scheme === Schemas.vscodeUserData) {\n\t\t\t\t// Ripgrep search engine can only provide file-scheme results, but we want to use it to search some schemes that are backed by the filesystem, but with some other provider as the frontend,\n\t\t\t\t// case in point vscode-userdata. In these cases we translate the query to a file, and translate the results back to the frontend scheme.\n\t\t\t\tconst translatedOptions = { ...extendedOptions, folder: folderOption.folder.with({ scheme: Schemas.file }) };\n\t\t\t\tconst progressTranslator = new Progress<TextSearchResult2>(data => progress.report({ ...data, uri: data.uri.with({ scheme: folderOption.folder.scheme }) }));\n\t\t\t\treturn this.withToken(token, token => engine.provideTextSearchResultsWithRgOptions(query, translatedOptions, progressTranslator, token));\n\t\t\t} else {\n\t\t\t\treturn this.withToken(token, token => engine.provideTextSearchResultsWithRgOptions(query, extendedOptions, progress, token));\n\t\t\t}\n\t\t})).then((e => {\n\t\t\tconst complete: TextSearchComplete2 = {\n\t\t\t\t// todo: get this to actually check\n\t\t\t\tlimitHit: e.some(complete => !!complete && complete.limitHit)\n\t\t\t};\n\t\t\treturn complete;\n\t\t}));\n\n\t}\n\n\tprivate async withToken<T>(token: CancellationToken, fn: (token: CancellationToken) => Promise<T>): Promise<T> {\n\t\tconst merged = mergedTokenSource(token);\n\t\tthis.inProgress.add(merged);\n\t\tconst result = await fn(merged.token);\n\t\tthis.inProgress.delete(merged);\n\n\t\treturn result;\n\t}\n\n\tprivate dispose() {\n\t\tthis.inProgress.forEach(engine => engine.cancel());\n\t}\n}\n\nfunction mergedTokenSource(token: CancellationToken): CancellationTokenSource {\n\tconst tokenSource = new CancellationTokenSource();\n\ttoken.onCancellationRequested(() => tokenSource.cancel());\n\n\treturn tokenSource;\n}\n"],"mappings":"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","ignoreList":[]}