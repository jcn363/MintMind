77cad4c63b9f3da954c04a0a1b946403
/* istanbul ignore next */
function cov_uffd18m7t() {
  var path = "/home/user/Desktop/MintMind/src/vs/workbench/services/extensions/common/extensionStorageMigration.ts";
  var hash = "bb49c32c34aedf67032efc31f856f6325579480c";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/user/Desktop/MintMind/src/vs/workbench/services/extensions/common/extensionStorageMigration.ts",
    statementMap: {
      "0": {
        start: {
          line: 20,
          column: 4
        },
        end: {
          line: 65,
          column: 7
        }
      },
      "1": {
        start: {
          line: 21,
          column: 35
        },
        end: {
          line: 21,
          column: 75
        }
      },
      "2": {
        start: {
          line: 22,
          column: 40
        },
        end: {
          line: 22,
          column: 85
        }
      },
      "3": {
        start: {
          line: 23,
          column: 40
        },
        end: {
          line: 23,
          column: 85
        }
      },
      "4": {
        start: {
          line: 24,
          column: 31
        },
        end: {
          line: 24,
          column: 67
        }
      },
      "5": {
        start: {
          line: 25,
          column: 35
        },
        end: {
          line: 25,
          column: 75
        }
      },
      "6": {
        start: {
          line: 26,
          column: 28
        },
        end: {
          line: 26,
          column: 61
        }
      },
      "7": {
        start: {
          line: 27,
          column: 40
        },
        end: {
          line: 27,
          column: 85
        }
      },
      "8": {
        start: {
          line: 28,
          column: 27
        },
        end: {
          line: 28,
          column: 59
        }
      },
      "9": {
        start: {
          line: 29,
          column: 35
        },
        end: {
          line: 29,
          column: 97
        }
      },
      "10": {
        start: {
          line: 30,
          column: 43
        },
        end: {
          line: 30,
          column: 195
        }
      },
      "11": {
        start: {
          line: 31,
          column: 8
        },
        end: {
          line: 33,
          column: 9
        }
      },
      "12": {
        start: {
          line: 32,
          column: 12
        },
        end: {
          line: 32,
          column: 19
        }
      },
      "13": {
        start: {
          line: 34,
          column: 44
        },
        end: {
          line: 39,
          column: 9
        }
      },
      "14": {
        start: {
          line: 35,
          column: 12
        },
        end: {
          line: 37,
          column: 13
        }
      },
      "15": {
        start: {
          line: 36,
          column: 16
        },
        end: {
          line: 36,
          column: 196
        }
      },
      "16": {
        start: {
          line: 38,
          column: 12
        },
        end: {
          line: 38,
          column: 151
        }
      },
      "17": {
        start: {
          line: 40,
          column: 29
        },
        end: {
          line: 40,
          column: 70
        }
      },
      "18": {
        start: {
          line: 41,
          column: 8
        },
        end: {
          line: 64,
          column: 9
        }
      },
      "19": {
        start: {
          line: 42,
          column: 12
        },
        end: {
          line: 42,
          column: 141
        }
      },
      "20": {
        start: {
          line: 44,
          column: 26
        },
        end: {
          line: 44,
          column: 92
        }
      },
      "21": {
        start: {
          line: 45,
          column: 12
        },
        end: {
          line: 48,
          column: 13
        }
      },
      "22": {
        start: {
          line: 46,
          column: 16
        },
        end: {
          line: 46,
          column: 88
        }
      },
      "23": {
        start: {
          line: 47,
          column: 16
        },
        end: {
          line: 47,
          column: 94
        }
      },
      "24": {
        start: {
          line: 50,
          column: 29
        },
        end: {
          line: 50,
          column: 81
        }
      },
      "25": {
        start: {
          line: 51,
          column: 27
        },
        end: {
          line: 51,
          column: 77
        }
      },
      "26": {
        start: {
          line: 52,
          column: 12
        },
        end: {
          line: 61,
          column: 13
        }
      },
      "27": {
        start: {
          line: 53,
          column: 16
        },
        end: {
          line: 60,
          column: 17
        }
      },
      "28": {
        start: {
          line: 54,
          column: 20
        },
        end: {
          line: 54,
          column: 67
        }
      },
      "29": {
        start: {
          line: 57,
          column: 20
        },
        end: {
          line: 59,
          column: 21
        }
      },
      "30": {
        start: {
          line: 58,
          column: 24
        },
        end: {
          line: 58,
          column: 185
        }
      },
      "31": {
        start: {
          line: 62,
          column: 12
        },
        end: {
          line: 62,
          column: 137
        }
      },
      "32": {
        start: {
          line: 63,
          column: 12
        },
        end: {
          line: 63,
          column: 104
        }
      }
    },
    fnMap: {
      "0": {
        name: "migrateExtensionStorage",
        decl: {
          start: {
            line: 19,
            column: 22
          },
          end: {
            line: 19,
            column: 45
          }
        },
        loc: {
          start: {
            line: 19,
            column: 105
          },
          end: {
            line: 66,
            column: 1
          }
        },
        line: 19
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 20,
            column: 44
          },
          end: {
            line: 20,
            column: 45
          }
        },
        loc: {
          start: {
            line: 20,
            column: 71
          },
          end: {
            line: 65,
            column: 5
          }
        },
        line: 20
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 34,
            column: 44
          },
          end: {
            line: 34,
            column: 45
          }
        },
        loc: {
          start: {
            line: 34,
            column: 69
          },
          end: {
            line: 39,
            column: 9
          }
        },
        line: 34
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 30,
            column: 43
          },
          end: {
            line: 30,
            column: 195
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 30,
            column: 107
          },
          end: {
            line: 30,
            column: 183
          }
        }, {
          start: {
            line: 30,
            column: 186
          },
          end: {
            line: 30,
            column: 195
          }
        }],
        line: 30
      },
      "1": {
        loc: {
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 33,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 31,
            column: 8
          },
          end: {
            line: 33,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 31
      },
      "2": {
        loc: {
          start: {
            line: 35,
            column: 12
          },
          end: {
            line: 37,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 35,
            column: 12
          },
          end: {
            line: 37,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 35
      },
      "3": {
        loc: {
          start: {
            line: 40,
            column: 29
          },
          end: {
            line: 40,
            column: 70
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 40,
            column: 38
          },
          end: {
            line: 40,
            column: 39
          }
        }, {
          start: {
            line: 40,
            column: 69
          },
          end: {
            line: 40,
            column: 70
          }
        }],
        line: 40
      },
      "4": {
        loc: {
          start: {
            line: 41,
            column: 8
          },
          end: {
            line: 64,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 41,
            column: 8
          },
          end: {
            line: 64,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 41
      },
      "5": {
        loc: {
          start: {
            line: 41,
            column: 12
          },
          end: {
            line: 41,
            column: 190
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 41,
            column: 12
          },
          end: {
            line: 41,
            column: 79
          }
        }, {
          start: {
            line: 41,
            column: 83
          },
          end: {
            line: 41,
            column: 190
          }
        }],
        line: 41
      },
      "6": {
        loc: {
          start: {
            line: 41,
            column: 85
          },
          end: {
            line: 41,
            column: 189
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 41,
            column: 85
          },
          end: {
            line: 41,
            column: 111
          }
        }, {
          start: {
            line: 41,
            column: 115
          },
          end: {
            line: 41,
            column: 189
          }
        }],
        line: 41
      },
      "7": {
        loc: {
          start: {
            line: 42,
            column: 41
          },
          end: {
            line: 42,
            column: 72
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 42,
            column: 50
          },
          end: {
            line: 42,
            column: 58
          }
        }, {
          start: {
            line: 42,
            column: 61
          },
          end: {
            line: 42,
            column: 72
          }
        }],
        line: 42
      },
      "8": {
        loc: {
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 48,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 45,
            column: 12
          },
          end: {
            line: 48,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 45
      },
      "9": {
        loc: {
          start: {
            line: 52,
            column: 12
          },
          end: {
            line: 61,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 52,
            column: 12
          },
          end: {
            line: 61,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 52
      },
      "10": {
        loc: {
          start: {
            line: 57,
            column: 20
          },
          end: {
            line: 59,
            column: 21
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 57,
            column: 20
          },
          end: {
            line: 59,
            column: 21
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 57
      },
      "11": {
        loc: {
          start: {
            line: 58,
            column: 65
          },
          end: {
            line: 58,
            column: 96
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 58,
            column: 74
          },
          end: {
            line: 58,
            column: 82
          }
        }, {
          start: {
            line: 58,
            column: 85
          },
          end: {
            line: 58,
            column: 96
          }
        }],
        line: 58
      },
      "12": {
        loc: {
          start: {
            line: 62,
            column: 40
          },
          end: {
            line: 62,
            column: 71
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 62,
            column: 49
          },
          end: {
            line: 62,
            column: 57
          }
        }, {
          start: {
            line: 62,
            column: 60
          },
          end: {
            line: 62,
            column: 71
          }
        }],
        line: 62
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0]
    },
    inputSourceMap: {
      file: "/home/user/Desktop/MintMind/src/vs/workbench/services/extensions/common/extensionStorageMigration.ts",
      mappings: "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",
      names: [],
      sources: ["/home/user/Desktop/MintMind/src/vs/workbench/services/extensions/common/extensionStorageMigration.ts"],
      sourcesContent: ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getErrorMessage } from '../../../../base/common/errors.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { FileSystemProviderError, FileSystemProviderErrorCode, IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\n\n/**\n * An extension storage has following\n * \t- State: Stored using storage service with extension id as key and state as value.\n *  - Resources: Stored under a location scoped to the extension.\n */\nexport async function migrateExtensionStorage(fromExtensionId: string, toExtensionId: string, global: boolean, instantionService: IInstantiationService): Promise<void> {\n\treturn instantionService.invokeFunction(async serviceAccessor => {\n\t\tconst environmentService = serviceAccessor.get(IEnvironmentService);\n\t\tconst userDataProfilesService = serviceAccessor.get(IUserDataProfilesService);\n\t\tconst extensionStorageService = serviceAccessor.get(IExtensionStorageService);\n\t\tconst storageService = serviceAccessor.get(IStorageService);\n\t\tconst uriIdentityService = serviceAccessor.get(IUriIdentityService);\n\t\tconst fileService = serviceAccessor.get(IFileService);\n\t\tconst workspaceContextService = serviceAccessor.get(IWorkspaceContextService);\n\t\tconst logService = serviceAccessor.get(ILogService);\n\t\tconst storageMigratedKey = `extensionStorage.migrate.${fromExtensionId}-${toExtensionId}`;\n\t\tconst migrateLowerCaseStorageKey = fromExtensionId.toLowerCase() === toExtensionId.toLowerCase() ? `extension.storage.migrateFromLowerCaseKey.${fromExtensionId.toLowerCase()}` : undefined;\n\n\t\tif (fromExtensionId === toExtensionId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst getExtensionStorageLocation = (extensionId: string, global: boolean): URI => {\n\t\t\tif (global) {\n\t\t\t\treturn uriIdentityService.extUri.joinPath(userDataProfilesService.defaultProfile.globalStorageHome, extensionId.toLowerCase() /* Extension id is lower cased for global storage */);\n\t\t\t}\n\t\t\treturn uriIdentityService.extUri.joinPath(environmentService.workspaceStorageHome, workspaceContextService.getWorkspace().id, extensionId);\n\t\t};\n\n\t\tconst storageScope = global ? StorageScope.PROFILE : StorageScope.WORKSPACE;\n\t\tif (!storageService.getBoolean(storageMigratedKey, storageScope, false) && !(migrateLowerCaseStorageKey && storageService.getBoolean(migrateLowerCaseStorageKey, storageScope, false))) {\n\t\t\tlogService.info(`Migrating ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}...`);\n\t\t\t// Migrate state\n\t\t\tconst value = extensionStorageService.getExtensionState(fromExtensionId, global);\n\t\t\tif (value) {\n\t\t\t\textensionStorageService.setExtensionState(toExtensionId, value, global);\n\t\t\t\textensionStorageService.setExtensionState(fromExtensionId, undefined, global);\n\t\t\t}\n\n\t\t\t// Migrate stored files\n\t\t\tconst fromPath = getExtensionStorageLocation(fromExtensionId, global);\n\t\t\tconst toPath = getExtensionStorageLocation(toExtensionId, global);\n\t\t\tif (!uriIdentityService.extUri.isEqual(fromPath, toPath)) {\n\t\t\t\ttry {\n\t\t\t\t\tawait fileService.move(fromPath, toPath, true);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif ((<FileSystemProviderError>error).code !== FileSystemProviderErrorCode.FileNotFound) {\n\t\t\t\t\t\tlogService.info(`Error while migrating ${global ? 'global' : 'workspace'} file storage from '${fromExtensionId}' to '${toExtensionId}'`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlogService.info(`Migrated ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}`);\n\t\t\tstorageService.store(storageMigratedKey, true, storageScope, StorageTarget.MACHINE);\n\t\t}\n\t});\n}\n"],
      version: 3
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "bb49c32c34aedf67032efc31f856f6325579480c"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_uffd18m7t = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_uffd18m7t();
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import { getErrorMessage } from '../../../../base/common/errors.js';
import { IEnvironmentService } from '../../../../platform/environment/common/environment.js';
import { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';
import { FileSystemProviderErrorCode, IFileService } from '../../../../platform/files/common/files.js';
import { ILogService } from '../../../../platform/log/common/log.js';
import { IStorageService } from '../../../../platform/storage/common/storage.js';
import { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';
import { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';
import { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';
/**
 * An extension storage has following
 * 	- State: Stored using storage service with extension id as key and state as value.
 *  - Resources: Stored under a location scoped to the extension.
 */
export async function migrateExtensionStorage(fromExtensionId, toExtensionId, global, instantionService) {
  /* istanbul ignore next */
  cov_uffd18m7t().f[0]++;
  cov_uffd18m7t().s[0]++;
  return instantionService.invokeFunction(async serviceAccessor => {
    /* istanbul ignore next */
    cov_uffd18m7t().f[1]++;
    const environmentService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[1]++, serviceAccessor.get(IEnvironmentService));
    const userDataProfilesService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[2]++, serviceAccessor.get(IUserDataProfilesService));
    const extensionStorageService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[3]++, serviceAccessor.get(IExtensionStorageService));
    const storageService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[4]++, serviceAccessor.get(IStorageService));
    const uriIdentityService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[5]++, serviceAccessor.get(IUriIdentityService));
    const fileService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[6]++, serviceAccessor.get(IFileService));
    const workspaceContextService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[7]++, serviceAccessor.get(IWorkspaceContextService));
    const logService =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[8]++, serviceAccessor.get(ILogService));
    const storageMigratedKey =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[9]++, `extensionStorage.migrate.${fromExtensionId}-${toExtensionId}`);
    const migrateLowerCaseStorageKey =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[10]++, fromExtensionId.toLowerCase() === toExtensionId.toLowerCase() ?
    /* istanbul ignore next */
    (cov_uffd18m7t().b[0][0]++, `extension.storage.migrateFromLowerCaseKey.${fromExtensionId.toLowerCase()}`) :
    /* istanbul ignore next */
    (cov_uffd18m7t().b[0][1]++, undefined));
    /* istanbul ignore next */
    cov_uffd18m7t().s[11]++;
    if (fromExtensionId === toExtensionId) {
      /* istanbul ignore next */
      cov_uffd18m7t().b[1][0]++;
      cov_uffd18m7t().s[12]++;
      return;
    } else
    /* istanbul ignore next */
    {
      cov_uffd18m7t().b[1][1]++;
    }
    cov_uffd18m7t().s[13]++;
    const getExtensionStorageLocation = (extensionId, global) => {
      /* istanbul ignore next */
      cov_uffd18m7t().f[2]++;
      cov_uffd18m7t().s[14]++;
      if (global) {
        /* istanbul ignore next */
        cov_uffd18m7t().b[2][0]++;
        cov_uffd18m7t().s[15]++;
        return uriIdentityService.extUri.joinPath(userDataProfilesService.defaultProfile.globalStorageHome, extensionId.toLowerCase() /* Extension id is lower cased for global storage */);
      } else
      /* istanbul ignore next */
      {
        cov_uffd18m7t().b[2][1]++;
      }
      cov_uffd18m7t().s[16]++;
      return uriIdentityService.extUri.joinPath(environmentService.workspaceStorageHome, workspaceContextService.getWorkspace().id, extensionId);
    };
    const storageScope =
    /* istanbul ignore next */
    (cov_uffd18m7t().s[17]++, global ?
    /* istanbul ignore next */
    (cov_uffd18m7t().b[3][0]++, 0 /* StorageScope.PROFILE */) :
    /* istanbul ignore next */
    (cov_uffd18m7t().b[3][1]++, 1)) /* StorageScope.WORKSPACE */;
    /* istanbul ignore next */
    cov_uffd18m7t().s[18]++;
    if (
    /* istanbul ignore next */
    (cov_uffd18m7t().b[5][0]++, !storageService.getBoolean(storageMigratedKey, storageScope, false)) &&
    /* istanbul ignore next */
    (cov_uffd18m7t().b[5][1]++, !(
    /* istanbul ignore next */
    (cov_uffd18m7t().b[6][0]++, migrateLowerCaseStorageKey) &&
    /* istanbul ignore next */
    (cov_uffd18m7t().b[6][1]++, storageService.getBoolean(migrateLowerCaseStorageKey, storageScope, false))))) {
      /* istanbul ignore next */
      cov_uffd18m7t().b[4][0]++;
      cov_uffd18m7t().s[19]++;
      logService.info(`Migrating ${global ?
      /* istanbul ignore next */
      (cov_uffd18m7t().b[7][0]++, 'global') :
      /* istanbul ignore next */
      (cov_uffd18m7t().b[7][1]++, 'workspace')} extension storage from ${fromExtensionId} to ${toExtensionId}...`);
      // Migrate state
      const value =
      /* istanbul ignore next */
      (cov_uffd18m7t().s[20]++, extensionStorageService.getExtensionState(fromExtensionId, global));
      /* istanbul ignore next */
      cov_uffd18m7t().s[21]++;
      if (value) {
        /* istanbul ignore next */
        cov_uffd18m7t().b[8][0]++;
        cov_uffd18m7t().s[22]++;
        extensionStorageService.setExtensionState(toExtensionId, value, global);
        /* istanbul ignore next */
        cov_uffd18m7t().s[23]++;
        extensionStorageService.setExtensionState(fromExtensionId, undefined, global);
      } else
      /* istanbul ignore next */
      {
        cov_uffd18m7t().b[8][1]++;
      }
      // Migrate stored files
      const fromPath =
      /* istanbul ignore next */
      (cov_uffd18m7t().s[24]++, getExtensionStorageLocation(fromExtensionId, global));
      const toPath =
      /* istanbul ignore next */
      (cov_uffd18m7t().s[25]++, getExtensionStorageLocation(toExtensionId, global));
      /* istanbul ignore next */
      cov_uffd18m7t().s[26]++;
      if (!uriIdentityService.extUri.isEqual(fromPath, toPath)) {
        /* istanbul ignore next */
        cov_uffd18m7t().b[9][0]++;
        cov_uffd18m7t().s[27]++;
        try {
          /* istanbul ignore next */
          cov_uffd18m7t().s[28]++;
          await fileService.move(fromPath, toPath, true);
        } catch (error) {
          /* istanbul ignore next */
          cov_uffd18m7t().s[29]++;
          if (error.code !== FileSystemProviderErrorCode.FileNotFound) {
            /* istanbul ignore next */
            cov_uffd18m7t().b[10][0]++;
            cov_uffd18m7t().s[30]++;
            logService.info(`Error while migrating ${global ?
            /* istanbul ignore next */
            (cov_uffd18m7t().b[11][0]++, 'global') :
            /* istanbul ignore next */
            (cov_uffd18m7t().b[11][1]++, 'workspace')} file storage from '${fromExtensionId}' to '${toExtensionId}'`, getErrorMessage(error));
          } else
          /* istanbul ignore next */
          {
            cov_uffd18m7t().b[10][1]++;
          }
        }
      } else
      /* istanbul ignore next */
      {
        cov_uffd18m7t().b[9][1]++;
      }
      cov_uffd18m7t().s[31]++;
      logService.info(`Migrated ${global ?
      /* istanbul ignore next */
      (cov_uffd18m7t().b[12][0]++, 'global') :
      /* istanbul ignore next */
      (cov_uffd18m7t().b[12][1]++, 'workspace')} extension storage from ${fromExtensionId} to ${toExtensionId}`);
      /* istanbul ignore next */
      cov_uffd18m7t().s[32]++;
      storageService.store(storageMigratedKey, true, storageScope, 1 /* StorageTarget.MACHINE */);
    } else
    /* istanbul ignore next */
    {
      cov_uffd18m7t().b[4][1]++;
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXRFcnJvck1lc3NhZ2UiLCJJRW52aXJvbm1lbnRTZXJ2aWNlIiwiSUV4dGVuc2lvblN0b3JhZ2VTZXJ2aWNlIiwiRmlsZVN5c3RlbVByb3ZpZGVyRXJyb3JDb2RlIiwiSUZpbGVTZXJ2aWNlIiwiSUxvZ1NlcnZpY2UiLCJJU3RvcmFnZVNlcnZpY2UiLCJJVXJpSWRlbnRpdHlTZXJ2aWNlIiwiSVVzZXJEYXRhUHJvZmlsZXNTZXJ2aWNlIiwiSVdvcmtzcGFjZUNvbnRleHRTZXJ2aWNlIiwibWlncmF0ZUV4dGVuc2lvblN0b3JhZ2UiLCJmcm9tRXh0ZW5zaW9uSWQiLCJ0b0V4dGVuc2lvbklkIiwiZ2xvYmFsIiwiaW5zdGFudGlvblNlcnZpY2UiLCJjb3ZfdWZmZDE4bTd0IiwiZiIsInMiLCJpbnZva2VGdW5jdGlvbiIsInNlcnZpY2VBY2Nlc3NvciIsImVudmlyb25tZW50U2VydmljZSIsImdldCIsInVzZXJEYXRhUHJvZmlsZXNTZXJ2aWNlIiwiZXh0ZW5zaW9uU3RvcmFnZVNlcnZpY2UiLCJzdG9yYWdlU2VydmljZSIsInVyaUlkZW50aXR5U2VydmljZSIsImZpbGVTZXJ2aWNlIiwid29ya3NwYWNlQ29udGV4dFNlcnZpY2UiLCJsb2dTZXJ2aWNlIiwic3RvcmFnZU1pZ3JhdGVkS2V5IiwibWlncmF0ZUxvd2VyQ2FzZVN0b3JhZ2VLZXkiLCJ0b0xvd2VyQ2FzZSIsImIiLCJ1bmRlZmluZWQiLCJnZXRFeHRlbnNpb25TdG9yYWdlTG9jYXRpb24iLCJleHRlbnNpb25JZCIsImV4dFVyaSIsImpvaW5QYXRoIiwiZGVmYXVsdFByb2ZpbGUiLCJnbG9iYWxTdG9yYWdlSG9tZSIsIndvcmtzcGFjZVN0b3JhZ2VIb21lIiwiZ2V0V29ya3NwYWNlIiwiaWQiLCJzdG9yYWdlU2NvcGUiLCJnZXRCb29sZWFuIiwiaW5mbyIsInZhbHVlIiwiZ2V0RXh0ZW5zaW9uU3RhdGUiLCJzZXRFeHRlbnNpb25TdGF0ZSIsImZyb21QYXRoIiwidG9QYXRoIiwiaXNFcXVhbCIsIm1vdmUiLCJlcnJvciIsImNvZGUiLCJGaWxlTm90Rm91bmQiLCJzdG9yZSJdLCJzb3VyY2VzIjpbIi9ob21lL3VzZXIvRGVza3RvcC9NaW50TWluZC9zcmMvdnMvd29ya2JlbmNoL3NlcnZpY2VzL2V4dGVuc2lvbnMvY29tbW9uL2V4dGVuc2lvblN0b3JhZ2VNaWdyYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbmltcG9ydCB7IGdldEVycm9yTWVzc2FnZSB9IGZyb20gJy4uLy4uLy4uLy4uL2Jhc2UvY29tbW9uL2Vycm9ycy5qcyc7XG5pbXBvcnQgeyBVUkkgfSBmcm9tICcuLi8uLi8uLi8uLi9iYXNlL2NvbW1vbi91cmkuanMnO1xuaW1wb3J0IHsgSUVudmlyb25tZW50U2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3BsYXRmb3JtL2Vudmlyb25tZW50L2NvbW1vbi9lbnZpcm9ubWVudC5qcyc7XG5pbXBvcnQgeyBJRXh0ZW5zaW9uU3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9wbGF0Zm9ybS9leHRlbnNpb25NYW5hZ2VtZW50L2NvbW1vbi9leHRlbnNpb25TdG9yYWdlLmpzJztcbmltcG9ydCB7IEZpbGVTeXN0ZW1Qcm92aWRlckVycm9yLCBGaWxlU3lzdGVtUHJvdmlkZXJFcnJvckNvZGUsIElGaWxlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3BsYXRmb3JtL2ZpbGVzL2NvbW1vbi9maWxlcy5qcyc7XG5pbXBvcnQgeyBJSW5zdGFudGlhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9wbGF0Zm9ybS9pbnN0YW50aWF0aW9uL2NvbW1vbi9pbnN0YW50aWF0aW9uLmpzJztcbmltcG9ydCB7IElMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGxhdGZvcm0vbG9nL2NvbW1vbi9sb2cuanMnO1xuaW1wb3J0IHsgSVN0b3JhZ2VTZXJ2aWNlLCBTdG9yYWdlU2NvcGUsIFN0b3JhZ2VUYXJnZXQgfSBmcm9tICcuLi8uLi8uLi8uLi9wbGF0Zm9ybS9zdG9yYWdlL2NvbW1vbi9zdG9yYWdlLmpzJztcbmltcG9ydCB7IElVcmlJZGVudGl0eVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9wbGF0Zm9ybS91cmlJZGVudGl0eS9jb21tb24vdXJpSWRlbnRpdHkuanMnO1xuaW1wb3J0IHsgSVVzZXJEYXRhUHJvZmlsZXNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGxhdGZvcm0vdXNlckRhdGFQcm9maWxlL2NvbW1vbi91c2VyRGF0YVByb2ZpbGUuanMnO1xuaW1wb3J0IHsgSVdvcmtzcGFjZUNvbnRleHRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGxhdGZvcm0vd29ya3NwYWNlL2NvbW1vbi93b3Jrc3BhY2UuanMnO1xuXG4vKipcbiAqIEFuIGV4dGVuc2lvbiBzdG9yYWdlIGhhcyBmb2xsb3dpbmdcbiAqIFx0LSBTdGF0ZTogU3RvcmVkIHVzaW5nIHN0b3JhZ2Ugc2VydmljZSB3aXRoIGV4dGVuc2lvbiBpZCBhcyBrZXkgYW5kIHN0YXRlIGFzIHZhbHVlLlxuICogIC0gUmVzb3VyY2VzOiBTdG9yZWQgdW5kZXIgYSBsb2NhdGlvbiBzY29wZWQgdG8gdGhlIGV4dGVuc2lvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZ3JhdGVFeHRlbnNpb25TdG9yYWdlKGZyb21FeHRlbnNpb25JZDogc3RyaW5nLCB0b0V4dGVuc2lvbklkOiBzdHJpbmcsIGdsb2JhbDogYm9vbGVhbiwgaW5zdGFudGlvblNlcnZpY2U6IElJbnN0YW50aWF0aW9uU2VydmljZSk6IFByb21pc2U8dm9pZD4ge1xuXHRyZXR1cm4gaW5zdGFudGlvblNlcnZpY2UuaW52b2tlRnVuY3Rpb24oYXN5bmMgc2VydmljZUFjY2Vzc29yID0+IHtcblx0XHRjb25zdCBlbnZpcm9ubWVudFNlcnZpY2UgPSBzZXJ2aWNlQWNjZXNzb3IuZ2V0KElFbnZpcm9ubWVudFNlcnZpY2UpO1xuXHRcdGNvbnN0IHVzZXJEYXRhUHJvZmlsZXNTZXJ2aWNlID0gc2VydmljZUFjY2Vzc29yLmdldChJVXNlckRhdGFQcm9maWxlc1NlcnZpY2UpO1xuXHRcdGNvbnN0IGV4dGVuc2lvblN0b3JhZ2VTZXJ2aWNlID0gc2VydmljZUFjY2Vzc29yLmdldChJRXh0ZW5zaW9uU3RvcmFnZVNlcnZpY2UpO1xuXHRcdGNvbnN0IHN0b3JhZ2VTZXJ2aWNlID0gc2VydmljZUFjY2Vzc29yLmdldChJU3RvcmFnZVNlcnZpY2UpO1xuXHRcdGNvbnN0IHVyaUlkZW50aXR5U2VydmljZSA9IHNlcnZpY2VBY2Nlc3Nvci5nZXQoSVVyaUlkZW50aXR5U2VydmljZSk7XG5cdFx0Y29uc3QgZmlsZVNlcnZpY2UgPSBzZXJ2aWNlQWNjZXNzb3IuZ2V0KElGaWxlU2VydmljZSk7XG5cdFx0Y29uc3Qgd29ya3NwYWNlQ29udGV4dFNlcnZpY2UgPSBzZXJ2aWNlQWNjZXNzb3IuZ2V0KElXb3Jrc3BhY2VDb250ZXh0U2VydmljZSk7XG5cdFx0Y29uc3QgbG9nU2VydmljZSA9IHNlcnZpY2VBY2Nlc3Nvci5nZXQoSUxvZ1NlcnZpY2UpO1xuXHRcdGNvbnN0IHN0b3JhZ2VNaWdyYXRlZEtleSA9IGBleHRlbnNpb25TdG9yYWdlLm1pZ3JhdGUuJHtmcm9tRXh0ZW5zaW9uSWR9LSR7dG9FeHRlbnNpb25JZH1gO1xuXHRcdGNvbnN0IG1pZ3JhdGVMb3dlckNhc2VTdG9yYWdlS2V5ID0gZnJvbUV4dGVuc2lvbklkLnRvTG93ZXJDYXNlKCkgPT09IHRvRXh0ZW5zaW9uSWQudG9Mb3dlckNhc2UoKSA/IGBleHRlbnNpb24uc3RvcmFnZS5taWdyYXRlRnJvbUxvd2VyQ2FzZUtleS4ke2Zyb21FeHRlbnNpb25JZC50b0xvd2VyQ2FzZSgpfWAgOiB1bmRlZmluZWQ7XG5cblx0XHRpZiAoZnJvbUV4dGVuc2lvbklkID09PSB0b0V4dGVuc2lvbklkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgZ2V0RXh0ZW5zaW9uU3RvcmFnZUxvY2F0aW9uID0gKGV4dGVuc2lvbklkOiBzdHJpbmcsIGdsb2JhbDogYm9vbGVhbik6IFVSSSA9PiB7XG5cdFx0XHRpZiAoZ2xvYmFsKSB7XG5cdFx0XHRcdHJldHVybiB1cmlJZGVudGl0eVNlcnZpY2UuZXh0VXJpLmpvaW5QYXRoKHVzZXJEYXRhUHJvZmlsZXNTZXJ2aWNlLmRlZmF1bHRQcm9maWxlLmdsb2JhbFN0b3JhZ2VIb21lLCBleHRlbnNpb25JZC50b0xvd2VyQ2FzZSgpIC8qIEV4dGVuc2lvbiBpZCBpcyBsb3dlciBjYXNlZCBmb3IgZ2xvYmFsIHN0b3JhZ2UgKi8pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHVyaUlkZW50aXR5U2VydmljZS5leHRVcmkuam9pblBhdGgoZW52aXJvbm1lbnRTZXJ2aWNlLndvcmtzcGFjZVN0b3JhZ2VIb21lLCB3b3Jrc3BhY2VDb250ZXh0U2VydmljZS5nZXRXb3Jrc3BhY2UoKS5pZCwgZXh0ZW5zaW9uSWQpO1xuXHRcdH07XG5cblx0XHRjb25zdCBzdG9yYWdlU2NvcGUgPSBnbG9iYWwgPyBTdG9yYWdlU2NvcGUuUFJPRklMRSA6IFN0b3JhZ2VTY29wZS5XT1JLU1BBQ0U7XG5cdFx0aWYgKCFzdG9yYWdlU2VydmljZS5nZXRCb29sZWFuKHN0b3JhZ2VNaWdyYXRlZEtleSwgc3RvcmFnZVNjb3BlLCBmYWxzZSkgJiYgIShtaWdyYXRlTG93ZXJDYXNlU3RvcmFnZUtleSAmJiBzdG9yYWdlU2VydmljZS5nZXRCb29sZWFuKG1pZ3JhdGVMb3dlckNhc2VTdG9yYWdlS2V5LCBzdG9yYWdlU2NvcGUsIGZhbHNlKSkpIHtcblx0XHRcdGxvZ1NlcnZpY2UuaW5mbyhgTWlncmF0aW5nICR7Z2xvYmFsID8gJ2dsb2JhbCcgOiAnd29ya3NwYWNlJ30gZXh0ZW5zaW9uIHN0b3JhZ2UgZnJvbSAke2Zyb21FeHRlbnNpb25JZH0gdG8gJHt0b0V4dGVuc2lvbklkfS4uLmApO1xuXHRcdFx0Ly8gTWlncmF0ZSBzdGF0ZVxuXHRcdFx0Y29uc3QgdmFsdWUgPSBleHRlbnNpb25TdG9yYWdlU2VydmljZS5nZXRFeHRlbnNpb25TdGF0ZShmcm9tRXh0ZW5zaW9uSWQsIGdsb2JhbCk7XG5cdFx0XHRpZiAodmFsdWUpIHtcblx0XHRcdFx0ZXh0ZW5zaW9uU3RvcmFnZVNlcnZpY2Uuc2V0RXh0ZW5zaW9uU3RhdGUodG9FeHRlbnNpb25JZCwgdmFsdWUsIGdsb2JhbCk7XG5cdFx0XHRcdGV4dGVuc2lvblN0b3JhZ2VTZXJ2aWNlLnNldEV4dGVuc2lvblN0YXRlKGZyb21FeHRlbnNpb25JZCwgdW5kZWZpbmVkLCBnbG9iYWwpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBNaWdyYXRlIHN0b3JlZCBmaWxlc1xuXHRcdFx0Y29uc3QgZnJvbVBhdGggPSBnZXRFeHRlbnNpb25TdG9yYWdlTG9jYXRpb24oZnJvbUV4dGVuc2lvbklkLCBnbG9iYWwpO1xuXHRcdFx0Y29uc3QgdG9QYXRoID0gZ2V0RXh0ZW5zaW9uU3RvcmFnZUxvY2F0aW9uKHRvRXh0ZW5zaW9uSWQsIGdsb2JhbCk7XG5cdFx0XHRpZiAoIXVyaUlkZW50aXR5U2VydmljZS5leHRVcmkuaXNFcXVhbChmcm9tUGF0aCwgdG9QYXRoKSkge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGF3YWl0IGZpbGVTZXJ2aWNlLm1vdmUoZnJvbVBhdGgsIHRvUGF0aCwgdHJ1ZSk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0aWYgKCg8RmlsZVN5c3RlbVByb3ZpZGVyRXJyb3I+ZXJyb3IpLmNvZGUgIT09IEZpbGVTeXN0ZW1Qcm92aWRlckVycm9yQ29kZS5GaWxlTm90Rm91bmQpIHtcblx0XHRcdFx0XHRcdGxvZ1NlcnZpY2UuaW5mbyhgRXJyb3Igd2hpbGUgbWlncmF0aW5nICR7Z2xvYmFsID8gJ2dsb2JhbCcgOiAnd29ya3NwYWNlJ30gZmlsZSBzdG9yYWdlIGZyb20gJyR7ZnJvbUV4dGVuc2lvbklkfScgdG8gJyR7dG9FeHRlbnNpb25JZH0nYCwgZ2V0RXJyb3JNZXNzYWdlKGVycm9yKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRsb2dTZXJ2aWNlLmluZm8oYE1pZ3JhdGVkICR7Z2xvYmFsID8gJ2dsb2JhbCcgOiAnd29ya3NwYWNlJ30gZXh0ZW5zaW9uIHN0b3JhZ2UgZnJvbSAke2Zyb21FeHRlbnNpb25JZH0gdG8gJHt0b0V4dGVuc2lvbklkfWApO1xuXHRcdFx0c3RvcmFnZVNlcnZpY2Uuc3RvcmUoc3RvcmFnZU1pZ3JhdGVkS2V5LCB0cnVlLCBzdG9yYWdlU2NvcGUsIFN0b3JhZ2VUYXJnZXQuTUFDSElORSk7XG5cdFx0fVxuXHR9KTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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