{"version":3,"names":["getErrorMessage","IEnvironmentService","IExtensionStorageService","FileSystemProviderErrorCode","IFileService","ILogService","IStorageService","IUriIdentityService","IUserDataProfilesService","IWorkspaceContextService","migrateExtensionStorage","fromExtensionId","toExtensionId","global","instantionService","cov_uffd18m7t","f","s","invokeFunction","serviceAccessor","environmentService","get","userDataProfilesService","extensionStorageService","storageService","uriIdentityService","fileService","workspaceContextService","logService","storageMigratedKey","migrateLowerCaseStorageKey","toLowerCase","b","undefined","getExtensionStorageLocation","extensionId","extUri","joinPath","defaultProfile","globalStorageHome","workspaceStorageHome","getWorkspace","id","storageScope","getBoolean","info","value","getExtensionState","setExtensionState","fromPath","toPath","isEqual","move","error","code","FileNotFound","store"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/services/extensions/common/extensionStorageMigration.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getErrorMessage } from '../../../../base/common/errors.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { FileSystemProviderError, FileSystemProviderErrorCode, IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\n\n/**\n * An extension storage has following\n * \t- State: Stored using storage service with extension id as key and state as value.\n *  - Resources: Stored under a location scoped to the extension.\n */\nexport async function migrateExtensionStorage(fromExtensionId: string, toExtensionId: string, global: boolean, instantionService: IInstantiationService): Promise<void> {\n\treturn instantionService.invokeFunction(async serviceAccessor => {\n\t\tconst environmentService = serviceAccessor.get(IEnvironmentService);\n\t\tconst userDataProfilesService = serviceAccessor.get(IUserDataProfilesService);\n\t\tconst extensionStorageService = serviceAccessor.get(IExtensionStorageService);\n\t\tconst storageService = serviceAccessor.get(IStorageService);\n\t\tconst uriIdentityService = serviceAccessor.get(IUriIdentityService);\n\t\tconst fileService = serviceAccessor.get(IFileService);\n\t\tconst workspaceContextService = serviceAccessor.get(IWorkspaceContextService);\n\t\tconst logService = serviceAccessor.get(ILogService);\n\t\tconst storageMigratedKey = `extensionStorage.migrate.${fromExtensionId}-${toExtensionId}`;\n\t\tconst migrateLowerCaseStorageKey = fromExtensionId.toLowerCase() === toExtensionId.toLowerCase() ? `extension.storage.migrateFromLowerCaseKey.${fromExtensionId.toLowerCase()}` : undefined;\n\n\t\tif (fromExtensionId === toExtensionId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst getExtensionStorageLocation = (extensionId: string, global: boolean): URI => {\n\t\t\tif (global) {\n\t\t\t\treturn uriIdentityService.extUri.joinPath(userDataProfilesService.defaultProfile.globalStorageHome, extensionId.toLowerCase() /* Extension id is lower cased for global storage */);\n\t\t\t}\n\t\t\treturn uriIdentityService.extUri.joinPath(environmentService.workspaceStorageHome, workspaceContextService.getWorkspace().id, extensionId);\n\t\t};\n\n\t\tconst storageScope = global ? StorageScope.PROFILE : StorageScope.WORKSPACE;\n\t\tif (!storageService.getBoolean(storageMigratedKey, storageScope, false) && !(migrateLowerCaseStorageKey && storageService.getBoolean(migrateLowerCaseStorageKey, storageScope, false))) {\n\t\t\tlogService.info(`Migrating ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}...`);\n\t\t\t// Migrate state\n\t\t\tconst value = extensionStorageService.getExtensionState(fromExtensionId, global);\n\t\t\tif (value) {\n\t\t\t\textensionStorageService.setExtensionState(toExtensionId, value, global);\n\t\t\t\textensionStorageService.setExtensionState(fromExtensionId, undefined, global);\n\t\t\t}\n\n\t\t\t// Migrate stored files\n\t\t\tconst fromPath = getExtensionStorageLocation(fromExtensionId, global);\n\t\t\tconst toPath = getExtensionStorageLocation(toExtensionId, global);\n\t\t\tif (!uriIdentityService.extUri.isEqual(fromPath, toPath)) {\n\t\t\t\ttry {\n\t\t\t\t\tawait fileService.move(fromPath, toPath, true);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif ((<FileSystemProviderError>error).code !== FileSystemProviderErrorCode.FileNotFound) {\n\t\t\t\t\t\tlogService.info(`Error while migrating ${global ? 'global' : 'workspace'} file storage from '${fromExtensionId}' to '${toExtensionId}'`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlogService.info(`Migrated ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}`);\n\t\t\tstorageService.store(storageMigratedKey, true, storageScope, StorageTarget.MACHINE);\n\t\t}\n\t});\n}\n"],"mappings":"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","ignoreList":[]}