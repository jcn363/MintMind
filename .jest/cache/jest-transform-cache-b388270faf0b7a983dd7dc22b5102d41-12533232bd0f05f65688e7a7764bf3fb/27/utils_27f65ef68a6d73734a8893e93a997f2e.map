{"version":3,"names":["cov_238z8kna3m","actualCoverage","EditOperation","AsyncIterableSource","getNWords","performAsyncTextEdit","model","edit","progress","obs","editSource","f","id","s","deltaDecorations","range","options","description","stickiness","first","part","newText","isDisposed","b","getDecorationRange","Error","replace","insert","getEndPosition","start","pushEditOperations","undoEdits","report","undefined","stop","asProgressiveEdit","interval","wordsPerSec","token","Math","max","stream","text","cancelAndSet","isCancellationRequested","r","emitOne","value","substring","length","isFullString","cancel","resolve","d","dispose","onCancellationRequested","asyncIterable"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/inlineChat/browser/utils.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IIdentifiedSingleEditOperation, ITextModel, IValidEditOperation, TrackedRangeStickiness } from '../../../../editor/common/model.js';\nimport { IEditObserver } from './inlineChatStrategies.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { IntervalTimer, AsyncIterableSource } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getNWords } from '../../chat/common/chatWordCounter.js';\nimport { TextModelEditSource } from '../../../../editor/common/textModelEditSource.js';\n\n\n\n// --- async edit\n\nexport interface AsyncTextEdit {\n\treadonly range: IRange;\n\treadonly newText: AsyncIterable<string>;\n}\n\nexport async function performAsyncTextEdit(model: ITextModel, edit: AsyncTextEdit, progress?: IProgress<IValidEditOperation[]>, obs?: IEditObserver, editSource?: TextModelEditSource) {\n\n\tconst [id] = model.deltaDecorations([], [{\n\t\trange: edit.range,\n\t\toptions: {\n\t\t\tdescription: 'asyncTextEdit',\n\t\t\tstickiness: TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t\t}\n\t}]);\n\n\tlet first = true;\n\tfor await (const part of edit.newText) {\n\n\t\tif (model.isDisposed()) {\n\t\t\tbreak;\n\t\t}\n\n\t\tconst range = model.getDecorationRange(id);\n\t\tif (!range) {\n\t\t\tthrow new Error('FAILED to perform async replace edit because the anchor decoration was removed');\n\t\t}\n\n\t\tconst edit = first\n\t\t\t? EditOperation.replace(range, part) // first edit needs to override the \"anchor\"\n\t\t\t: EditOperation.insert(range.getEndPosition(), part);\n\t\tobs?.start();\n\n\t\tmodel.pushEditOperations(null, [edit], (undoEdits) => {\n\t\t\tprogress?.report(undoEdits);\n\t\t\treturn null;\n\t\t}, undefined, editSource);\n\n\t\tobs?.stop();\n\t\tfirst = false;\n\t}\n}\n\nexport function asProgressiveEdit(interval: IntervalTimer, edit: IIdentifiedSingleEditOperation, wordsPerSec: number, token: CancellationToken): AsyncTextEdit {\n\n\twordsPerSec = Math.max(30, wordsPerSec);\n\n\tconst stream = new AsyncIterableSource<string>();\n\tlet newText = edit.text ?? '';\n\n\tinterval.cancelAndSet(() => {\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\t\tconst r = getNWords(newText, 1);\n\t\tstream.emitOne(r.value);\n\t\tnewText = newText.substring(r.value.length);\n\t\tif (r.isFullString) {\n\t\t\tinterval.cancel();\n\t\t\tstream.resolve();\n\t\t\td.dispose();\n\t\t}\n\n\t}, 1000 / wordsPerSec);\n\n\t// cancel ASAP\n\tconst d = token.onCancellationRequested(() => {\n\t\tinterval.cancel();\n\t\tstream.resolve();\n\t\td.dispose();\n\t});\n\n\treturn {\n\t\trange: edit.range,\n\t\tnewText: stream.asyncIterable\n\t};\n}\n"],"mappings":"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","ignoreList":[]}