{"version":3,"names":["cov_2ajod9jak5","actualCoverage","Event","Disposable","URI","FileType","hasReadWriteCapability","isEqual","VSBuffer","LocalHistoryFileSystemProvider","fileService","SCHEMA","s","toLocalHistoryFileSystem","resource","f","serializedLocalHistoryResource","location","toString","associatedResource","with","scheme","query","JSON","stringify","fromLocalHistoryFileSystem","parse","EMPTY_RESOURCE","from","path","EMPTY","capabilities","constructor","mapSchemeToProvider","Map","withProvider","providerPromise","get","b","provider","getProvider","Promise","resolve","disposable","onDidChangeFileSystemProviderRegistrations","e","added","dispose","set","stat","type","File","ctime","mtime","size","readFile","fromString","buffer","Error","onDidChangeCapabilities","None","onDidChangeFile","writeFile","content","opts","mkdir","readdir","rename","to","delete","watch"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/contrib/localHistory/browser/localHistoryFileSystemProvider.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileDeleteOptions, IFileOverwriteOptions, FileSystemProviderCapabilities, FileType, IFileWriteOptions, hasReadWriteCapability, IFileService, IFileSystemProvider, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions } from '../../../../platform/files/common/files.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\n\ninterface ILocalHistoryResource {\n\n\t/**\n\t * The location of the local history entry to read from.\n\t */\n\treadonly location: URI;\n\n\t/**\n\t * The associated resource the local history entry is about.\n\t */\n\treadonly associatedResource: URI;\n}\n\ninterface ISerializedLocalHistoryResource {\n\treadonly location: string;\n\treadonly associatedResource: string;\n}\n\n/**\n * A wrapper around a standard file system provider\n * that is entirely readonly.\n */\nexport class LocalHistoryFileSystemProvider implements IFileSystemProvider, IFileSystemProviderWithFileReadWriteCapability {\n\n\tstatic readonly SCHEMA = 'vscode-local-history';\n\n\tstatic toLocalHistoryFileSystem(resource: ILocalHistoryResource): URI {\n\t\tconst serializedLocalHistoryResource: ISerializedLocalHistoryResource = {\n\t\t\tlocation: resource.location.toString(true),\n\t\t\tassociatedResource: resource.associatedResource.toString(true)\n\t\t};\n\n\t\t// Try to preserve the associated resource as much as possible\n\t\t// and only keep the `query` part dynamic. This enables other\n\t\t// components (e.g. other timeline providers) to continue\n\t\t// providing timeline entries even when our resource is active.\n\t\treturn resource.associatedResource.with({\n\t\t\tscheme: LocalHistoryFileSystemProvider.SCHEMA,\n\t\t\tquery: JSON.stringify(serializedLocalHistoryResource)\n\t\t});\n\t}\n\n\tstatic fromLocalHistoryFileSystem(resource: URI): ILocalHistoryResource {\n\t\tconst serializedLocalHistoryResource: ISerializedLocalHistoryResource = JSON.parse(resource.query);\n\n\t\treturn {\n\t\t\tlocation: URI.parse(serializedLocalHistoryResource.location),\n\t\t\tassociatedResource: URI.parse(serializedLocalHistoryResource.associatedResource)\n\t\t};\n\t}\n\n\tprivate static readonly EMPTY_RESOURCE = URI.from({ scheme: LocalHistoryFileSystemProvider.SCHEMA, path: '/empty' });\n\n\tstatic readonly EMPTY: ILocalHistoryResource = {\n\t\tlocation: LocalHistoryFileSystemProvider.EMPTY_RESOURCE,\n\t\tassociatedResource: LocalHistoryFileSystemProvider.EMPTY_RESOURCE\n\t};\n\n\tget capabilities() {\n\t\treturn FileSystemProviderCapabilities.FileReadWrite | FileSystemProviderCapabilities.Readonly;\n\t}\n\n\tconstructor(private readonly fileService: IFileService) { }\n\n\tprivate readonly mapSchemeToProvider = new Map<string, Promise<IFileSystemProvider>>();\n\n\tprivate async withProvider(resource: URI): Promise<IFileSystemProvider> {\n\t\tconst scheme = resource.scheme;\n\n\t\tlet providerPromise = this.mapSchemeToProvider.get(scheme);\n\t\tif (!providerPromise) {\n\n\t\t\t// Resolve early when provider already exists\n\t\t\tconst provider = this.fileService.getProvider(scheme);\n\t\t\tif (provider) {\n\t\t\t\tproviderPromise = Promise.resolve(provider);\n\t\t\t}\n\n\t\t\t// Otherwise wait for registration\n\t\t\telse {\n\t\t\t\tproviderPromise = new Promise<IFileSystemProvider>(resolve => {\n\t\t\t\t\tconst disposable = this.fileService.onDidChangeFileSystemProviderRegistrations(e => {\n\t\t\t\t\t\tif (e.added && e.provider && e.scheme === scheme) {\n\t\t\t\t\t\t\tdisposable.dispose();\n\n\t\t\t\t\t\t\tresolve(e.provider);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.mapSchemeToProvider.set(scheme, providerPromise);\n\t\t}\n\n\t\treturn providerPromise;\n\t}\n\n\t//#region Supported File Operations\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\tconst location = LocalHistoryFileSystemProvider.fromLocalHistoryFileSystem(resource).location;\n\n\t\t// Special case: empty resource\n\t\tif (isEqual(LocalHistoryFileSystemProvider.EMPTY_RESOURCE, location)) {\n\t\t\treturn { type: FileType.File, ctime: 0, mtime: 0, size: 0 };\n\t\t}\n\n\t\t// Otherwise delegate to provider\n\t\treturn (await this.withProvider(location)).stat(location);\n\t}\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst location = LocalHistoryFileSystemProvider.fromLocalHistoryFileSystem(resource).location;\n\n\t\t// Special case: empty resource\n\t\tif (isEqual(LocalHistoryFileSystemProvider.EMPTY_RESOURCE, location)) {\n\t\t\treturn VSBuffer.fromString('').buffer;\n\t\t}\n\n\t\t// Otherwise delegate to provider\n\t\tconst provider = await this.withProvider(location);\n\t\tif (hasReadWriteCapability(provider)) {\n\t\t\treturn provider.readFile(location);\n\t\t}\n\n\t\tthrow new Error('Unsupported');\n\t}\n\n\t//#endregion\n\n\t//#region Unsupported File Operations\n\n\treadonly onDidChangeCapabilities = Event.None;\n\treadonly onDidChangeFile = Event.None;\n\n\tasync writeFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> { }\n\n\tasync mkdir(resource: URI): Promise<void> { }\n\tasync readdir(resource: URI): Promise<[string, FileType][]> { return []; }\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> { }\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> { }\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable { return Disposable.None; }\n\n\t//#endregion\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA0E8B;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AA1E9B;;;;AAKA,SAASE,KAAK,QAAQ,kCAAkC;AACxD,SAASC,UAAU,QAAqB,sCAAsC;AAC9E,SAASC,GAAG,QAAQ,gCAAgC;AACpD,SAAoFC,QAAQ,EAAqBC,sBAAsB,QAAiH,4CAA4C;AACpS,SAASC,OAAO,QAAQ,sCAAsC;AAC9D,SAASC,QAAQ,QAAQ,mCAAmC;AAoB5D;;;;AAIA,OAAM,MAAOC,8BAA8B;EAwCbC,WAAA;EAtC7B,OAAgBC,MAAM;EAAA;EAAA,CAAAX,cAAA,GAAAY,CAAA,OAAG,sBAAsB;EAE/C,OAAOC,wBAAwBA,CAACC,QAA+B;IAAA;IAAAd,cAAA,GAAAe,CAAA;IAC9D,MAAMC,8BAA8B;IAAA;IAAA,CAAAhB,cAAA,GAAAY,CAAA,OAAoC;MACvEK,QAAQ,EAAEH,QAAQ,CAACG,QAAQ,CAACC,QAAQ,CAAC,IAAI,CAAC;MAC1CC,kBAAkB,EAAEL,QAAQ,CAACK,kBAAkB,CAACD,QAAQ,CAAC,IAAI;KAC7D;IAED;IACA;IACA;IACA;IAAA;IAAAlB,cAAA,GAAAY,CAAA;IACA,OAAOE,QAAQ,CAACK,kBAAkB,CAACC,IAAI,CAAC;MACvCC,MAAM,EAAEZ,8BAA8B,CAACE,MAAM;MAC7CW,KAAK,EAAEC,IAAI,CAACC,SAAS,CAACR,8BAA8B;KACpD,CAAC;EACH;EAEA,OAAOS,0BAA0BA,CAACX,QAAa;IAAA;IAAAd,cAAA,GAAAe,CAAA;IAC9C,MAAMC,8BAA8B;IAAA;IAAA,CAAAhB,cAAA,GAAAY,CAAA,OAAoCW,IAAI,CAACG,KAAK,CAACZ,QAAQ,CAACQ,KAAK,CAAC;IAAC;IAAAtB,cAAA,GAAAY,CAAA;IAEnG,OAAO;MACNK,QAAQ,EAAEb,GAAG,CAACsB,KAAK,CAACV,8BAA8B,CAACC,QAAQ,CAAC;MAC5DE,kBAAkB,EAAEf,GAAG,CAACsB,KAAK,CAACV,8BAA8B,CAACG,kBAAkB;KAC/E;EACF;EAEQ,OAAgBQ,cAAc;EAAA;EAAA,CAAA3B,cAAA,GAAAY,CAAA,OAAGR,GAAG,CAACwB,IAAI,CAAC;IAAEP,MAAM,EAAEZ,8BAA8B,CAACE,MAAM;IAAEkB,IAAI,EAAE;EAAQ,CAAE,CAAC;EAEpH,OAAgBC,KAAK;EAAA;EAAA,CAAA9B,cAAA,GAAAY,CAAA,OAA0B;IAC9CK,QAAQ,EAAER,8BAA8B,CAACkB,cAAc;IACvDR,kBAAkB,EAAEV,8BAA8B,CAACkB;GACnD;EAED,IAAII,YAAYA,CAAA;IAAA;IAAA/B,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAY,CAAA;IACf,OAAO;EACR;EAEAoB,YAA6BtB,WAAyB;IAAA;IAAAV,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAY,CAAA;IAAzB,KAAAF,WAAW,GAAXA,WAAW;EAAkB;EAEzCuB,mBAAmB;EAAA;EAAA,CAAAjC,cAAA,GAAAY,CAAA,OAAG,IAAIsB,GAAG,EAAwC;EAE9E,MAAMC,YAAYA,CAACrB,QAAa;IAAA;IAAAd,cAAA,GAAAe,CAAA;IACvC,MAAMM,MAAM;IAAA;IAAA,CAAArB,cAAA,GAAAY,CAAA,QAAGE,QAAQ,CAACO,MAAM;IAE9B,IAAIe,eAAe;IAAA;IAAA,CAAApC,cAAA,GAAAY,CAAA,QAAG,IAAI,CAACqB,mBAAmB,CAACI,GAAG,CAAChB,MAAM,CAAC;IAAC;IAAArB,cAAA,GAAAY,CAAA;IAC3D,IAAI,CAACwB,eAAe,EAAE;MAAA;MAAApC,cAAA,GAAAsC,CAAA;MAErB;MACA,MAAMC,QAAQ;MAAA;MAAA,CAAAvC,cAAA,GAAAY,CAAA,QAAG,IAAI,CAACF,WAAW,CAAC8B,WAAW,CAACnB,MAAM,CAAC;MAAC;MAAArB,cAAA,GAAAY,CAAA;MACtD,IAAI2B,QAAQ,EAAE;QAAA;QAAAvC,cAAA,GAAAsC,CAAA;QAAAtC,cAAA,GAAAY,CAAA;QACbwB,eAAe,GAAGK,OAAO,CAACC,OAAO,CAACH,QAAQ,CAAC;MAC5C;MAEA;MAAA,KACK;QAAA;QAAAvC,cAAA,GAAAsC,CAAA;QAAAtC,cAAA,GAAAY,CAAA;QACJwB,eAAe,GAAG,IAAIK,OAAO,CAAsBC,OAAO,IAAG;UAAA;UAAA1C,cAAA,GAAAe,CAAA;UAC5D,MAAM4B,UAAU;UAAA;UAAA,CAAA3C,cAAA,GAAAY,CAAA,QAAG,IAAI,CAACF,WAAW,CAACkC,0CAA0C,CAACC,CAAC,IAAG;YAAA;YAAA7C,cAAA,GAAAe,CAAA;YAAAf,cAAA,GAAAY,CAAA;YAClF;YAAI;YAAA,CAAAZ,cAAA,GAAAsC,CAAA,UAAAO,CAAC,CAACC,KAAK;YAAA;YAAA,CAAA9C,cAAA,GAAAsC,CAAA,UAAIO,CAAC,CAACN,QAAQ;YAAA;YAAA,CAAAvC,cAAA,GAAAsC,CAAA,UAAIO,CAAC,CAACxB,MAAM,KAAKA,MAAM,GAAE;cAAA;cAAArB,cAAA,GAAAsC,CAAA;cAAAtC,cAAA,GAAAY,CAAA;cACjD+B,UAAU,CAACI,OAAO,EAAE;cAAC;cAAA/C,cAAA,GAAAY,CAAA;cAErB8B,OAAO,CAACG,CAAC,CAACN,QAAQ,CAAC;YACpB,CAAC;YAAA;YAAA;cAAAvC,cAAA,GAAAsC,CAAA;YAAA;UACF,CAAC,CAAC;QACH,CAAC,CAAC;MACH;MAAC;MAAAtC,cAAA,GAAAY,CAAA;MAED,IAAI,CAACqB,mBAAmB,CAACe,GAAG,CAAC3B,MAAM,EAAEe,eAAe,CAAC;IACtD,CAAC;IAAA;IAAA;MAAApC,cAAA,GAAAsC,CAAA;IAAA;IAAAtC,cAAA,GAAAY,CAAA;IAED,OAAOwB,eAAe;EACvB;EAEA;EAEA,MAAMa,IAAIA,CAACnC,QAAa;IAAA;IAAAd,cAAA,GAAAe,CAAA;IACvB,MAAME,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAY,CAAA,QAAGH,8BAA8B,CAACgB,0BAA0B,CAACX,QAAQ,CAAC,CAACG,QAAQ;IAE7F;IAAA;IAAAjB,cAAA,GAAAY,CAAA;IACA,IAAIL,OAAO,CAACE,8BAA8B,CAACkB,cAAc,EAAEV,QAAQ,CAAC,EAAE;MAAA;MAAAjB,cAAA,GAAAsC,CAAA;MAAAtC,cAAA,GAAAY,CAAA;MACrE,OAAO;QAAEsC,IAAI,EAAE7C,QAAQ,CAAC8C,IAAI;QAAEC,KAAK,EAAE,CAAC;QAAEC,KAAK,EAAE,CAAC;QAAEC,IAAI,EAAE;MAAC,CAAE;IAC5D,CAAC;IAAA;IAAA;MAAAtD,cAAA,GAAAsC,CAAA;IAAA;IAED;IAAAtC,cAAA,GAAAY,CAAA;IACA,OAAO,CAAC,MAAM,IAAI,CAACuB,YAAY,CAAClB,QAAQ,CAAC,EAAEgC,IAAI,CAAChC,QAAQ,CAAC;EAC1D;EAEA,MAAMsC,QAAQA,CAACzC,QAAa;IAAA;IAAAd,cAAA,GAAAe,CAAA;IAC3B,MAAME,QAAQ;IAAA;IAAA,CAAAjB,cAAA,GAAAY,CAAA,QAAGH,8BAA8B,CAACgB,0BAA0B,CAACX,QAAQ,CAAC,CAACG,QAAQ;IAE7F;IAAA;IAAAjB,cAAA,GAAAY,CAAA;IACA,IAAIL,OAAO,CAACE,8BAA8B,CAACkB,cAAc,EAAEV,QAAQ,CAAC,EAAE;MAAA;MAAAjB,cAAA,GAAAsC,CAAA;MAAAtC,cAAA,GAAAY,CAAA;MACrE,OAAOJ,QAAQ,CAACgD,UAAU,CAAC,EAAE,CAAC,CAACC,MAAM;IACtC,CAAC;IAAA;IAAA;MAAAzD,cAAA,GAAAsC,CAAA;IAAA;IAED;IACA,MAAMC,QAAQ;IAAA;IAAA,CAAAvC,cAAA,GAAAY,CAAA,QAAG,MAAM,IAAI,CAACuB,YAAY,CAAClB,QAAQ,CAAC;IAAC;IAAAjB,cAAA,GAAAY,CAAA;IACnD,IAAIN,sBAAsB,CAACiC,QAAQ,CAAC,EAAE;MAAA;MAAAvC,cAAA,GAAAsC,CAAA;MAAAtC,cAAA,GAAAY,CAAA;MACrC,OAAO2B,QAAQ,CAACgB,QAAQ,CAACtC,QAAQ,CAAC;IACnC,CAAC;IAAA;IAAA;MAAAjB,cAAA,GAAAsC,CAAA;IAAA;IAAAtC,cAAA,GAAAY,CAAA;IAED,MAAM,IAAI8C,KAAK,CAAC,aAAa,CAAC;EAC/B;EAEA;EAEA;EAESC,uBAAuB;EAAA;EAAA,CAAA3D,cAAA,GAAAY,CAAA,QAAGV,KAAK,CAAC0D,IAAI;EACpCC,eAAe;EAAA;EAAA,CAAA7D,cAAA,GAAAY,CAAA,QAAGV,KAAK,CAAC0D,IAAI;EAErC,MAAME,SAASA,CAAChD,QAAa,EAAEiD,OAAmB,EAAEC,IAAuB;IAAA;IAAAhE,cAAA,GAAAe,CAAA;EAAmB;EAE9F,MAAMkD,KAAKA,CAACnD,QAAa;IAAA;IAAAd,cAAA,GAAAe,CAAA;EAAmB;EAC5C,MAAMmD,OAAOA,CAACpD,QAAa;IAAA;IAAAd,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAY,CAAA;IAAmC,OAAO,EAAE;EAAE;EAEzE,MAAMuD,MAAMA,CAACvC,IAAS,EAAEwC,EAAO,EAAEJ,IAA2B;IAAA;IAAAhE,cAAA,GAAAe,CAAA;EAAmB;EAC/E,MAAMsD,MAAMA,CAACvD,QAAa,EAAEkD,IAAwB;IAAA;IAAAhE,cAAA,GAAAe,CAAA;EAAmB;EAEvEuD,KAAKA,CAACxD,QAAa,EAAEkD,IAAmB;IAAA;IAAAhE,cAAA,GAAAe,CAAA;IAAAf,cAAA,GAAAY,CAAA;IAAiB,OAAOT,UAAU,CAACyD,IAAI;EAAE","ignoreList":[]}