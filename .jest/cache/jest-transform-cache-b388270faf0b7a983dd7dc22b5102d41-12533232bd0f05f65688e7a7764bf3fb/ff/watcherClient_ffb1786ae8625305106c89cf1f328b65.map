{"version":3,"names":["cov_3vnp0msgi","actualCoverage","FileAccess","spawn","readline","AbstractUniversalWatcherClient","UniversalWatcherProxy","JSONRPCClient","child","nextId","s","pendingRequests","Map","onNotification","constructor","command","args","options","f","stdio","b","stdout","stdin","Error","rl","createInterface","input","output","on","line","decoded","Buffer","from","toString","message","JSON","parse","id","result","error","pending","get","delete","reject","resolve","method","params","e","setOnNotification","handler","call","request","jsonrpc","encoded","stringify","write","Promise","set","setTimeout","has","dispose","kill","UniversalWatcherClient","onFileChanges","onLogMessage","verboseLogging","init","getWatcherBinaryPath","basePath","asFileUri","fsPath","require","join","__dirname","process","platform","createWatcher","disposables","binaryPath","watcher","env","add"],"sources":["/home/user/Desktop/MintMind/src/vs/platform/files/node/watcher/watcherClient.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { FileAccess } from '../../../../base/common/network.js';\nimport { spawn, SpawnOptions, ChildProcess } from 'child_process';\nimport * as readline from 'readline';\nimport { AbstractUniversalWatcherClient, IFileChange, ILogMessage, IUniversalWatcher } from '../../common/watcher.js';\nimport { UniversalWatcherProxy } from './universalWatcherProxy.js';\n\nexport class JSONRPCClient {\n\tprivate child: ChildProcess;\n\tprivate nextId = 1;\n\tprivate pendingRequests = new Map<number, { resolve: (value: unknown) => void; reject: (error: unknown) => void }>();\n\tprivate onNotification?: (method: string, params: unknown) => void;\n\n\t\tconstructor(command: string, args: string[], options: SpawnOptions) {\n\t\t\tthis.child = spawn(command, args, { ...options, stdio: ['pipe', 'pipe', 'pipe'] })!;\n\t\t\tif (!this.child.stdout || !this.child.stdin) {\n\t\t\t\tthrow new Error('Child process stdio not properly configured');\n\t\t\t}\n\t\t\tconst rl = readline.createInterface({ input: this.child.stdout, output: this.child.stdin });\n\t\trl.on('line', (line) => {\n\t\t\ttry {\n\t\t\t\tconst decoded = Buffer.from(line, 'base64').toString('utf8');\n\t\t\t\tconst message = JSON.parse(decoded);\n\t\t\t\tif ('id' in message) {\n\t\t\t\t\t// response\n\t\t\t\t\tconst { id, result, error } = message;\n\t\t\t\t\tconst pending = this.pendingRequests.get(id);\n\t\t\t\t\tif (pending) {\n\t\t\t\t\t\tthis.pendingRequests.delete(id);\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\tpending.reject(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpending.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// notification\n\t\t\t\t\tconst { method, params } = message;\n\t\t\t\t\tthis.onNotification?.(method, params);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// ignore invalid messages\n\t\t\t}\n\t\t});\n\t}\n\n\tsetOnNotification(handler: (method: string, params: unknown) => void) {\n\t\tthis.onNotification = handler;\n\t}\n\n\tasync call(method: string, params?: unknown): Promise<unknown> {\n\t\tconst id = this.nextId++;\n\t\tconst request = { jsonrpc: '2.0', id, method, params };\n\t\tconst encoded = Buffer.from(JSON.stringify(request)).toString('base64');\n\t\tif (this.child.stdin) {\n\t\t\tthis.child.stdin.write(encoded + '\\n');\n\t\t}\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.pendingRequests.set(id, { resolve, reject });\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.pendingRequests.has(id)) {\n\t\t\t\t\tthis.pendingRequests.delete(id);\n\t\t\t\t\treject(`Request timeout for method ${method}`);\n\t\t\t\t}\n\t\t\t}, 30000);\n\t\t});\n\t}\n\n\tdispose(): void {\n\t\tthis.child.kill();\n\t}\n}\n\n\nexport class UniversalWatcherClient extends AbstractUniversalWatcherClient {\n\n\tconstructor(\n\t\tonFileChanges: (changes: IFileChange[]) => void,\n\t\tonLogMessage: (msg: ILogMessage) => void,\n\t\tverboseLogging: boolean\n\t) {\n\t\tsuper(onFileChanges, onLogMessage, verboseLogging);\n\n\t\tthis.init();\n\t}\n\n\tprivate getWatcherBinaryPath(): string {\n\t\t// Use robust platform-specific path resolution for the Rust watcher binary\n\t\tlet basePath: string;\n\t\ttry {\n\t\t\tbasePath = FileAccess.asFileUri('vs/code/electron-main/watcher-rust').fsPath;\n\t\t} catch {\n\t\t\t// Fallback for development environments\n\t\t\tbasePath = require('path').join(__dirname, '..', '..', '..', 'code', 'electron-main', 'watcher-rust');\n\t\t}\n\n\t\t// Add platform-specific extension if needed\n\t\tif (process.platform === 'win32') {\n\t\t\treturn basePath + '.exe';\n\t\t}\n\t\treturn basePath;\n\t}\n\n\tprotected override createWatcher(disposables: DisposableStore): IUniversalWatcher {\n\t\tconst binaryPath = this.getWatcherBinaryPath();\n\t\tconst watcher = new UniversalWatcherProxy(binaryPath, process.env as Record<string, string>);\n\t\tdisposables.add(watcher);\n\t\treturn watcher;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}