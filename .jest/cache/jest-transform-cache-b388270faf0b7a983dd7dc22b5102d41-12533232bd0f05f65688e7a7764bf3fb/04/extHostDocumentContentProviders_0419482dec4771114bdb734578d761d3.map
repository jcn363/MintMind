{"version":3,"names":["cov_2h0xj4ybne","actualCoverage","onUnexpectedError","URI","Disposable","MainContext","Schemas","CancellationToken","splitLines","ExtHostDocumentContentProvider","_documentsAndEditors","_logService","_handlePool","s","_documentContentProviders","Map","_proxy","constructor","mainContext","f","getProxy","MainThreadDocumentContentProviders","registerTextDocumentContentProvider","scheme","provider","Object","keys","indexOf","b","Error","handle","set","$registerTextContentProvider","subscription","onDidChange","lastEvent","uri","warn","getDocument","thisEvent","$provideTextDocumentContent","then","value","document","lines","equalLines","$onVirtualDocumentChange","catch","finally","undefined","delete","$unregisterTextContentProvider","dispose","get","Promise","reject","resolve","provideTextDocumentContent","revive","None"],"sources":["/home/user/Desktop/MintMind/src/vs/workbench/api/common/extHostDocumentContentProviders.ts"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { IDisposable } from '../../../base/common/lifecycle.js';\nimport { Disposable } from './extHostTypes.js';\nimport type * as vscode from 'vscode';\nimport { MainContext, ExtHostDocumentContentProvidersShape, MainThreadDocumentContentProvidersShape, IMainContext } from './extHost.protocol.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { splitLines } from '../../../base/common/strings.js';\n\nexport class ExtHostDocumentContentProvider implements ExtHostDocumentContentProvidersShape {\n\n\tprivate static _handlePool = 0;\n\n\tprivate readonly _documentContentProviders = new Map<number, vscode.TextDocumentContentProvider>();\n\tprivate readonly _proxy: MainThreadDocumentContentProvidersShape;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadDocumentContentProviders);\n\t}\n\n\tregisterTextDocumentContentProvider(scheme: string, provider: vscode.TextDocumentContentProvider): vscode.Disposable {\n\t\t// todo@remote\n\t\t// check with scheme from fs-providers!\n\t\tif (Object.keys(Schemas).indexOf(scheme) >= 0) {\n\t\t\tthrow new Error(`scheme '${scheme}' already registered`);\n\t\t}\n\n\t\tconst handle = ExtHostDocumentContentProvider._handlePool++;\n\n\t\tthis._documentContentProviders.set(handle, provider);\n\t\tthis._proxy.$registerTextContentProvider(handle, scheme);\n\n\t\tlet subscription: IDisposable | undefined;\n\t\tif (typeof provider.onDidChange === 'function') {\n\n\t\t\tlet lastEvent: Promise<void> | undefined;\n\n\t\t\tsubscription = provider.onDidChange(async uri => {\n\t\t\t\tif (uri.scheme !== scheme) {\n\t\t\t\t\tthis._logService.warn(`Provider for scheme '${scheme}' is firing event for schema '${uri.scheme}' which will be IGNORED`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!this._documentsAndEditors.getDocument(uri)) {\n\t\t\t\t\t// ignore event if document isn't open\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (lastEvent) {\n\t\t\t\t\tawait lastEvent;\n\t\t\t\t}\n\n\t\t\t\tconst thisEvent = this.$provideTextDocumentContent(handle, uri)\n\t\t\t\t\t.then(async value => {\n\t\t\t\t\t\tif (!value && typeof value !== 'string') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst document = this._documentsAndEditors.getDocument(uri);\n\t\t\t\t\t\tif (!document) {\n\t\t\t\t\t\t\t// disposed in the meantime\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// create lines and compare\n\t\t\t\t\t\tconst lines = splitLines(value);\n\n\t\t\t\t\t\t// broadcast event when content changed\n\t\t\t\t\t\tif (!document.equalLines(lines)) {\n\t\t\t\t\t\t\treturn this._proxy.$onVirtualDocumentChange(uri, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(onUnexpectedError)\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tif (lastEvent === thisEvent) {\n\t\t\t\t\t\t\tlastEvent = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\tlastEvent = thisEvent;\n\t\t\t});\n\t\t}\n\t\treturn new Disposable(() => {\n\t\t\tif (this._documentContentProviders.delete(handle)) {\n\t\t\t\tthis._proxy.$unregisterTextContentProvider(handle);\n\t\t\t}\n\t\t\tif (subscription) {\n\t\t\t\tsubscription.dispose();\n\t\t\t\tsubscription = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\t$provideTextDocumentContent(handle: number, uri: UriComponents): Promise<string | null | undefined> {\n\t\tconst provider = this._documentContentProviders.get(handle);\n\t\tif (!provider) {\n\t\t\treturn Promise.reject(new Error(`unsupported uri-scheme: ${uri.scheme}`));\n\t\t}\n\t\treturn Promise.resolve(provider.provideTextDocumentContent(URI.revive(uri), CancellationToken.None));\n\t}\n}\n"],"mappings":"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","ignoreList":[]}